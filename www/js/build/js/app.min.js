CommunityApp.groupMembers=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupPath;return CommunityApp.utilities.stringFormat(t,e)},t=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupJoinedMembersPath;return CommunityApp.utilities.stringFormat(t,e)},o=kendo.observable({groupId:0,pages_read:[],dataBound:!1,load:function(t){var n=t.view.params.groupId;o.set("groupId",n);var a=e(n),i={url:a,requestType:"GET",callBack:o.fnLoadGroupCallback,sender:{view:t.view}};CommunityApp.dataAccess.callService(i,null,null,null,null,null,function(){o.load(t)}),o.readUsers(1,n,t.view)},fnLoadGroupCallback:function(e,t){if(e&&e.data){var o=t.view,n=o.header.find(".km-navbar").data("kendoMobileNavBar");n.title(e.data.Name+" Members")}},readUsers:function(e,n,a){var i=25,s=t(n)+"?page="+e+"&pageSize="+i,r={url:s,requestType:"GET",dataType:"JSON",callBack:o.fnLoadUsersCallback,sender:{page:e,pageSize:i,view:a,groupId:n}};CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){o.readUsers(e,n,a)})},fnLoadUsersCallback:function(e,t){if(e&&e.data){var n,a,i=t.page,s=t.pageSize,r=e.data.Items,l=4,c=o.get("pages_read"),d=t.view.scroller;if(r.length>0){r=CommunityApp.common.injectIndex(i,s,r),1==i&&($("#chat-joinedgroupmembers-container").empty(),d.reset(),c=[]);var u=kendo.template($("#joined-members-tmpl").html()),p=kendo.render(u,r);$("#chat-joinedgroupmembers-container").append(p),o.set("dataBound",!0),c.push(i),o.set("pages_read",c),d.unbind("scroll"),d.bind("scroll",function(r){$("#chat-joinedgroupmembers-container").children().each(function(){$(this).visible(!0)&&(n=$(this).data("index"),a=e.data.Total,s=t.pageSize,i=t.page,n==i*s-l&&i*s<a&&(i+=1,c.indexOf(i)<0&&(c.push(i),o.set("pages_read",c),o.readUsers(i,t.groupId,t.view))))})})}else 1==i&&($("#chat-joinedgroupmembers-container").empty(),$("#chat-joinedgroupmembers-container").append("<center><h2>No members joined the group yet!</h2></center>"),d.reset(),c=[],o.set("pages_read",c),o.set("dataBound",!0))}}});return{viewModel:o}}(),CommunityApp.groupMessages=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupMessagesPath;return CommunityApp.utilities.stringFormat(t,e)},t=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupPath;return CommunityApp.utilities.stringFormat(t,e)},o=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupMessageVotePath;return CommunityApp.utilities.stringFormat(o,e,t)},n=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.leaveGroupPath;return CommunityApp.utilities.stringFormat(t,e)},a=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupJoinedMembersPath;return CommunityApp.utilities.stringFormat(t,e)},i=function(){$("#message-form")&&($("#message-form").unbind("submit"),$("#message-form").one("submit",function(){return s.postMessage(),!0}))},s=kendo.observable({dataBound:!1,message:"",lastMessageId:0,firstMessageId:0,total:0,hasMoreMessages:!1,groupId:0,creatorId:0,timer:{},timerNoScroll:{},hideAttachment:!0,orientation:"",attachmentUrl:"",source:"",screenLoad:!1,zoomedIn:!1,uploadSelection:"",uploadSource:"",giphyData:{},lookupHandle:{},groupName:"",groupMembers:[],setTopRightIcon:function(){$("a[name='noti-badge']").hide(),$("#btn-more").removeClass("display-none"),$("#btn-more").show()},resetTopRightIcon:function(){$("a[name='noti-badge']").show(),$("#btn-more").addClass("display-none")},isCreator:function(){var e=CommunityApp.base.baseData.currentUser().id,t=s.get("creatorId");return e==t},load:function(e){CommunityApp.session.save("on-chat","true",!0),s.setTopRightIcon(),s.set("dataBound",!1),s.set("hideAttachment",!0),s.set("source",CommunityApp.common.guid()),s.set("screenLoad",!0),s.set("uploadSource",e.view.params.from),s.loadGiphy();var o=e.view.params.groupId;s.set("groupId",o);var n=t(o),a={url:n,requestType:"GET",dataType:"JSON",callBack:s.fnGetGroupCallBack,sender:{groupId:o,view:e.view}};CommunityApp.dataAccess.callService(a,null,null,null,null,null,function(){s.load(e)})},loadGiphy:function(){var e=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore);"undefined"!=typeof e&&null!==e&&"undefined"!=typeof e.selectedFixedWidthGiphy&&null!==e.selectedFixedWidthGiphy&&e.selectedFixedWidthGiphy.length>0&&(s.set("giphyData",e),s.set("attachmentUrl",e.selectedFixedWidthGiphy),s.set("hideAttachment",!1),$("#message-group").addClass("width-55"),$("#btn-submit-message").removeClass("display-none"))},inputFocus:function(){$("#container-scroller").removeClass("height-22"),$("#container-scroller").addClass("height-28"),$("#btn-submit-message").addClass("display-none"),$("#btn-down").removeClass("display-none"),s.scrollBottom()},inputBlur:function(){$("#container-scroller").removeClass("height-28"),$("#container-scroller").addClass("height-22"),$("#btn-down").addClass("display-none"),$("#btn-submit-message").removeClass("display-none"),s.scrollBottom()},inputKeyUp:function(e){var t=e.key;e.keyCode;if("@"===t){var o=s.get("lookupHandle");clearTimeout(o);var n=setTimeout(function(){s.lookupMembers(s.get("groupId"),$("#message-group").val())},1e3);s.set("lookupHandle",n)}},lookupMembers:function(e,t){CommunityApp.utilities.stringContains(t,"@")&&s.loadMembersList(e,t,function(e){if(s.set("groupMembers",e.data),e.data&&e.data.length>0){var t=$("#modalview-memberslist").data("kendoMobileModalView");t.open()}})},loadMembersList:function(e,t,o){var n=a(e),i={url:n,requestType:"POST",dataType:"JSON",data:"="+t,callBack:o};CommunityApp.dataAccess.callService(i)},selectMember:function(e,t){CommunityApp.utilities.stringContains(t,"@")&&(t=t.replace("@","(at)"));var o=s.get("message");o=CommunityApp.utilities.removeLastMention(o),s.set("message",o+" @"+t),s.closeMemberSelection()},closeMemberSelection:function(){$("#modalview-memberslist").kendoMobileModalView("close"),CommunityApp.utilities.setCaretAtEnd(document.getElementById("message-group"))},fnGetGroupCallBack:function(e,t){if(e&&e.data){var o=t.view,n=o.header.find(".km-navbar").data("kendoMobileNavBar");n.title(e.data.Name),s.set("groupName",e.data.Name),s.set("creatorId",e.data.CreatorId),s.readMessages(t.groupId,0,0,o,!0,!0)}},loadAllMessages:function(){s.set("hasMoreMessages",!1),$("#message-loading").removeClass("display-none");var e=$("#ca-group-messages").data("kendoMobileView");s.readMessages(s.get("groupId"),0,s.get("firstMessageId"),e,!1,!1)},readMessages:function(t,o,n,a,r,l){i();var c=e(t);o>0?c+="?afterId="+o:n>0&&(c+="?beforeId="+n);var d={url:c,requestType:"GET",dataType:"JSON",callBack:s.fnReadMessagesCallback,sender:{groupId:t,afterId:o,beforeId:n,view:a,scrollToBottom:l}},u=CommunityApp.main.getKendoApplication();$(document).ajaxStart(function(){u&&null!==u&&u.pane&&u.hideLoading()}),$(document).ajaxStop(function(){u&&null!==u&&u.pane&&u.hideLoading()}),r?u.showLoading():u.hideLoading(),CommunityApp.dataAccess.callService(d,null,null,null,null,null,function(){s.readMessages(t,o,n,a,!0,l)})},fnReadMessagesCallback:function(e,t){t.view;if(t.afterId>0||t.beforeId>0||e&&e.data&&e.data.Messages&&e.data.Messages.length>0){var o=e&&e.data?e.data.Messages:[],n=kendo.template($("#groups-messages-tmpl").html()),a=kendo.render(n,o);if(t.beforeId>0)$("#group-messages-container").prepend(a);else{if(0===t.afterId){var i=e&&e.data?e.data.Total:0;$("#group-messages-container").empty(),s.set("dataBound",!0),s.set("total",i),s.set("hasMoreMessages",i>o.length)}var r=_.last(o);r&&r.Id>0&&s.set("lastMessageId",r.Id);var l=_.first(o);l&&l.Id>0&&s.set("firstMessageId",l.Id),$("#group-messages-container").append(a)}$("#ca-group-messages").unbind("click"),$("#ca-group-messages").bind("click",function(){var e=s.get("zoomedIn");e&&($(this).removeClass("zoomed-in"),$(this).css("background-image",""),s.set("zoomedIn",!1))}),$("img[name='img-message-attachment']").each(function(){var e=this;$(e).unbind("click"),$(e).bind("click",function(t){var o=$(e).attr("src"),n=s.get("zoomedIn");n?($("#ca-group-messages").removeClass("zoomed-in"),$("#ca-group-messages").css("background-image",""),s.set("zoomedIn",!1)):($("#ca-group-messages").addClass("zoomed-in"),$("#ca-group-messages").css("background-image",'url("'+o+'")'),s.set("zoomedIn",!0)),t.stopPropagation()})})}else $("#group-messages-container").empty(),$("#group-messages-container").append("<div class='padding-20'><center><h2>Be the first one to message to this group!</h2></center></div>"),s.set("dataBound",!0);s.scrollBottom(),s.set("screenLoad",!1),$("#message-loading").addClass("display-none")},scrollBottom:function(){var e=$("#container-scroller").data("kendoMobileScroller"),t=e.scrollHeight()-$("#container-scroller").height();e.animatedScrollTo(0,-1*t),e.unbind("scroll"),e.bind("scroll",function(t){var o=s.get("screenLoad");if(!o)if(t.scrollTop+$("#container-scroller").height()==e.scrollHeight()){var n=s.get("timerNoScroll");clearInterval(n);var a=setInterval(function(){s.refreshMessages(!0)},1e4);s.set("timer",a)}else{var i=s.get("timer");clearInterval(i)}})},like:function(e,t,n,a){$(e).addClass("display-none"),$(e).next().removeClass("display-none"),$(e).parent().next().children().eq(0).html(Number($(e).parent().next().children().eq(0).html())+1);var i=o(t,n),s={url:i,requestType:"POST",dataType:"JSON",data:"=true"};CommunityApp.dataAccess.callService(s)},unlike:function(e,t,n,a){$(e).addClass("display-none"),$(e).prev().removeClass("display-none"),$(e).parent().next().children().eq(0).html(Number($(e).parent().next().children().eq(0).html())-1);var i=o(t,n),s={url:i,requestType:"POST",dataType:"JSON",data:"=false"};CommunityApp.dataAccess.callService(s)},postMessage:function(){CommunityApp.sounds.post();var t=$("#ca-group-messages").data("kendoMobileView"),o=t.params.groupId,n=s.get("message"),a=e(o),i=new FormData,r=s.get("uploadSource"),l="";if("selectGiphy"!=r){var c;""===s.get("orientation")?"undefined"!==$("#file-message-attachment")[0].files[0]&&"undefined"!=typeof $("#file-message-attachment")[0].files[0]&&($("#file-message-attachment")[0].files[0].size>1048576?(c=document.getElementById("message-attachment-thumb-new-upload").toDataURL("image/jpeg"),i.append("file",CommunityApp.common.dataURItoBlob(c))):i.append("file",$("#file-message-attachment")[0].files[0])):(c=document.getElementById("message-attachment-thumb-new-upload").toDataURL("image/jpeg"),i.append("file",CommunityApp.common.dataURItoBlob(c)))}else{var d=s.get("giphyData");"undefined"!=typeof d&&null!==d&&"undefined"!=typeof d.selectedOriginalGiphy&&null!==d.selectedOriginalGiphy&&d.selectedOriginalGiphy.length>0&&(l=d.selectedOriginalGiphy)}var u=s.get("source");""===u&&(u=CommunityApp.common.guid(),s.set("source",u)),i.append("data",JSON.stringify({Title:n,SectionKey:u,FileUrl:l}));var p={url:a,requestType:"POST",dataType:"JSON",data:i,callBack:s.fnMessageCallback,sender:{groupId:o,view:t,afterId:s.get("lastMessageId")}};s.set("message",""),$("#message-group").attr("disabled","disabled"),CommunityApp.dataAccess.callService(p,null,null,!0,!1,!1)},fnMessageCallback:function(e,t){s.set("message",""),s.set("hideAttachment",!0),s.set("attachmentUrl",""),$("#message-group").removeClass("width-55"),s.set("orientation",""),$("#file-message-attachment").replaceWith($("#file-message-attachment").val("").clone(!0)),s.set("source","");var o=document.getElementById("message-attachment-thumb-new-upload").getContext("2d");if(o.clearRect(0,0,0,0),$("#message-group").removeAttr("disabled"),CommunityApp.session.remove(CommunityApp.configuration.giphyConfig.offlineStore),s.set("giphyData",{}),s.set("uploadSource",""),s.set("uploadSelection",""),e&&e.data&&null!==e.data){var n=[];n.push(e.data);var a=kendo.template($("#groups-messages-tmpl").html()),r=kendo.render(a,n);$("#group-messages-container").append(r),s.set("lastMessageId",e.data.Id);var l=$("#container-scroller").data("kendoMobileScroller"),c=l.scrollHeight()-$("#container-scroller").height();l.animatedScrollTo(0,-1*c)}i(),$("#btn-submit-message").addClass("display-none")},refreshMessages:function(e){var t=$("#ca-group-messages").data("kendoMobileView"),o=t.params.groupId,n=s.get("lastMessageId");s.readMessages(o,n,t,!1,e)},hide:function(e){var t=s.get("timer");clearInterval(t),s.resetTopRightIcon(),CommunityApp.session.remove("on-chat",!0),$("#ca-group-messages").removeClass("zoomed-in"),$("#ca-group-messages").css("background-image",""),s.set("zoomedIn",!1)},closeOptionsPopover:function(){var e=$("#popover-options").data("kendoMobilePopOver");e.close()},gotoAddMembers:function(){s.closeOptionsPopover(),CommunityApp.common.navigateToView("#views/chat/add-group-members.html?groupId="+s.get("groupId"))},attach:function(){function e(){var e={};e.senderView="#views/chat/group.html?groupId="+s.get("groupId"),e.subject="test subject",e.body="test body",e.senderObject="sender object",CommunityApp.session.save(CommunityApp.configuration.giphyConfig.offlineStore,e),CommunityApp.common.navigateToView("#ca-select-giphy")}function t(){$("#file-message-attachment").click(),$("#file-message-attachment").change(function(){CommunityApp.common.readUrl(this,function(e,t){loadImage.parseMetaData(t,function(o){var n=document.getElementById("message-attachment-thumb-new-upload"),a=n.getContext("2d");a.clearRect(0,0,n.width,n.height);var i=new Image;if(o.exif){i.onload=function(){n.width="500",n.height=i.height/i.width*500,a.drawImage(i,0,0,i.width,i.height,0,0,n.width,n.height)},s.set("orientation",o.exif.get("Orientation"));var r=loadImage(t,function(t){"function"==typeof t.toDataURL?(s.set("attachmentUrl",t.toDataURL()),i.src=t.toDataURL()):(s.set("attachmentUrl",e),i.src=e)},{orientation:s.get("orientation"),maxWidth:900,maxHeight:1200});r||alert("not load image")}else s.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(s.set("attachmentUrl",e),i.onload=function(){n.width="900",n.height=i.height/i.width*900,a.drawImage(i,0,0,i.width,i.height,0,0,n.width,n.height)},i.src=e):(s.set("attachmentUrl",e),i.src=e);s.set("hideAttachment",!1),$("#message-group").addClass("width-55"),$("#btn-submit-message").removeClass("display-none")})})})}CommunityApp.session.remove(CommunityApp.configuration.giphyConfig.offlineStore),s.set("giphyData",{}),s.set("uploadSource",""),s.set("uploadSelection","");var o=CommunityApp.common.deviceType();if("null"==o)t();else{var n=[];n.push({title:"Phone Gallery",id:"gallery"}),n.push({title:"Giphy",id:"giphy"});var a={title:"Attach from",items:n,x:0,y:0};ContextMenu.open(a,function(o){switch(s.set("uploadSelection",o),o){case"gallery":t();break;case"giphy":e()}})}},leave:function(){var e=s.get("groupId"),t=n(e),o={url:t,requestType:"POST",dataType:"JSON",callBack:s.fnLeaveGroupCallback};CommunityApp.dataAccess.callService(o)},fnLeaveGroupCallback:function(e){e&&e.data&&"200 OK"==e.data&&(s.closeOptionsPopover(),CommunityApp.common.navigateToView("#views/chat/groups.html"))},viewMembers:function(){var e=s.get("groupId");CommunityApp.common.navigateToView("#views/chat/members.html?groupId="+e)},viewSettings:function(){var e=s.get("groupId");CommunityApp.common.navigateToView("#views/chat/group-settings.html?groupId="+e)}});return{viewModel:s}}(),CommunityApp.groupSettings=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupSettingsPath;return CommunityApp.utilities.stringFormat(t,e)},t=kendo.observable({groupId:0,muted:!1,load:function(o){var n=o.view.params.groupId;t.set("groupId",n);var a=e(n),i={url:a,requestType:"GET",dataType:"JSON",callBack:t.fnLoadSettingsCallback};CommunityApp.dataAccess.callService(i)},fnLoadSettingsCallback:function(e){e&&e.data?t.set("muted",e.data.MuteNotifications):t.set("muted",!1)},mute:function(){var o=t.get("muted"),n=!o,a=t.get("groupId"),i=e(a),s={url:i,requestType:"POST",dataType:"JSON",data:"="+n,callBack:t.fnChangeSettingsCallback};CommunityApp.dataAccess.callService(s)},fnChangeSettingsCallback:function(e){e&&e.data?CommunityApp.common.showSuccessNotification("Changed successfully!"):CommunityApp.common.showSuccessNotification("Unexpected Error!")}});return{viewModel:t}}(),CommunityApp.group=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupMembersPath;return CommunityApp.utilities.stringFormat(t,e)},t=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupMembersPath;return CommunityApp.utilities.stringFormat(t,e)},o=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupsPath;return e},n=kendo.observable({groupId:0,pages_read:[],name:"",description:"",selectedRoles:[],selectedRoleNames:"",allUsersInRoles:!0,dataBound:!1,loadUsers:function(e){n.set("dataBound",!1),n.set("groupId",e.view.params.groupId),n.readUsers(1,e.view.params.groupId,e.view)},readUsers:function(t,o,a){var i=25,s=e(o)+"?page="+t+"&pageSize="+i,r={url:s,requestType:"GET",dataType:"JSON",callBack:n.fnLoadUsersCallback,sender:{page:t,pageSize:i,view:a,groupId:o}};CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){n.readUsers(t,o,a)})},fnLoadUsersCallback:function(e,t){if(e&&e.data){var o,a,i=t.page,s=t.pageSize,r=e.data.Items,l=4,c=n.get("pages_read");if(r.length>0){r=CommunityApp.common.injectIndex(i,s,r),scroller=$("#internal-scroller").data("kendoMobileScroller"),1==i&&($("#chat-groupmembers-container").empty(),scroller.reset(),c=[]);var d=kendo.template($("#members-tmpl").html()),u=kendo.render(d,r);$("#chat-groupmembers-container").append(u),n.set("dataBound",!0),c.push(i),n.set("pages_read",c),scroller.unbind("scroll"),scroller.bind("scroll",function(r){$("#chat-groupmembers-container").children().each(function(){$(this).visible(!0)&&(o=$(this).data("index"),a=e.data.Total,s=t.pageSize,i=t.page,o==i*s-l&&i*s<a&&(i+=1,c.indexOf(i)<0&&(c.push(i),n.set("pages_read",c),n.readUsers(i,t.groupId,t.view))))})})}else 1==i&&($("#chat-groupmembers-container").empty(),$("#chat-groupmembers-container").append("<center><h2>All available members are already added to the group!</h2></center>"),scroller.reset(),c=[],n.set("pages_read",c),n.set("dataBound",!0))}},addMembers:function(){var e=n.get("groupId"),o=t(e),a="";$.each($("input[name='member-selector']:checked"),function(){var e=$(this).data("userid");e&&(a+=e+"-")});var i={url:o,requestType:"POST",dataType:"JSON",data:"="+a,callBack:n.fnAddMembersCallback,sender:{groupId:e}};CommunityApp.dataAccess.callService(i)},fnAddMembersCallback:function(e,t){e&&"200 OK"==e.data&&CommunityApp.common.navigateToView("#views/chat/group.html?groupId="+t.groupId)},setAddIcon:function(e){var t=e.view,o=t.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==o){var n=o.rightElement;null!==n&&($(n[0].children[6]).hide(),$("a[name='noti-badge']").hide(),$(n[0].children[9]).attr("onclick","CommunityApp.group.viewModel.addGroup();"))}},hideAddGroup:function(e){var t=e.view,o=t.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==o){var n=o.rightElement;null!==n&&($(n[0].children[6]).show(),$("a[name='noti-badge']").show(),$(n[0].children[9]).removeAttr("onclick"))}},loadAddGroup:function(e){n.setAddIcon(e),n.bindRoles()},bindRoles:function(){var e=CommunityApp.session.load("selected-roles",!0);if(n.set("selectedRoles",e),e&&e.length>0){var t="";$.each(e,function(e,o){t+=o.name+"<br/>"}),n.set("selectedRoleNames",t)}else n.set("selectedRoleNames","Public")},getSelectedRolesInput:function(){var e=n.get("selectedRoles"),t="";return e&&e.length>0&&$.each(e,function(e,o){t+=o.id+"|"}),t},addGroup:function(){var e=o(),t=n.getSelectedRolesInput(),a=n.get("allUsersInRoles"),i=n.get("name"),s=n.get("description"),r={url:e,requestType:"POST",dataType:"JSON",data:{Name:i,Description:s,AddRoleUsers:a,RoleIds:t},callBack:n.fnAddGroupCallback};CommunityApp.dataAccess.callService(r)},fnAddGroupCallback:function(e){e&&e.data&&(n.reset(),CommunityApp.common.navigateToView("#views/chat/groups.html"))},reset:function(){CommunityApp.session.remove("selected-roles",!0),n.set("selectedRoleNames",""),n.set("name",""),n.set("description","")}});return{viewModel:n}}(),CommunityApp.chatGroups=function(){var e=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.chatConfig.basePath+CommunityApp.configuration.chatConfig.groupsPath},t=kendo.observable({pages_read:[],setTopRightIcon:function(e){var t=e.view,o=t.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==o){var n=o.rightElement;null!==n&&($(n[0].children[6]).addClass("display-none"),$(n[0].children[8]).attr("href","#views/chat/add-group.html"))}},hide:function(e){var t=e.view,o=t.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==o){var n=o.rightElement;null!==n&&($(n[0].children[6]).removeClass("display-none"),$(n[0].children[8]).removeAttr("href","#views/chat/add-group.html"))}},load:function(e){t.setTopRightIcon(e),CommunityApp.common.logTitle("Chat Groups Home"),t.read(1,e.view)},read:function(o,n){var a=20,i=e();i+="?page="+o+"&pageSize="+a;var s={url:i,dataType:"JSON",requestType:"GET",callBack:t.fnLoadGroupsCallback,sender:{page:o,pageSize:a,view:n}};CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){t.read(o,n)})},fnLoadGroupsCallback:function(e,o){if(e&&e.data){var n,a,i=o.page,s=o.pageSize,r=e.data.Items,l=4;if(r.length>0){r=CommunityApp.common.injectIndex(i,s,r);var c=kendo.template($("#groups-chat-tmpl").html()),d=kendo.render(c,r),u=t.get("pages_read");scroller=o.view.scroller,1==i&&($("#chat-groups-container").empty(),scroller.reset(),u=[]),$("#chat-groups-container").append(d),u.push(i),t.set("pages_read",u),scroller.unbind("scroll"),scroller.bind("scroll",function(r){$("#chat-groups-container").children().each(function(){$(this).visible(!0)&&(n=$(this).data("index"),a=e.data.Total,s=o.pageSize,i=o.page,n==i*s-l&&i*s<a&&(i+=1,u.indexOf(i)<0&&(u.push(i),t.set("pages_read",u),t.read(i,o.view))))})})}else $("#chat-groups-container").empty(),$("#chat-groups-container").append("<div class='padding-20'><center><h2>You are not a member of any group yet!</h2></center></div>")}}});return{viewModel:t}}(),CommunityApp.groupRoles=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.roles;return CommunityApp.utilities.stringFormat(t,e)},t=kendo.observable({selectedRoles:[],load:function(o){o.view.scroller.reset();var n=CommunityApp.session.load("selected-roles",!0);n&&n.length>0&&t.set("selectedRoles",n);var a=CommunityApp.base.baseData.currentUser().id,i=e(a),s={url:i,requestType:"GET",dataType:"JSON",callBack:t.fnLoadRolesCallback};CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){t.load(o)})},fnLoadRolesCallback:function(e){if(e&&e.data){var o=t.get("selectedRoles"),n=e.data;$.each(n,function(e,t){var n=_.find(o,function(e){return e.id==t.Id});n?t.Checked="checked":t.Checked=""});var a=kendo.template($("#roles-tmpl").html()),i=kendo.render(a,n);$("#roles-container").empty(),$("#roles-container").append(i)}},updateSelectedRoles:function(e){var o=t.get("selectedRoles"),n=$(e).data("roleid"),a=$(e).data("rolename");if($(e).is(":checked")){var i=_.find(o,function(e){return e.id==n});if(!i||i.length<=0){var s={id:n,name:a};o.push(s)}}else o=_.reject(o,{id:n});t.set("selectedRoles",o)},selectRoles:function(){var e=t.get("selectedRoles");""===e?alert("Please select at least one role"):(CommunityApp.session.save("selected-roles",e,!0),CommunityApp.common.navigateToView("#views/chat/add-group.html"))}});return{viewModel:t}}(),CommunityApp.base=function(){var e={currentUser:function(){return CommunityApp.session.currentUser.load()}};return{baseData:e}}(),CommunityApp.common=function(){function e(e,t){var o=CommunityApp.main.getKendoApplication();if(console.log("inside common.navigate(): "+o),o&&null!==o){t?o.navigate(e,t):o.navigate(e);var n=o.scroller();n&&n.reset()}}function t(){var e=CommunityApp.main.getKendoApplication(),t=e.scroller();t&&t.reset()}function o(){$(".mt-main-layout-btn-logoff").show()}function n(){$(".mt-main-layout-btn-logoff").hide()}function a(){CommunityApp.userAccount.viewModel.isUserLoggedIn||(console.log("user is not authenticated"),l())}function s(e,t){var o=$("#popupNotification").kendoNotification({width:$(window).width()-40,left:20,right:20,bottom:20}).data("kendoNotification");o.show(t,"error")}function r(e){var t=$("#popupNotification").kendoNotification({width:$(window).width()-40,left:20,right:20,bottom:20}).data("kendoNotification");t.show(e,"info")}function l(e){try{e&&null!==e?(console.log("application is not null"),e.navigate("#ca-login-view")):(console.log("application is undefined"),CommunityApp.common.navigateToView("#ca-login-view")),$("#loginForm").removeClass("display-none"),setTimeout(function(){CommunityApp.userAccount.viewModel.loadLogin()},2e3)}catch(t){console.error(JSON.stringify(t))}}function c(t,o,n){var a;switch(t){case"0":a="ca-thread?threadId="+n;break;case"17":a="ca-post?postId="+o+"&mode=status";break;default:a="ca-post?postId="+o}e("#"+a)}function d(e){e.preventDefault()}function u(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var o=e.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(t.length),a=0;a<t.length;a++)n[a]=t.charCodeAt(a);return new Blob([n],{type:o})}var p=($("#notification").kendoNotification({position:{pinned:!0,bottom:30},animation:{open:{effects:"slideIn:left"},close:{effects:"slideIn:left",reverse:!0}},autoHideAfter:1e36,stacking:"down",templates:[{type:"error",template:$("#errorTemplate").html()},{type:"upload-success",template:$("#successTemplate").html()}]}).data("kendoNotification"),function(e,t){return e&&null!==e&&""!==e?CommunityApp.utilities.stringFormat(t,e):""}),m={calculatePage:function(e,t){var o=e%t,n=(e-o)/t+1;return n}},f=function(e,t){var o=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==o){var n=o.rightElement;null!==n&&$(n[0].firstChild).attr("href",t)}},g=function(e,t,o){for(i=0;i<o.length;i++)o[i].index=(e-1)*t+i;return o},h=function(e,t,o){if(e&&null!==e&&"undefined"!=typeof e)for(i=0;i<e.length;i++)e[i][t]=o;return e},y=function(e,t){if(e.files&&e.files[0]){var o=new FileReader;if(o.onload=function(o){try{"function"==typeof t&&t(o.target.result,e.files[0])}catch(n){console.log(n.message)}},o.onerror=function(e){console.log(e.target.error.name),console.log(e.target.error.message)},e.files[0])try{o.readAsDataURL(e.files[0])}catch(n){console.log(n.message)}}},v=function(e){var t="";return e&&(e.LikesCount>1?t+=e.LikesCount+" Likes":1==e.LikesCount&&(t+="1 Like"),e.CommentsCount>1?t+=""!==t?", "+e.CommentsCount+" Comments":e.CommentsCount+" Comments":1==e.CommentsCount&&(t+=""!==t?", 1 Comment":"1 Comment")),""===t&&(t="Be the first one to like this post"),t},C=function(e){var t="";return e&&(e.LikesCount>1?t+=e.LikesCount+" Likes":1==e.LikesCount&&(t+="1 Like"),e.CommentsCount>1?t+=""!==t?", "+e.CommentsCount+" Replies":e.CommentsCount+" Replies":1==e.CommentsCount&&(t+=""!==t?", 1 Reply":"1 Reply")),""===t&&(t="Be the first one to like this post"),t},A=function(){var e="iPad"==navigator.userAgent.match(/iPad/i)?"iPad":"iPhone"==navigator.userAgent.match(/iPhone/i)?"iPhone":"Android"==navigator.userAgent.match(/Android/i)?"Android":"BlackBerry"==navigator.userAgent.match(/BlackBerry/i)?"BlackBerry":"null";return e.toLowerCase()},b=function(){document.addEventListener("backbutton",d,!1)},w=function(){document.removeEventListener("backbutton",d,!1)},k=function(e,t){if(e){var o=e.view.scroller;o&&o.setOptions({pullToRefresh:!0,pull:function(){CommunityApp.sounds.refresh(),t(e),setTimeout(function(){o.pullHandled()},100)},pullOffset:50,messages:{pullTemplate:"",refreshTemplate:"",releaseTemplate:""}})}},S=function(e){window&&window.ga&&"function"==typeof window.ga.trackView&&window.ga.trackView(e)},P=function(e){window&&window.ga&&"function"==typeof window.ga.setUserId&&window.ga.setUserId(e)},I=function(e){var t={url:CommunityApp.configuration.appConfig.apkVersion,dataType:"JSON",requestType:"GET",callBack:function(t){if(t.data){var o=A(),n="android"==o?t.data.android:t.data.ios,a=t.data.forceUpdate;console.log("serverForceUpdateOption: "+a),console.log("apkVersion: "+n),a&&o&&"null"!=o?(console.log("serverForceUpdateOption is true"),"function"==typeof cordova.getAppVersion?cordova.getAppVersion(function(t){n!=t?e(!1,n):e(!0,n)}):e(!0,null)):e(!0,null)}else e(!0,null)}};CommunityApp.dataAccess.callService(t)},T=function(e){CommunityApp.configuration.appConfig.forceUpdate?I(function(t,o){if(null!==o)if(t)e&&null!==e&&e();else{var n=CommunityApp.common.deviceType(),a=(CommunityApp.configuration.appConfig.appTitle,"android"==n?CommunityApp.configuration.appConfig.marketUrl:CommunityApp.configuration.appConfig.appStoreUrl);navigator.notification.alert("There is a newer version of the App available. Please update for the best experience.",function(){window.open(a,"_system")},"Good News!")}else e&&null!==e&&e()}):e&&null!==e&&e()},U=function(e,t){var o=e.substr(e.lastIndexOf("/")+1),n=o.substr(o.lastIndexOf(".")+1);if(null!==e)switch(n.toLowerCase()){case"gif":case"png":case"jpg":case"jpeg":case"pdf":case"doc":case"docx":case"xls":case"xlsx":if("android"===CommunityApp.common.deviceType()){console.log("fileUrl: "+e);var a="Download";"android"===CommunityApp.common.deviceType()?a="Download":"iphone"!==CommunityApp.common.deviceType()&&"ipad"!==CommunityApp.common.deviceType()||(a="Download"),console.log("FileName: "+o);var i=function(t){var n=t.root.toURL()+a+"/"+o,i=cordova.plugins.permissions;i.hasPermission(i.WRITE_EXTERNAL_STORAGE,function(t){if(t.hasPermission)r(e,n);else{var o=function(){CommunityApp.common.showErrorNotification("Error!","Requires storage permission!")};i.requestPermission(i.WRITE_EXTERNAL_STORAGE,function(t){t.hasPermission?r(e,n):o()},o)}},null)},s=function(e){CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")};if(null===e||""===e)return void CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,i,s);var r=function(e,o){var n=new FileTransfer;e=e.replace(/ /g,"%20"),console.log("replaced fileUrl: "+e),n.download(e,o,function(e){var o=e.toURL();o=o.replace(/%20/g," "),cordova.InAppBrowser.open(encodeURI(o),"_system"),t&&null!==t&&t()},function(e){CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!"),alert("Please check the application permission.")})}}else cordova.InAppBrowser.open(encodeURI(e),"_system"),t&&null!==t&&t();break;default:cordova.InAppBrowser.open(encodeURI(e),"_system"),t&&null!==t&&t()}},x=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},B=function(e){window.plugins.webintent.startActivity({action:window.plugins.webintent.ACTION_VIEW,url:e},function(){},function(){
alert("Failed to open URL via Android Intent")})},N=function(e){console.log("** Opening Shop Samsung from secondary banner ** : "+e),cordova.InAppBrowser.open(e,"_system")};return{navigateToView:e,showLogOffButton:o,hideLogOffButton:n,authenticatedUser:a,showErrorNotification:s,showSuccessNotification:r,setContent:p,showLoginWindow:l,navigateToAppTypeView:c,resetScroller:t,pager:m,setAddFolderPath:f,injectIndex:g,injectValue:h,readUrl:y,formatSocialMessage:v,formatSocialMessageForDiscussion:C,deviceType:A,disableBackButton:b,enableBackButton:w,pullToRefresh:k,dataURItoBlob:u,logTitle:S,logUserId:P,forceUpdate:T,openFile:U,guid:x,startActivity:B,openShopSamsung:N}}(),CommunityApp.lang=function(){var e=function(e){var t;navigator&&navigator.globalization?navigator.globalization.getPreferredLanguage(function(o){console.log("navigation lang: "+o.value),CommunityApp.session.save("lang",o.value),t=o.value,e(t)},function(){console.error("Error getting language\n")}):(t="en-US",CommunityApp.session.save("lang","en-US"),e(t))};return{setPreferredLanguage:e}}();var Multilingual=function(){function e(e){i18next.use(i18nextXHRBackend),i18next.init({lng:"en",fallbackLng:"en",backend:{loadPath:"Languages/locales/{{ns}}.{{lng}}.json"}},function(){i18nextJquery.init(i18next,$),$(e).localize()})}var t=this;t.language="en",t.Options="",t.init=function(t){o(),e(t)},t.i18nextOption=function(){return o(),{resGetPath:"Languages/locales/__lng__.json",load:"unspecific",fallbackLng:!1,lng:t.language}};var o=function(){var e=CommunityApp.session.load("lang");if(null===e&&(CommunityApp.lang.setPreferredLanguage(),e=CommunityApp.session.load("lang")),e){var o=e.toLowerCase().split("-")[0];switch(console.log("language prefix: "+o),o){case"en":t.language="en";break;case"es":t.language="es";break;case"de":t.language="de";break;case"it":t.language="it";break;case"fr":t.language="fr";break;case"nl":t.language="nl";break;case"no":t.language="no";break;case"pl":t.language="pl";break;case"sv":t.language="sv";break;case"fi":t.language="fi";break;case"ja":t.language="ja";break;case"da":t.language="da";break;case"ko":t.language="ko";break;default:t.language="en"}}else e="en";console.log("self.language: "+t.language)}};CommunityApp.session=function(){var e={id:0,username:"",save:function(t,n){this.id=t,this.username=n,o("userSession",e)},load:function(){var t=n("userSession");return t&&(e.id=t.id,e.username=t.username),e},remove:function(){a("userSession")}},t={token:"",save:function(e){this.token=e,o("accessToken",t)},load:function(){var e=n("accessToken");return e&&(t.token=e.token),t},remove:function(){a("accessToken")}},o=function(e,t,o){o&&o===!0?sessionStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,JSON.stringify(t))},n=function(e,t){var o,n;return n=t&&t===!0?sessionStorage.getItem(e):localStorage.getItem(e),null!==n&&(o=JSON.parse(n)),o},a=function(e,t){t?sessionStorage.removeItem(e):localStorage.removeItem(e)},i=function(e){if(e)for(var t=0;t<localStorage.length;t++){var o=localStorage.key(t);"persist-username"!=o&&"push_device"!=o&&a(o)}else localStorage.clear()};return{currentUser:e,accessToken:t,clear:i,save:o,remove:a,load:n}}(),CommunityApp.utilities=function(){function e(e){var t=e.value.length;if(document.selection){e.focus();var o=document.selection.createRange();o.moveStart("character",-t),o.moveStart("character",t),o.moveEnd("character",0),o.select()}else(e.selectionStart||"0"==e.selectionStart)&&(e.selectionStart=t,e.selectionEnd=t,e.focus())}String.format=function(){for(var e=arguments[0],t=0;t<arguments.length-1;t++){var o=new RegExp("\\{"+t+"\\}","gm");e=e.replace(o,arguments[t+1])}return e},String.contains=function(e,t){return e.indexOf(t)>=0},urlExists=function(e){var t=new XMLHttpRequest;return t.open("HEAD",e,!1),t.send(),404!=t.status};var t=function(e,t){var o=e.split(/\s+/).length;return o>t?e.split(/\s+/).slice(0,t).join(" ")+" ...":e},o=function(e,t){return e.length>t?e.substr(0,t)+" ...":e},n=function(e,t){var o=e.split(/\s+/).length;return o>t},a=function(e,t){return e.length>t},i=function(e,t){for(var o in e)if(e[o]!=t[o])return!1;return!0},s=function(e){var t=e.lastIndexOf("@");return e=e.substr(0,t-1)};return{stringFormat:String.format,stringContains:String.contains,urlExists:urlExists,getWords:t,isLongerThanWords:n,getChars:o,isLongerThanChars:a,areEqual:i,setCaretAtEnd:e,removeLastMention:s}}(),CommunityApp.configuration=function(){var e={domain:"platform.pulsellc.com",appTitle:"Pulse Community",myPhotosFolderId:211,skin:"nova",environment:"android-light",serviceUrl:"http://api.platform.pulsellc.com/api/v1/",instantNotifications:!1,logo:"http://platform.pulsellc.com/content/STKSite/images/logo.png",repeatProcInterval:12e4,latestNewsSectionId:271,homeScreen:"#ca-home-main-view",myPhotosSectionKey:"user-profile-resource-library",allowT2Reg:!1,featuredPromotionsSectionId:291,mainDiscussionsSectionId:422,apkVersion:"http://platform.pulsellc.com/apps/pulse/apk/version-production.json",marketUrl:"market://details?id=com.pulsellc.pulse",appStoreUrl:"itms-apps://itunes.com/apps/<yourappdevelopername>",forceUpdate:!0,showPoints:!0,showBadges:!0},t={api_key:"686593538999824",upload_preset:"cm0j4yxo",cloudinaryUploadUrl:"https://api.cloudinary.com/v1_1/pulseltd/{0}/upload"},o={giphyServiceUrl:"http://api.giphy.com/v1/gifs/search",giphyTrendingUrl:"http://api.giphy.com/v1/gifs/trending",giphyApiKey:"dc6zaTOxFJmzC",offlineStore:"thread-for-giphy-offline-store"},n=["#ca-library","#ca-library-subfolders","#ca-library-files","#ca-user-myphotos"],a=["<postshare>"],i=["#ca-section-threads"],s=["#ca-user-profile-details","#ca-user-profile"],r=["#ca-notifications"],l=["views/chat/group.html"],c=["views/chat/groups.html"],d=["views/chat/add-group.html"],u={clientId:"b64297e3-e76b-45cd-b904-36c0f17ef959",clientSecret:"GGLzWxY3wzjHafFIoJQVdvuFoaucPh0jFYxVB3f3m70JUdv2l0Cxn8NUO9SCsStLVndUNBzF/wZc1q7mf3RtTw==",authPath:"oauth2/",authCodePath:"authcode/",accessTokenPath:"accesstoken/",tokenValidationPath:"accesstokenvalidations/",verifyPath:"verify",registerPath:"register",storeCodesPath:"{0}/storecodes",storeNamesPath:"{0}/storenames",addressesPath:"{0}/addresses",forgotPasswordPath:"resetpassword",joinNowPath:"{0}/JoinNowPathWithVersion",showHelpDesk:"ShowHelpDesk",logOffPath:"revoke"},p={navPath:"navigation/",appNav:"communitypro",appBottomMenu:"communityprobottommenu"},m={accountPath:"account/",statusPath:"{0}/statuses/",updateStatusPath:"{0}/statuses/{1}",badgesPath:"{0}/badges/",availableBadgesPath:"{0}/availableBadges/",favoritesPath:"{0}/favorites/",myPhotosPath:"{0}/folders/{1}/photos",storyBoardPath:"{0}/storyboards",accessRightsPath:"{0}/accessrights",roles:"{0}/roles",usersPath:"users",changePasswordPath:"{0}/changePassword",showStatusUpdatePath:"showStatusUpdate",allStatusesPath:"{0}/allStatuses"},f={postsPath:"post/",recentPostsPath:"{0}/recents/{1}/{2}/{3}",recentPostsPagedPath:"{0}/recents?width={1}&height={2}",newRecentPostsPagedPath:"{0}/newrecents?width={1}&height={2}",likePostPath:"{0}/likes/{1}",unlikePostPath:"{0}/unlikes/{1}",postPath:"{0}/permissions/{1}",deleteCommentPath:"{0}/comments/{1}/users/{2}",postViewsPath:"{0}/views/{1}",addCommentPath:"{0}/comments/{1}",ratePostPath:"{0}/rates/{1}",subscribePath:"{0}/subscriptions/{1}",sharePath:"{0}/shares",featuredLearningPath:"learnings",sync:"recents/updates",offlineStore:"recent-posts-offline-store",recentPostId:"{0}/recents/id?width={1}&height={2}",recentPostsMax:10},g={sectionPath:"section/",sectionTypePath:"types/{0}",subscribePath:"{0}/subscriptions/{1}",sectionPostsPath:"{0}/recents/{1}/{2}",sectionThreadsPath:"{0}/threads/{1}?unread={2}",sync:"{0}/recents/{1}/{2}/updates",offlineStore:"recent-section-posts-offline-store",sectionAllPostsPath:"{0}/recents/{1}/{2}/all"},h={forumsPath:"forum/",groupsPath:"groups/",groupSectionsPath:"{0}/types/{1}/sections",recentForumsPath:"recents",recentForumsLessPath:"recents/less",popularForumsPath:"populars",popularForumsLessPath:"populars/less",threadPath:"{0}/threads/{1}",threadPostsPath:"{0}/threads/{1}/posts/{2}",subscribePath:"{0}/subscriptions/{1}",replyPath:"{0}/threads/{1}/posts/{2}/replies",suggestPath:"{0}/threads/{1}/posts/{2}/suggestions",verifyPath:"{0}/threads/{1}/posts/{2}/verifications",threadAddPath:"{0}/sections/{1}",threadEditPath:"{0}/threads/{1}/posts/{2}",deleteAttachment:"deleteattachment/{0}",deleteForumPostPath:"{0}/threads/{1}/posts/{2}/delete",threadSettingsPath:"{0}/threads/{1}/settings",extraFilePath:"{0}/sections/{1}/threads/{2}"},y={searchPath:"search/",serpPath:"{0}",trendingPath:"{0}/trendings"},v={notificationsPath:"notifications/",userNotificationsPath:"{0}?width={1}&height={2}",markAsReadPath:"{0}/reads/{1}",deletePath:"{0}/notification/{1}",unreadsCountPath:"{0}/unreads",pushNotificationsDevicePath:"{0}/devices",deletePushNotificationsDevicePath:"{0}/devices/{1}"},C={librariesPath:"library/",galleryPath:"{0}",topLevelsPath:"{0}/toplevels/{1}/{2}",libraryFoldersPath:"{0}/toplevels/{1}/folders",subfoldersPath:"{0}/toplevels/{1}/folders/{2}",folderPath:"{0}/toplevels/{1}/folder/{2}",filesPath:"{0}/toplevels/{1}/folder/{2}/files",allFilesPath:"{0}/toplevels/{1}/folder/{2}/allfiles",cloudinaryPath:"{0}/toplevels/{1}/folder/{2}/cloudinaryfile",uploadCloudinaryDirectly:"/uploadCloudinaryDirectly"},A={learningPath:"learning/",categoriesPath:"categories/{0}/{1}",curriculumsPath:"categories/{0}/{1}/{2}/curriculums/{3}",coursesPath:"categories/{0}/{1}/{2}/curriculums/{3}/{4}/courses",lessonsPath:"categories/{0}/{1}/{2}/curriculums/{3}/{4}/courses/{5}/lessons",assignTestPath:"categories/{0}/{1}/{2}/curriculums/{3}/{4}/courses/{5}/lessons/{6}/assignments",finishTestPath:"categories/{0}/{1}/{2}/curriculums/{3}/{4}/courses/{5}/lessons/{6}/assignments/{7}",scorePath:"score",scormPath:"scorm/{0}/lessons/{1}?type={2}",assessmentsPath:"courses/{0}/tests/{1}/userTest/{2}/question/{3}",saveAssessmentsPath:"SaveQuestionAnswer",assessmentResultPath:"testresult/{0}/{1}/{2}/{3}",finishPdfLessonPath:"FinishPdfAssessment/{0}"},b={bannerPath:"banner/",latestPath:"mobilelatest",secondaryPath:"mobilesecondary",mobileLatestOfflineStore:"mobilelatest-offline-store",mobileSecondaryOfflineStore:"mobilesecondary-offline-store"},w={pollPath:"poll/",latestUnansweredPollPath:"GetLatestUnansweredPoll/{0}/{1}",lastAnsweredPollPath:"GetLastAnsweredPoll/{0}/{1}",pollByIdPath:"GetPollById/{0}/{1}/{2}",voteToPollPath:"VoteToPoll",pollGraphPath:"PollGraph/{0}",pollVotesListPath:"GetPollVotesList/{0}/{1}/{2}",getPollByIdPath:"GetPollById/{0}/{1}"},k={surveyPath:"Survey/",getSurveyPath:"GetSurvey/{0}/{1}/{2}",saveSurveyQuestionAnswerPath:"SaveSurveyQuestionAnswer",latestActiveSurveyPath:"GetLatestActiveSurvey/{0}",getSurveyByIdPath:"GetSurveyById/{0}/{1}"},S={reportPath:"Report/",allStoresPath:"GetAllStores",monthlyUserPointsPath:"GetMonthlyUsersPoints/{0}",allTimeUserPointsPath:"GetAllTimeUsersPoints/{0}"},P={basePath:"chat/",groupsPath:"groups",groupPath:"groups/{0}",groupMessagesPath:"groups/{0}/messages",groupMessageVotePath:"groups/{0}/messages/{1}/votes",groupMembersPath:"groups/{0}/members",leaveGroupPath:"groups/{0}/leave",groupJoinedMembersPath:"groups/{0}/joined",groupSettingsPath:"groups/{0}/settings"},I={basePath:"task/",myTasksPath:"user",taskPath:"{0}",userTasksCategoriesPath:"user/categories"};return{appConfig:e,cloudinaryConfig:t,giphyConfig:o,navConfig:p,authConfig:u,profileConfig:m,postConfig:f,sectionConfig:g,forumConfig:h,searchConfig:y,notificationsConfig:v,librariesConfig:C,learningConfig:A,bannerConfig:b,addLibraryFolderViews:n,sharePostViews:a,addThreadViews:i,editProfileViews:s,clearNotificationsViews:r,pollConfig:w,surveyConfig:k,reportConfig:S,chatConfig:P,chatAddMoreViews:l,addGroupViews:c,addRolesViews:d,tasksConfig:I}}(),CommunityApp.sounds=function(){var e=function(){ion.sound.play("button_tiny")},t=function(){ion.sound.play("button_click_on")},o=function(){ion.sound.play("branch_break")},n=function(){ion.sound.play("water_droplet")},a=function(){ion.sound.play("glass")},i=function(){ion.sound.play("water_droplet_3")},s=function(){ion.sound.play("snap")},r=function(){ion.sound({sounds:[{name:"button_tiny",volume:.3},{name:"button_click_on",volume:.3},{name:"branch_break",volume:.3},{name:"water_droplet",volume:.3},{name:"glass",volume:.3},{name:"water_droplet_3",volume:.3},{name:"snap",volume:.3}],path:"sounds/",preload:!0,multiplay:!0})};return{like:e,unlike:t,preload:r,del:o,post:n,verify:a,suggest:i,refresh:s}}(),CommunityApp.contestsImei=function(){var e=kendo.observable({imei:"",load:function(e){},saveImei:function(){var t=CommunityApp.base.baseData.currentUser(),o=e.get("imei");if(""!==o&&null!==o)if(15===o.length){var n={imei:o,username:t.username,userId:t.id};CommunityApp.session.save("imei_"+t.id,JSON.stringify(n)),CommunityApp.common.navigateToView("views/contests/sales-contest-report.html")}else CommunityApp.common.showErrorNotification("","Invalid IMEI");else CommunityApp.common.showErrorNotification("","Enter IMEI or MEID")}});return{viewModel:e}}(),CommunityApp.contestsSalesReport=function(){var e=kendo.observable({salesReport:[],load:function(t){var o=CommunityApp.base.baseData.currentUser(),n=CommunityApp.session.load("imei_"+o.id),a=JSON.parse(n);e.set("salesReport",[a])}});return{viewModel:e}}(),CommunityApp.dataAccess=function(){var e=function(e,t,o,n,a,i,s){var r={url:e.url,type:e.requestType,data:e.data,dataType:e.dataType,cache:!1,processData:a,contentType:i,tryCount:0,retryLimit:3,beforeSend:function(t){if("undefined"!=typeof e.httpHeader&&"undefined"!=typeof e.headerValue&&$.each(e.httpHeader,function(o,n){t.setRequestHeader(n,e.headerValue[o])}),null!==n&&n===!1){var o=CommunityApp.main.getKendoApplication();o&&null!==o&&o.pane&&o.hideLoading()}},success:function(n,a,i){var s={success:null!==n&&n.IsSuccessful,data:n};e.callBack&&e.callBack(s,e.sender),(null===n||n.length<=0||n.Items&&n.Items.length<=0)&&t&&o&&$("#"+t).html(o)},error:function(t,o,n){switch(t.status){case 401:break;case 500:console.error("server app error 500: "+n);break;default:console.error("server error: "+n)}s&&null!==s&&s();var a={success:!1,status:t.status,settings:r};e.callBack&&e.callBack(a,e.sender)}};$.ajax(r)},t=function(e,t,o,n,a,i,s,r,l){var c;return c=new kendo.data.DataSource({offlineStorage:r,serverPaging:!0,pageSize:t,page:e,transport:{read:{url:o,beforeSend:function(e){var t=CommunityApp.session.accessToken.load();e.setRequestHeader("Authorization","Basic "+t.token)},data:{query:a},type:n,dataType:"json",cache:!1}},error:function(e){var t=CommunityApp.main.getKendoApplication();switch(t&&null!==t&&"undefined"!=typeof t&&t.hideLoading(),e.xhr.status){case 401:break;default:console.error(JSON.stringify(e))}l&&null!==l&&l()},requestEnd:function(e){"read"===e.type&&i&&null!==i&&($("#"+i).children().not(".container-fluid").remove(),e.response&&e.response.Items&&e.response.Items.length<=0&&i&&s&&($("#"+i).has(".container-fluid")?$("#"+i).append(s):$("#"+i).html(s)))},parameterMap:function(e){var t={pageNumber:e.page,pageSize:e.pageSize};return t},schema:{total:function(e){return e.Total},data:function(e){return e.Items}}})},o=function(e){var t=new kendo.data.DataSource({transport:{read:function(t){var o=JSON.parse(localStorage[e]);console.log("Local Data to fetch: "+localStorage[e]),t.success(o)}}});return t},n=function(e,t,o,n){var a;return a=new kendo.data.DataSource({offlineStorage:n,transport:{read:{url:e,beforeSend:function(e){var t=CommunityApp.session.accessToken.load();e.setRequestHeader("Authorization","Basic "+t.token)},data:{query:o},type:t,dataType:"json",cache:!1}},error:function(e){var t=CommunityApp.main.getKendoApplication();switch(t&&null!==t&&"undefined"!=typeof t&&t.hideLoading(),e.xhr.status){case 401:break;default:console.error(JSON.stringify(e))}}})};return{callService:e,kendoDataSource:t,kendoOfflineDataSource:o,kendoNonpagedDataSource:n}}(),CommunityApp.sync=function(){function e(){CommunityApp.userAccount.viewModel.isUserLoggedIn&&setTimeout(function(){var e=CommunityApp.session.load("push_url");e&&"undefined"!=typeof e&&null!==e&&""!==e?(CommunityApp.session.remove("push_url"),CommunityApp.common.navigateToView(e)):(CommunityApp.common.enableBackButton(),CommunityApp.common.navigateToView(CommunityApp.configuration.appConfig.homeScreen))},2e3)}var t=function(e,t,o){$.ajax({url:e,data:{modifiedSince:t},dataType:"json",success:function(e){o(e)},error:function(e,t){console.log(t.responseText)}})},o={applyChanges:function(e,t){window.dao.initialize()}},n=function(){var e=CommunityApp.session.currentUser.load(),t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.recentPostsPath;return t=CommunityApp.utilities.stringFormat(t,e.id,!1,600,600)},a=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.sectionAllPostsPath;return e=CommunityApp.utilities.stringFormat(e,CommunityApp.configuration.appConfig.latestNewsSectionId,360,215)},i=function(){$(".km-loader").addClass("display-none"),CommunityApp.common.forceUpdate(function(){var o=null,n=(CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.sync,CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.sync);n=CommunityApp.utilities.stringFormat(n,CommunityApp.configuration.appConfig.latestNewsSectionId,360,215),t(n,o,function(t){if(t&&t.length>0){var o=a();console.log("before calling offline sectionRecentPostsDS");var n=CommunityApp.dataAccess.kendoNonpagedDataSource(o,"GET",null,CommunityApp.configuration.sectionConfig.offlineStore);n.read().then(function(){console.log("fetching sectionRecentPostsDS"),n.online(!1)})}e()})})},s=function(){$(".km-loader").removeClass("display-none")},r=function(e){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.sync;t(o,null,function(t){if(t&&t.length>0){var o=n();console.log("before calling offline recentPostsDS");var a=CommunityApp.dataAccess.kendoNonpagedDataSource(o,"GET",null,CommunityApp.configuration.postConfig.offlineStore);a.read().then(function(){console.log("fetching recentPostsDS"),a.online(!1),e()})}})};return{process:i,recentPosts:o,refreshRecentPosts:r,processComplete:s}}(),CommunityApp.editThread=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.threadPostsPath;return CommunityApp.utilities.stringFormat(o,e,t,0)},t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.threadEditPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},o=function(){$("#edit-thread-form")&&($("button[type='submit']","#edit-thread-form").html("<i class='km-icon km-add'></i>&nbsp;Post Thread").removeAttr("disabled"),$("#edit-thread-form").unbind("submit"),$("#edit-thread-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-22 pull-right'></div>").attr("disabled","disabled"),n.edit(),!0}))},n=kendo.observable({subject:"",body:"",postId:0,sectionId:0,threadId:0,sectionName:"",attachmentUrl:"",orientation:"",dataBound:!1,notReply:!1,processing:!1,forGiphy:!1,selectedGiphy:"",selectedFixedWidthGiphy:"",load:function(t){n.reset(),n.set("dataBound",!1);var a=t.view.params.postId,i=t.view.params.threadId,s=t.view.params.sectionId;n.set("postId",a),n.set("threadId",i),n.set("sectionId",s);var r=t.view.params.reply;n.set("notReply",!1),"0"===r&&n.set("notReply",!0);var l=document.getElementById("discussion-attachment-canvas-editThread"),c=l.getContext("2d");c.clearRect(0,0,l.width,l.height),$("#attchUploadEdit").val(""),n.set("forGiphy",!1),n.set("selectedGiphy",""),n.set("selectedFixedWidthGiphy","");var d=t.view.params.from;if("undefined"!==d&&"undefined"!=typeof d&&"selectGiphy"===d){n.set("forGiphy",!0);var u=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore);CommunityApp.session.remove(CommunityApp.configuration.giphyConfig.offlineStore),n.set("subject",u.subject),n.set("body",u.body),n.set("sectionName",u.sectionName),n.set("selectedGiphy",u.selectedGiphy),n.set("selectedFixedWidthGiphy",u.selectedFixedWidthGiphy),console.log("selectedGiphy: "+u.selectedGiphy),n.set("dataBound",!0)}else if("undefined"!==i&&"undefined"!=typeof i){var p=CommunityApp.base.baseData.currentUser().id,m=e(p,i);console.log("service url: "+m);var f={url:m,requestType:"GET",dataType:"JSON",callBack:n.fnThreadLoadCallBack},g=t;CommunityApp.dataAccess.callService(f,null,null,null,null,null,function(){n.load(g)})}o()},fnThreadLoadCallBack:function(e){if(e.data){var t=n.get("postId"),o=0;console.log(e.data.Items.length);var a=document.getElementById("discussion-attachment-canvas-editThread"),i=a.getContext("2d"),s=new Image;for(s.onload=function(){i.drawImage(s,0,0,s.width,s.height,0,0,a.width,a.height)},o=0;o<e.data.Items.length;o++)e.data.Items[o].Id==t&&(n.set("subject",e.data.Items[o].Subject),n.set("body",e.data.Items[o].Body),n.set("sectionName",e.data.Items[o].PostThread.ThreadSection.Name),e.data.Items[o].PostAttachments.length>0&&(n.set("attachmentUrl",e.data.Items[o].PostAttachments[0].FileUrl),s.src=e.data.Items[o].PostAttachments[0].FileUrl),n.set("dataBound",!0),CommunityApp.common.logTitle("Edit Thread: "+n.get("subject")))}},edit:function(){n.set("processing",!0);var e=CommunityApp.base.baseData.currentUser().id,o=n.get("threadId"),a=n.get("postId"),i=t(e,o,a);console.log("EditUrl: "+i);var s=new FormData,r=n.get("selectedFixedWidthGiphy");if(""===r){var l;""===n.get("orientation")?"undefined"!==$("#attchUploadEdit")[0].files[0]&&"undefined"!=typeof $("#attchUploadEdit")[0].files[0]&&($("#attchUploadEdit")[0].files[0].size>1048576?(l=document.getElementById("discussion-attachment-canvas-edit-upload").toDataURL("image/jpeg"),s.append("file",CommunityApp.common.dataURItoBlob(l))):s.append("file",$("#attchUploadEdit")[0].files[0])):(l=document.getElementById("discussion-attachment-canvas-edit-upload").toDataURL("image/jpeg"),s.append("file",CommunityApp.common.dataURItoBlob(l))),s.append("data",JSON.stringify({Id:n.get("postId"),Title:n.get("subject"),Description:n.get("body"),SectionId:n.get("sectionId")}))}else s.append("data",JSON.stringify({Id:n.get("postId"),Title:n.get("subject"),Description:n.get("body"),SectionId:n.get("sectionId"),FileUrl:r}));var c={url:i,requestType:"PUT",dataType:"JSON",data:s,callBack:n.fnEditThreadCallback};CommunityApp.dataAccess.callService(c,null,null,!0,!1,!1)},fnEditThreadCallback:function(e){if(e.data)if(console.log("edit response: "+e.data.HttpStatus),"200"==e.data.HttpStatus){var t=e.data.AdditionalData;CommunityApp.common.navigateToView("#ca-thread-discussion?threadId="+t)}else CommunityApp.common.showErrorNotification("Unexpected Error","Unexpected error has occurred!");n.set("processing",!1)},selectResource:function(){var e={},t=0;n.get("isReply")&&(t=1),e.senderView="#ca-thread-edit?postId="+n.get("postId")+"&threadId="+n.get("threadId")+"&sectionId="+n.get("sectionId")+"&reply="+t,e.sectionId=n.get("sectionId"),e.postId=n.get("postId"),e.threadId=n.get("threadId"),e.subject=n.get("subject"),e.body=n.get("body"),e.sectionName=n.get("sectionName"),e.senderObject="editThread",CommunityApp.session.save(CommunityApp.configuration.giphyConfig.offlineStore,e);$("#select-resource-dialog").kendoWindow({modal:!0,width:300,resizable:!1,title:"Resource Selection",visible:!1,deactivate:function(e){}}).data("kendoWindow").center().open()},triggerUpload:function(e){console.log("edit triggerUpload: "+e),n.set("forGiphy",!1),"giphyResource"===e?(n.set("forGiphy",!0),CommunityApp.common.navigateToView("#ca-select-giphy")):($("#attchUploadEdit").click(),$("#attchUploadEdit").change(function(){CommunityApp.common.readUrl(this,function(e,t){loadImage.parseMetaData(t,function(o){var a=document.getElementById("discussion-attachment-canvas-editThread"),i=a.getContext("2d");i.clearRect(0,0,a.width,a.height);var s=document.getElementById("discussion-attachment-canvas-edit-upload"),r=s.getContext("2d");r.clearRect(0,0,s.width,s.height);var l=new Image;if(o.exif){l.onload=function(){s.width="500",s.height=l.height/l.width*500,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},n.set("orientation",o.exif.get("Orientation"));var c=loadImage(t,function(t){"function"==typeof t.toDataURL?(n.set("attachmentUrl",t.toDataURL()),l.src=t.toDataURL()):(n.set("attachmentUrl",e),l.src=e)},{orientation:n.get("orientation"),maxWidth:900,maxHeight:1200});c||alert("not load image")}else n.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(n.set("attachmentUrl",e),l.onload=function(){s.width="900",s.height=l.height/l.width*900,i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height),r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height)},l.src=e):(n.set("attachmentUrl",e),l.onload=function(){i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e)})})}))},reset:function(){n.set("subject",""),n.set("body",""),n.set("sectionId",0),n.set("sectionName",""),n.set("attachmentUrl",""),n.set("orientation","")}});return{viewModel:n}}(),CommunityApp.extraFile=function(){var e=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.extraFilePath;return CommunityApp.utilities.stringFormat(n,e,t,o)},t=function(){$("#extra-file-form")&&($("button[type='submit']","#extra-file-form").html("<span class='km-icon km-upload'></span>Attach").removeAttr("disabled"),$("#extra-file-form").unbind("submit"),$("#extra-file-form").bind("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading'></div>").attr("disabled","disabled"),o.attach(),!0}))},o=kendo.observable({hideIcon:!0,attachmentUrl:"",orientation:"",threadId:0,postId:0,sectionId:0,load:function(e){o.set("hideIcon",!0),t(),o.set("threadId",e.view.params.threadId),o.set("postId",e.view.params.postId),o.set("sectionId",e.view.params.sectionId)},attach:function(){var t,n=o.get("threadId"),a=o.get("sectionId"),i=CommunityApp.base.baseData.currentUser().id,s=o.get("postId"),r=e(i,a,n),l=new FormData;if($("#attchExtraUpload")[0].files.length>0){""===o.get("orientation")?"undefined"!==$("#attchExtraUpload")[0].files[0]&&"undefined"!=typeof $("#attchExtraUpload")[0].files[0]&&($("#attchExtraUpload")[0].files[0].size>1048576?(t=document.getElementById("discussion-extra-attachment-canvas-new-upload").toDataURL("image/jpeg"),l.append("file",CommunityApp.common.dataURItoBlob(t))):l.append("file",$("#attchExtraUpload")[0].files[0])):(t=document.getElementById("discussion-extra-attachment-canvas-new-upload").toDataURL("image/jpeg"),l.append("file",CommunityApp.common.dataURItoBlob(t))),l.append("data",JSON.stringify({ParentPostId:s}));var c={url:r,requestType:"PUT",dataType:"JSON",data:l,callBack:o.fnExtraFileCallback,sender:{threadId:n}};CommunityApp.dataAccess.callService(c,null,null,!0,!1,!1)}else navigator.notification.alert("Please select a file to attach!",function(){},"Acosta"),$("button[type='submit']","#extra-file-form").html("<span class='km-icon km-upload'></span>Attach").removeAttr("disabled")},fnExtraFileCallback:function(e,t){e&&e.data&&"200"==e.data.HttpStatus&&CommunityApp.common.navigateToView("#ca-thread-discussion?threadId="+t.threadId)},triggerUpload:function(){$("#attchExtraUpload").click(),$("#attchExtraUpload").change(function(){CommunityApp.common.readUrl(this,function(e,t){loadImage.parseMetaData(t,function(n){var a=document.getElementById("discussion-extra-attachment-canvas-newthread"),i=a.getContext("2d");i.clearRect(0,0,a.width,a.height);var s=document.getElementById("discussion-extra-attachment-canvas-new-upload"),r=s.getContext("2d");r.clearRect(0,0,s.width,s.height);var l=new Image;if(n.exif){l.onload=function(){s.width="500",s.height=l.height/l.width*500,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},o.set("orientation",n.exif.get("Orientation"));var c=loadImage(t,function(t){"function"==typeof t.toDataURL?(o.set("attachmentUrl",t.toDataURL()),l.src=t.toDataURL()):(o.set("attachmentUrl",e),l.src=e)},{orientation:o.get("orientation"),maxWidth:500,maxHeight:600});c||alert("not load image")}else o.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(o.set("attachmentUrl",e),l.onload=function(){s.width="500",s.height=l.height/l.width*500,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e):(o.set("attachmentUrl",e),l.onload=function(){i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e);o.set("hideIcon",!1)})})})}});return{viewModel:o}}(),CommunityApp.forums=function(){var e=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.recentForumsLessPath;return e},t=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.popularForumsLessPath;return e},o=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.sectionTypePath;return CommunityApp.utilities.stringFormat(e,0)},n=kendo.observable({recentDataBound:!1,popularDataBound:!1,allTopicsDataBound:!1,popularPosts:[],load:function(e){CommunityApp.common.logTitle("Discussions Tabbed View");var t=this.element?this.element.find(".forums"):null,o=e,a=$("#select-discussion").kendoMobileButtonGroup({select:function(e){switch(t&&null!==t&&t.hide().eq(e.index).show(),e.index){case 0:n.loadForums(o);break;case 1:n.loadPopularForums(o);break;case 2:n.loadTypeSections(o)}},index:0});a.unbind("select"),n.loadForums(o)},loadForums:function(t){n.set("recentDataBound",!1);var o,a,i=e(),s=50,r=1,l=0,c=0,d=4;$("#recent-discussions").show(),$("#popular-discussions").hide(),$("#all-topics").hide();var u=t,p=CommunityApp.dataAccess.kendoDataSource(r,s,i,"GET",null,null,null,null,function(){n.loadForums(u)});p.read().then(function(){var e=p.view();e=CommunityApp.common.injectIndex(r,s,e),e=CommunityApp.common.injectValue(e,"discussion_type","recent-thread");var i=kendo.template($("#forum-list-less-tmpl").html()),u=kendo.render(i,e);$("#recent-discussions").find(".container-fluid").empty(),$("#recent-discussions").find(".container-fluid").append(u),n.set("recentDataBound",!0),o=t.view.scroller,o.reset(),o.unbind("scroll"),o.bind("scroll",function(e){$(".recent-thread").each(function(){$(this).visible()&&(c=$(this).attr("data-index"),l=p.total(),s=p.pageSize(),r=p.page(),c==r*s-d&&r*s<l&&(r+=1,p.page(r),p.read().then(function(){setTimeout(function(){console.log("rendering page: "+p.page()),a=p.view(),a=CommunityApp.common.injectIndex(r,s,a),a=CommunityApp.common.injectValue(a,"discussion_type","recent-thread"),u=kendo.render(i,a),$("#recent-discussions").find(".container-fluid").append(u)},100)})))})})})},loadPopularForums:function(e){n.set("popularDataBound",!1);var o,a,i=t(),s=50,r=1,l=0,c=0,d=4,u=e,p=CommunityApp.dataAccess.kendoDataSource(r,s,i,"GET",null,null,null,null,function(){n.loadPopularForums(u)});p.read().then(function(){var t=p.view();t=CommunityApp.common.injectIndex(r,s,t),t=CommunityApp.common.injectValue(t,"discussion_type","popular-thread");var i=kendo.template($("#forum-list-less-tmpl").html()),u=kendo.render(i,t);$("#popular-discussions").find(".container-fluid").empty(),
$("#popular-discussions").find(".container-fluid").append(u),n.set("popularDataBound",!0),o=e.view.scroller,o.reset(),o.unbind("scroll"),o.bind("scroll",function(e){$(".popular-thread").each(function(){$(this).visible()&&(c=$(this).attr("data-index"),l=p.total(),s=p.pageSize(),r=p.page(),c==r*s-d&&r*s<l&&(r+=1,p.page(r),p.read().then(function(){setTimeout(function(){console.log("rendering page: "+p.page()),a=p.view(),a=CommunityApp.common.injectIndex(r,s,a),a=CommunityApp.common.injectValue(a,"discussion_type","popular-thread"),u=kendo.render(i,a),$("#popular-discussions").find(".container-fluid").append(u)},100)})))})})})},loadTypeSections:function(e){n.set("allTopicsDataBound",!1);var t,a,i=o(),s=50,r=1,l=0,c=0,d=4,u=e,p=CommunityApp.dataAccess.kendoDataSource(r,s,i,"GET",null,null,null,null,function(){n.loadTypeSections(u)});p.read().then(function(){var o=p.view();o=CommunityApp.common.injectIndex(r,s,o);var i=kendo.template($("#type-sections-list-tmpl").html()),u=kendo.render(i,o);$("#all-topics").find(".container-fluid").empty(),$("#all-topics").find(".container-fluid").append(u),n.set("allTopicsDataBound",!0),t=e.view.scroller,t.reset(),t.bind("scroll",function(e){$(".all-topics-section").each(function(){$(this).visible()&&(c=$(this).attr("data-index"),l=p.total(),s=p.pageSize(),r=p.page(),c==r*s-d&&r*s<l&&(r+=1,p.page(r),p.read().then(function(){setTimeout(function(){console.log("rendering page: "+p.page()),a=p.view(),a=CommunityApp.common.injectIndex(r,s,a),u=kendo.render(i,a),$("#all-topics").find(".container-fluid").append(u)},100)})))})})})}});return{viewModel:n}}(),CommunityApp.groupSections=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.groupsPath+CommunityApp.configuration.forumConfig.groupSectionsPath;return CommunityApp.utilities.stringFormat(t,e,0)},t=kendo.observable({pages_read:[],dataBound:!1,load:function(o){CommunityApp.common.logTitle("Group"),t.set("dataBound",!1);var n,a,i,s=o.view.params.groupId,r=e(s),l=20,c=1,d=0,u=0,p=4,m=o,f=CommunityApp.dataAccess.kendoDataSource(c,l,r,"GET",null,"group-sections-listview","<h2 class='centerAlign padding-1'>No sections are available!</h2>",null,function(){t.load(m)});f.read().then(function(){var e=f.view();e=CommunityApp.common.injectIndex(c,l,e);var s=kendo.template($("#group-sections-list-tmpl").html());i=kendo.render(s,e),$("#group-sections-listview").find(".container-fluid").empty(),$("#group-sections-listview").find(".container-fluid").append(i);var r=t.get("pages_read");r.push(c),console.log("after pushing 1st page: "+JSON.stringify(r)),n=o.view.scroller,n.reset(),t.set("dataBound",!0),n.bind("scroll",function(t){$(".group-item").each(function(){$(this).visible()&&(u=$(this).attr("data-index"),d=f.total(),l=f.pageSize(),c=f.page(),u==c*l-p&&c*l<d&&(c+=1,f.page(c),f.read().then(function(){if(console.log("after fetching: "+JSON.stringify(r)),r.indexOf(c)<0){r.push(c),a=f.view(),a=CommunityApp.common.injectIndex(c,l,a);var t=CommunityApp.utilities.areEqual(e,a);t||setTimeout(function(){console.log("rendering page: "+f.page()),i=kendo.render(s,a),$("#group-sections-listview").find(".container-fluid").append(i)},100)}})))})})})},hide:function(){t.set("pages_read",[]),$("#group-sections-listview").find(".container-fluid").empty()}});return{viewModel:t}}(),CommunityApp.groups=function(){var e=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.groupsPath},t=kendo.observable({load:function(o){CommunityApp.common.logTitle("Group List");var n=e(),a=o,i=CommunityApp.dataAccess.kendoDataSource(1,20,n,"GET",null,"groups-listview","<h2 class='centerAlign padding-1'>No groups are available!</h2>",null,function(){t.load(a)}),s=$("#groups-listview").data("kendoMobileListView");s.setDataSource(i),s.dataSource.read(),s.refresh(),s.scroller().reset(),$(".km-load-more").remove()}});return{viewModel:t}}(),CommunityApp.mainForums=function(){var e=kendo.observable({dataBound:!1,load:function(t){CommunityApp.common.logTitle(t.view.title),e.set("dataBound",!1);var o=CommunityApp.session.load("offline_main_discussion_cache");if(null!==o&&"undefined"!=typeof o&&"undefined"!==o){if(o.length>0){var n=kendo.template($("#main-discussions-tmpl").html()),a=kendo.render(n,o);$("#main-discussions-list").find(".container-fluid").empty(),$("#main-discussions-list").find(".container-fluid").append(a)}e.set("dataBound",!0)}else CommunityApp.sectionPosts.viewModel.readSectionAllPosts(CommunityApp.configuration.appConfig.mainDiscussionsSectionId,120,120,e.fnReadSectionCallback)},fnReadSectionCallback:function(t){if(t.data){var o=kendo.template($("#main-discussions-tmpl").html()),n=kendo.render(o,t.data);$("#main-discussions-list").find(".container-fluid").empty(),$("#main-discussions-list").find(".container-fluid").append(n),CommunityApp.session.save("offline_main_discussion_cache",t.data)}e.set("dataBound",!0)}});return{viewModel:e}}(),CommunityApp.newThread=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath,t=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.threadAddPath;return CommunityApp.utilities.stringFormat(o,e,t)},o=function(){$("#add-thread-form")&&($("button[name='btn-post']","#add-thread-form").html("<i class='km-icon km-add'></i>&nbsp;Post Thread").removeAttr("disabled").show(),$("button[name='btn-extra']","#add-thread-form").html("<i class='km-icon km-upload'></i>&nbsp;Upload Extra File").removeAttr("disabled"),$("#add-thread-form").unbind("submit"),$("#add-thread-form").one("submit",function(){var e=$("button[type=submit][clicked=true]").attr("name");return"btn-post"==e?($("button[name='btn-post']",this).html("&nbsp;<div class='loading display-inline-block'></div>").attr("disabled","disabled"),$("button[name='btn-extra']",this).hide()):"btn-extra"==e&&($("button[name='btn-extra']",this).html("&nbsp;<div class='loading display-inline-block'></div>").attr("disabled","disabled"),$("button[name='btn-post']",this).hide()),n.add(e),!0}),$("#add-thread-form button[type=submit]").click(function(){$("button[type=submit]",$(this).parents("form")).removeAttr("clicked"),$(this).attr("clicked","true")}))},n=kendo.observable({subject:"",body:"",sectionId:0,sectionName:"",attachmentUrl:"",dataBound:!1,processing:!1,orientation:"",uploadExtraFileActive:!1,forGiphy:!1,selectedGiphy:"",selectedFixedWidthGiphy:"",load:function(t){n.set("uploadExtraFileActive",!1),n.reset(),n.set("dataBound",!1),n.set("sectionId",t.view.params.sectionId);var a=t.view.params.sectionId,i=document.getElementById("discussion-attachment-canvas-newthread"),s=i.getContext("2d");s.clearRect(0,0,i.width,i.height),$("#attchUploadNew").val(""),n.set("forGiphy",!1),n.set("selectedGiphy",""),n.set("selectedFixedWidthGiphy","");var r=t.view.params.from;if("undefined"!==r&&"undefined"!=typeof r&&"selectGiphy"===r){n.set("forGiphy",!0);var l=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore);CommunityApp.session.remove(CommunityApp.configuration.giphyConfig.offlineStore),n.set("subject",l.subject),n.set("body",l.body),n.set("selectedGiphy",l.selectedGiphy),n.set("selectedFixedWidthGiphy",l.selectedFixedWidthGiphy),console.log("selectedGiphy: "+l.selectedGiphy)}if("undefined"!==a&&"undefined"!=typeof a){var c={url:e+a,requestType:"GET",dataType:"JSON",callBack:n.fnLoadSectionCallBack},d=t;CommunityApp.dataAccess.callService(c,null,null,null,null,null,function(){n.load(d)})}o()},fnLoadSectionCallBack:function(e){e.data&&(CommunityApp.common.logTitle("Add Thread: "+e.data.Name),n.set("sectionName",e.data.Name),n.set("dataBound",!0),setTimeout(function(){$("#txt-subject").focus()},500))},add:function(e){n.set("processing",!0);var a=CommunityApp.base.baseData.currentUser().id,i=n.get("sectionId");if(""===n.get("subject"))navigator.notification.alert("Subject is required",function(){},"O&B"),o();else if(""===n.get("body"))navigator.notification.alert("Body is required",function(){},"O&B"),o();else{var s=t(a,i),r=new FormData,l=n.get("selectedFixedWidthGiphy");if(""===l){var c;""===n.get("orientation")?"undefined"!==$("#attchUploadNew")[0].files[0]&&"undefined"!=typeof $("#attchUploadNew")[0].files[0]&&($("#attchUploadNew")[0].files[0].size>1048576?(c=document.getElementById("discussion-attachment-canvas-new-upload").toDataURL("image/jpeg"),r.append("file",CommunityApp.common.dataURItoBlob(c))):r.append("file",$("#attchUploadNew")[0].files[0])):(c=document.getElementById("discussion-attachment-canvas-new-upload").toDataURL("image/jpeg"),r.append("file",CommunityApp.common.dataURItoBlob(c))),r.append("data",JSON.stringify({Title:n.get("subject"),Description:n.get("body"),SectionId:n.get("sectionId")}))}else r.append("data",JSON.stringify({Title:n.get("subject"),Description:n.get("body"),SectionId:n.get("sectionId"),FileUrl:l}));var d={url:s,requestType:"POST",dataType:"JSON",data:r,callBack:n.fnAddThreadCallback,sender:{source:e,sectionId:i}};CommunityApp.dataAccess.callService(d,null,null,!0,!1,!1)}},fnAddThreadCallback:function(e,t){if(e.data)if("200"==e.data.HttpStatus){var a=e.data.AdditionalData,i=e.data.RelatedData;a>0?"btn-post"==t.source?CommunityApp.common.navigateToView("#ca-thread-discussion?threadId="+a):"btn-extra"==t.source&&CommunityApp.common.navigateToView("#ca-thread-post-extra?threadId="+a+"&sectionId="+t.sectionId+"&postId="+i):(CommunityApp.common.showErrorNotification("Error","Post already exists!"),o())}else CommunityApp.common.showErrorNotification("Unexpected Error","Unexpected error has occurred!");n.set("processing",!1)},selectResource:function(){var e={};e.senderView="#ca-thread-add?sectionId="+n.get("sectionId"),e.sectionId=n.get("sectionId"),e.subject=n.get("subject"),e.body=n.get("body"),e.senderObject="newThread",CommunityApp.session.save(CommunityApp.configuration.giphyConfig.offlineStore,e);$("#select-resource-dialog").kendoWindow({modal:!0,width:300,resizable:!1,title:"Resource Selection",visible:!1,deactivate:function(e){}}).data("kendoWindow").center().open()},triggerUpload:function(e){n.set("forGiphy",!1),"giphyResource"===e?(n.set("forGiphy",!0),CommunityApp.common.navigateToView("#ca-select-giphy")):($("#attchUploadNew").click(),$("#attchUploadNew").change(function(){CommunityApp.common.readUrl(this,function(e,t){loadImage.parseMetaData(t,function(o){var a=document.getElementById("discussion-attachment-canvas-newthread"),i=a.getContext("2d");i.clearRect(0,0,a.width,a.height);var s=document.getElementById("discussion-attachment-canvas-new-upload"),r=s.getContext("2d");r.clearRect(0,0,s.width,s.height);var l=new Image;if(o.exif){l.onload=function(){s.width="500",s.height=l.height/l.width*500,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},n.set("orientation",o.exif.get("Orientation"));var c=loadImage(t,function(t){"function"==typeof t.toDataURL?(n.set("attachmentUrl",t.toDataURL()),l.src=t.toDataURL()):(n.set("attachmentUrl",e),l.src=e)},{orientation:n.get("orientation"),maxWidth:500,maxHeight:600});c||alert("not load image")}else n.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(n.set("attachmentUrl",e),l.onload=function(){s.width="500",s.height=l.height/l.width*500,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e):(n.set("attachmentUrl",e),l.onload=function(){i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e)})})})),n.set("uploadExtraFileActive",!0)},reset:function(){n.set("subject",""),n.set("body",""),n.set("sectionId",0),n.set("sectionName",""),n.set("attachmentUrl",""),n.set("orientation","")}});return{viewModel:n}}(),CommunityApp.selectGiphy=function(){var e=function(e,t,o){var n=CommunityApp.configuration.giphyConfig.giphyServiceUrl+"?q="+e+"&api_key="+CommunityApp.configuration.giphyConfig.giphyApiKey+"&offset="+t+"&limit="+o;return n},t=function(e,t){var o=CommunityApp.configuration.giphyConfig.giphyTrendingUrl+"?api_key="+CommunityApp.configuration.giphyConfig.giphyApiKey+"&offset="+e+"&limit="+t;return o},o=kendo.observable({threadData:{},queryString:"",searchText:"Results for:",inprogress:!1,page:1,pageSize:25,total:0,load:function(e){o.set("inprogress",!0),$("#txt-query").val(""),o.set("queryString",""),o.set("searchText","Trending GIFs"),o.set("total",0);var n=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore);o.set("threadData",n),console.log(n),o.set("inprogress",!0),o.set("page",1);var a=o.get("pageSize");$("#giphy-search-result-left").find(".container-fluid").empty(),$("#giphy-search-result-left").find(".container-fluid").attr("style",""),$("#giphy-search-result-right").find(".container-fluid").empty(),$("#giphy-search-result-right").find(".container-fluid").attr("style","");var i=t(0,a),s=$("#giphy-search-result").data("kendoMobileScroller");null!==s&&"undefined"!=typeof s&&s.reset();var r={url:i,dataType:"JSON",requestType:"GET",callBack:o.fnGiphySearchCallBack};CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){o.load(e)}),$("#select-giphy-form").one("submit",function(){return o.search(),!0})},search:function(){o.set("inprogress",!0),o.set("page",1);var n=$("#txt-query").val(),a=o.get("pageSize");o.set("queryString",n),$("#giphy-search-result-left").find(".container-fluid").empty(),$("#giphy-search-result-left").find(".container-fluid").attr("style",""),$("#giphy-search-result-right").find(".container-fluid").empty(),$("#giphy-search-result-right").find(".container-fluid").attr("style","");var i=$("#giphy-search-result").data("kendoMobileScroller");if(null!==i&&"undefined"!=typeof i&&i.reset(),""!==n){o.set("searchText","Results for: "+n);var s=e(n,0,a),r={url:s,dataType:"JSON",requestType:"GET",callBack:o.fnGiphySearchCallBack};CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){o.search()})}else{o.set("searchText","Trending GIFs");var l=t(0,a),c={url:l,dataType:"JSON",requestType:"GET",callBack:o.fnGiphySearchCallBack};CommunityApp.dataAccess.callService(c,null,null,null,null,null,function(){o.search()})}},fnGiphySearchCallBack:function(n){if(n.data){var a=o.get("page"),i=o.get("pageSize");CommunityApp.common.injectIndex(a,i,n.data.data);var s=0,r=kendo.template($("#giphy-search-result-tmpl").html());for(s=0;s<n.data.data.length;s++)if(n.data.data[s].width=$("#giphy-search-result").width()/2-10,n.data.data[s].height=n.data.data[s].images.fixed_width.height/n.data.data[s].images.fixed_width.width*($("#giphy-search-result").width()/2-10),s%2===0){var l=[];l.push(n.data.data[s]);var c=kendo.render(r,l);$("#giphy-search-result-left").find(".container-fluid").append(c)}else{var d=[];d.push(n.data.data[s]);var u=kendo.render(r,d);$("#giphy-search-result-right").find(".container-fluid").append(u)}$(".giphy-item").each(function(){$(this).bind("click",function(e){var t=o.get("threadData");t.selectedOriginalGiphy=$(this).attr("data-original"),t.selectedFixedWidthGiphy=$(this).attr("src"),CommunityApp.session.save(CommunityApp.configuration.giphyConfig.offlineStore,t),CommunityApp.common.navigateToView(t.senderView+"&from=selectGiphy")})}),o.set("inprogress",!1);var p=n.data.pagination.total_count;o.set("total",p);var m=$("#giphy-search-result").data("kendoMobileScroller");null!==m&&"undefined"!=typeof m&&m.bind("scroll",function(n){$(".giphy-item").each(function(){if($(this).visible()){var n=8,a=$(this).attr("data-index"),i=o.get("pageSize"),s=o.get("page"),r=o.get("total"),l=o.get("queryString");if(""!==l&&a==s*i-n&&s*i<r||""===l&&a==s*i-n)if(s+=1,o.set("page",s),""!==l){var c=e(l,(s-1)*i,i),d={url:c,dataType:"JSON",requestType:"GET",callBack:o.fnGiphySearchCallBack};CommunityApp.dataAccess.callService(d)}else{var u=t((s-1)*i,i),p={url:u,dataType:"JSON",requestType:"GET",callBack:o.fnGiphySearchCallBack};CommunityApp.dataAccess.callService(p)}}})})}},cancel:function(){},controlViewOnPopup:function(){var e=$("input[name=resourceSelection]:checked").val(),t=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore),o=t.senderObject;console.log(e);var n=$("#select-resource-dialog").data("kendoWindow");n.close(),console.log(t),"newThread"===o?CommunityApp.newThread.viewModel.triggerUpload(e):"replyThread"===o?CommunityApp.threadPosts.viewModel.triggerUpload(e):"editThread"===o?CommunityApp.editThread.viewModel.triggerUpload(e):"newStatus"===o?CommunityApp.status.viewModel.triggerUpload(e):"updateStatus"===o&&CommunityApp.status.viewModel.triggerUploadForUpdate(e)}});return{viewModel:o}}(),CommunityApp.threadPosts=function(){var e=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.threadPostsPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},t=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.threadSettingsPath;return CommunityApp.utilities.stringFormat(o,e,t)},o=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.replyPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},n=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.suggestPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},a=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.verifyPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},i=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.deleteForumPostPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},s=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.deleteAttachment;return CommunityApp.utilities.stringFormat(t,e)},r=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.pollConfig.pollPath+CommunityApp.configuration.pollConfig.pollGraphPath;return t=CommunityApp.utilities.stringFormat(t,e)},l=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.pollConfig.pollPath+CommunityApp.configuration.pollConfig.voteToPollPath;return e},c=function(){$("#reply-form")&&($("button[type='submit']","#reply-form").html("<span class='km-icon km-comment'></span>Reply").removeAttr("disabled"),$("#reply-form").unbind("submit"),$("#reply-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-20 pull-right'></div>").attr("disabled","disabled"),u.reply(),!0}))},d=function(){$("#discussion-poll-vote-form")&&($("button[type='submit']","#discussion-poll-vote-form").html("Vote").removeAttr("disabled"),$("#discussion-poll-vote-form").unbind("submit"),$("#discussion-poll-vote-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-22 pull-right'></div>").attr("disabled","disabled"),u.vote(),!0}))},u=kendo.observable({body:"",threadId:0,postId:0,level:0,sectionId:0,topPost:{},subject:"",longBody:"",relativeDate:"",author:{},authorTitle:"",authorFullName:"",likesText:"",commentsText:"",replySocialMessage:"",dataBound:!1,typing:!1,hideIcon:!0,processing:!1,editAllowed:!1,zoomedIn:!1,poll:{},hasPoll:!1,pollDescription:"",pollAnsweredUserCountText:"",unansweredPoll:!1,showChart:!1,fileUrl:"",orientation:"",forGiphy:!1,selectedGiphy:"",selectedFixedWidthGiphy:"",hasImageAttachment:!1,hasNonImageAttachment:!1,attachmentUrl:"",extraAttachmentUrl:"",isExtraImageAttachment:!1,hasExtraAttachmentUrl:!1,sortType:0,isMuted:!1,topAttachmentId:function(){var e=u.get("topPost");return e.PostAttachments&&"undefined"!=typeof e.PostAttachments&&null!==e.PostAttachments&&e.PostAttachments.length>0?"attachmentContainer_"+e.PostAttachments[0].AttachmentId:"attachmentContainer_0"},topAttachmentDownload:function(){var e=u.get("topPost");return e.PostAttachments&&"undefined"!=typeof e.PostAttachments&&null!==e.PostAttachments&&e.PostAttachments.length>0?"attachmentContainer_"+e.PostAttachments[0].AttachmentId+"_download":"attachmentContainer_0_download"},deletePostAttachment:function(e){var t=e.getAttribute("data-param"),o=parseInt(t.split("_")[0]),n=t.split("_")[1];if(console.log("Attachment Id is : "+o),0===o){var a=u.get("topPost");"o"==n?o=a.PostAttachments[0].AttachmentId:"e"==n&&(o=a.PostAttachments[1].AttachmentId),console.log("New Attachment Id is : "+o)}var i=s(o);console.log("deleteAttachmentServiceUrl "+i);var r={url:i,requestType:"POST",dataType:"JSON",callBack:u.DeleteAttachmentCallBack};CommunityApp.dataAccess.callService(r)},DeleteAttachmentCallBack:function(e){console.log("Delete Attachment Callback "+e.data),$("#attachmentContainer_"+e.data).hide(),$("#attachmentContainer_"+e.data+"_download").hide()},deleteTopForumPost:function(){var e=u.get("topPost");u.deleteForumPost(e.PostThread.Id,e.Id)},deleteForumPost:function(e,t){console.log("threadId: "+e),console.log("postId: "+t);var o=CommunityApp.base.baseData.currentUser().id,n=i(o,e,t),a={url:n,requestType:"POST",dataType:"JSON",callBack:u.DeleteForumPostCallBack,sender:t};CommunityApp.dataAccess.callService(a)},DeleteForumPostCallBack:function(e,t){if(console.log(t),e.data&&200===e.data.HttpStatus){var o=u.get("topPost");"False"===e.data.AdditionalData?(console.log("child"),$("#replyContainer"+t).hide(),o.SocialInfo.CommentsCount-=1,u.set("topPost",o),kendo.bind($(".feed-article"),u)):CommunityApp.common.navigateToView("ca-section-threads?sectionId="+o.PostThread.ThreadSection.Id)}else CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")},redirectNoImageAttachmentOfTopPost:function(){var e=u.get("topPost");e.PostAttachments&&"undefined"!=typeof e.PostAttachments&&null!==e.PostAttachments&&e.PostAttachments.length>0&&cordova.InAppBrowser.open(encodeURI(e.PostAttachments[0].FileUrl),"_system")},redirectNoImageAttachmentOfReply:function(e){null!==e&&cordova.InAppBrowser.open(encodeURI(e),"_system")},hasReplies:function(){var e=u.get("topPost");return!(!e||!e.PostThread)&&e.PostThread.TotalReplies>0},sectionTitle:function(){var e=u.get("topPost");return e.PostThread?e.PostThread.ThreadSection.Name:""},sectionPage:function(e){var t=u.get("topPost");return t.PostThread?e+t.PostThread.ThreadSection.Id:""},profilePage:function(e){var t=u.get("topPost");return t.PostAuthor?e+t.PostAuthor.Id:""},editThreadPage:function(e){var t=u.get("topPost");return t?e+t.Id+"&threadId="+t.ThreadId+"&sectionId="+t.SectionId+"&reply=0":""},socialMessage:function(){var e=u.get("topPost");return e.SocialInfo?CommunityApp.common.formatSocialMessageForDiscussion(e.SocialInfo):""},replyPage:function(e){var t=u.get("topPost");return t?e+"?postId="+t.Id+"&threadId="+t.ThreadId+"&level="+t.PostLevel+"&sectionId="+t.SectionId+"&subject="+t.Subject:""},likePost:function(){var e=u.get("topPost");e&&CommunityApp.post.operations({likeSuccessCallback:CommunityApp.threadPosts.viewModel.likeTopPostCallback}).like(e.Id,!0,this)},unlikePost:function(){var e=u.get("topPost");e&&CommunityApp.post.operations({likeSuccessCallback:CommunityApp.threadPosts.viewModel.likeTopPostCallback}).like(e.Id,!1,this)},likeTopPostCallback:function(e,t,o){var n=u.get("topPost");n&&("like"==e.toLowerCase()?(n.SocialInfo.LikesCount+=1,n.SocialInfo.UserLiked=!0):(n.SocialInfo.LikesCount-=1,n.SocialInfo.UserLiked=!1),u.set("topPost",n),kendo.bind($(".feed-article"),u))},showFullImage:function(e,t){var o=e.getAttribute("src"),n=u.get("zoomedIn");return n?($("#ca-thread-discussion").removeClass("zoomed-in"),$("#ca-thread-discussion .full-download")&&$("#ca-thread-discussion .full-download").remove(),u.set("zoomedIn",!1)):($("#ca-thread-discussion").click(function(){var e=u.get("zoomedIn");e&&($(this).removeClass("zoomed-in"),$(this).css("background-image",""),$("#ca-thread-discussion .full-download").remove(),u.set("zoomedIn",!1))}),$("#ca-thread-discussion").addClass("zoomed-in"),$("#ca-thread-discussion").css("background-image",'url("'+o+'")'),u.set("zoomedIn",!0),$('<div class="full-download" style="display: block;text-align: right;padding: 25px 10px 0 0;"><span class="km-text"><a data-bind="attr: { data-image: attachmentUrl }" class="no-text-decoration btn-comment" onclick="CommunityApp.threadPosts.viewModel.download(this);" data-image="'+o+'"><span class="glyphicon glyphicon-download-alt display-inline-block"></span></a></span></div>').appendTo("#ca-thread-discussion")),t.stopPropagation(),!1},download:function(e){var t=e.getAttribute("data-image");console.log("ImageUrl: "+t);var o=t.substr(t.lastIndexOf("/")+1),n="Download";"android"===CommunityApp.common.deviceType()?n="Download":"iphone"!==CommunityApp.common.deviceType()&&"ipad"!==CommunityApp.common.deviceType()||(n="Download"),console.log("ImageName: "+o);var a=function(e){var a=e.root.toURL()+n+"/"+o;if($("#thread-discussions-main-container").hide(),$('<div class="k-loading-mask" style="width: 100%; height: 100%; top: 0px; left: 0px;"><span class="k-loading-text">Downloading...</span><div class="k-loading-image"></div><div class="k-loading-color"></div></div>').appendTo("#ca-thread-discussion .km-content"),"android"===CommunityApp.common.deviceType()){var i=cordova.plugins.permissions;i.hasPermission(i.WRITE_EXTERNAL_STORAGE,function(e){if(e.hasPermission)l(t,a);else{var o=function(){CommunityApp.common.showErrorNotification("Error!","Requires storage permission!")};i.requestPermission(i.WRITE_EXTERNAL_STORAGE,function(e){e.hasPermission?l(t,a):o()},o)}},null)}else"iphone"!==CommunityApp.common.deviceType()&&"ipad"!==CommunityApp.common.deviceType()||(a=e.root.toURL()+o,console.log(a),l(t,a))},i=function(){CommunityApp.common.showSuccessNotification("Downloaded successfully!")},s=function(){CommunityApp.common.showErrorNotification("Error!","Download Failed!")},r=function(e){CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")};if(null===t||""===t)return void CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,r);var l=function(e,t){var o=new FileTransfer;o.download(e,t,function(e){$("#ca-thread-discussion .k-loading-mask").remove(),$("#thread-discussions-main-container").show(),"iphone"===CommunityApp.common.deviceType()||"ipad"===CommunityApp.common.deviceType()?cordova.plugins.imagesaver.saveImageToGallery(e.toURL(),i,s):CommunityApp.common.showSuccessNotification("Downloaded successfully!")},function(e){$("#ca-thread-discussion .k-loading-mask").remove(),$("#thread-discussions-main-container").show(),CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!"),alert("Please check the application permission.")})}},load:function(e){u.set("dataBound",!1),$("#select-sortType").kendoMobileButtonGroup({select:function(t){u.set("sortType",t.index),u.showPosts(e)},index:u.get("sortType")}),$("#ca-thread-discussion").removeClass("zoomed-in"),$("#ca-thread-discussion").css("background-image",""),$("#ca-thread-discussion .full-download")&&$("#ca-thread-discussion .full-download").remove(),u.set("zoomedIn",!1),$("#ca-thread-discussion").click(function(){var e=u.get("zoomedIn");e&&(console.log("ca-thread-discussion: click event"),$(this).removeClass("zoomed-in"),$(this).css("background-image",""),$("#ca-thread-discussion .full-download").remove(),u.set("zoomedIn",!1))}),u.showPosts(e),u.loadMute(e)},showPosts:function(t){var o,n,a=u.get("sortType"),i=t.view.params.threadId,s=CommunityApp.base.baseData.currentUser().id,r=e(s,i,a),l=10,p=1,m=0,f=0,g=4;console.log("forum: "+r);var h=t,y=CommunityApp.dataAccess.kendoDataSource(p,l,r,"GET",null,null,null,null,function(){u.load(h)});y.read().then(function(){var e=y.view();e=CommunityApp.common.injectIndex(p,l,e);var a=e.shift();a.PostAttachments&&"undefined"!=typeof a.PostAttachments&&null!==a.PostAttachments&&a.PostAttachments.length>0?u.set("hasImageAttachment",a.PostAttachments[0].IsImage):u.set("hasImageAttachment",!1);var i=a.PostAttachments&&"undefined"!=typeof a.PostAttachments&&null!==a.PostAttachments&&a.PostAttachments.length>1;u.set("hasExtraAttachmentUrl",i),i&&u.set("isExtraImageAttachment",a.PostAttachments&&"undefined"!=typeof a.PostAttachments&&null!==a.PostAttachments&&a.PostAttachments[1].IsImage);var s=u.get("hasImageAttachment");a.PostAttachments&&"undefined"!=typeof a.PostAttachments&&null!==a.PostAttachments&&a.PostAttachments.length>0&&!s?u.set("hasNonImageAttachment",!a.PostAttachments[0].IsImage):u.set("hasNonImageAttachment",!1);var r=a.PostAttachments&&"undefined"!=typeof a.PostAttachments&&null!==a.PostAttachments&&a.PostAttachments.length>0?a.PostAttachments[0].FileUrl:"";u.set("attachmentUrl",r);var c=a.PostAttachments&&"undefined"!=typeof a.PostAttachments&&null!==a.PostAttachments&&a.PostAttachments.length>1?a.PostAttachments[1].FileUrl:"";u.set("extraAttachmentUrl",c),a.PostAuthor.UserProfile.AvatarUrl+="?width=100",u.set("topPost",a);var h=CommunityApp.base.baseData.currentUser().id==a.PostAuthor.Id;u.set("editAllowed",h);var v=a.PostPoll;v?(u.loadPollData(v),u.set("poll",v)):u.set("hasPoll",!1),d();var C=a.PostThread.Type.toLowerCase();CommunityApp.common.logTitle("Thread Posts: "+a.Subject);var A=0;for(A=0;A<e.length;A++)e[A].PostAuthor.UserProfile.AvatarUrl+="?width=100",e[A].allowedEdit=CommunityApp.base.baseData.currentUser().id==e[A].PostAuthor.Id,e[A].editUrl="#ca-thread-edit?postId="+e[A].Id+"&threadId="+e[A].ThreadId+"&sectionId="+e[A].SectionId+"&reply=1";var b="discussion"==C?kendo.template($("#thread-discussions-tmpl").html()):kendo.template($("#thread-qa-tmpl").html()),w=kendo.render(b,e);"discussion"==C?($("#thread-discussions").find(".container-fluid").empty(),$("#thread-discussions").find(".container-fluid").append(w)):($("#thread-qa").find(".container-fluid").empty(),$("#thread-qa").find(".container-fluid").append(w)),u.set("dataBound",!0),a.PostAttachments&&"undefined"!=typeof a.PostAttachments&&null!==a.PostAttachments&&a.PostAttachments.length>0?$("#attachmentContainer_"+a.PostAttachments[0].AttachmentId).show():$("#attachmentContainer_0").show(),o=t.view.scroller,o.reset(),$(".img-attachment").each(function(){var e=$(this);$(this).click(function(t){console.log("image : click event");var o=e.attr("src"),n=u.get("zoomedIn");n?($("#ca-thread-discussion").removeClass("zoomed-in"),$("#ca-thread-discussion .full-download")&&$("#ca-thread-discussion .full-download").remove(),u.set("zoomedIn",!1)):($("#ca-thread-discussion").addClass("zoomed-in"),$("#ca-thread-discussion").css("background-image",'url("'+o+'")'),u.set("zoomedIn",!0),$('<div class="full-download" style="display: block;text-align: right;padding: 10px 10px 0 0;"><span class="km-text"><a data-bind="attr: { data-image: attachmentUrl }" class="no-text-decoration btn-comment" onclick="CommunityApp.threadPosts.viewModel.download(this);" data-image="'+o+'"><span class="glyphicon glyphicon-download-alt display-inline-block"></span></a></span></div>').appendTo("#ca-thread-discussion")),t.stopPropagation()})}),o.unbind("scroll"),o.bind("scroll",function(e){$(".discussion-item").each(function(){$(this).visible()&&(f=$(this).attr("data-index"),m=y.total(),l=y.pageSize(),p=y.page(),f==p*l-g&&p*l<m&&(p+=1,y.page(p),y.read().then(function(){setTimeout(function(){console.log("rendering page: "+y.page()),n=y.view(),n=CommunityApp.common.injectIndex(p,l,n);
var e=0;for(e=0;e<n.length;e++)n[e].PostAuthor.UserProfile.AvatarUrl+="?width=100",n[e].allowedEdit=CommunityApp.base.baseData.currentUser().id==n[e].PostAuthor.Id,n[e].editUrl="#ca-thread-edit?postId="+n[e].Id+"&threadId="+n[e].ThreadId+"&sectionId="+n[e].SectionId+"&reply=1";w=kendo.render(b,n),"discussion"==C?$("#thread-discussions").find(".container-fluid").append(w):$("#thread-qa").find(".container-fluid").append(w)},100)})))})})}),c(),CommunityApp.common.pullToRefresh(t,function(e){u.load(e)})},likeSuccessCallback:function(e,t,o){var n=$(o).closest(".discussion-item"),a=n.find(".social-info"),i=t>1?t+" Likes":1==t?"1 Like":"";a.html(i),$(o).closest(".social").addClass("display-none"),$(o).closest(".social").siblings().eq(0).removeClass("display-none")},loadReply:function(e){u.set("dataBound",!1),u.set("threadId",e.view.params.threadId),u.set("postId",e.view.params.postId),u.set("level",e.view.params.level),u.set("sectionId",e.view.params.sectionId),u.set("subject",e.view.params.subject),u.set("body",""),u.set("hideIcon",!0),u.set("fileUrl",""),u.set("orientation",""),u.set("forGiphy",!1),u.set("selectedGiphy",""),u.set("selectedFixedWidthGiphy","");var t=e.view.params.from;if("undefined"!==t&&"undefined"!=typeof t&&"selectGiphy"===t){u.set("forGiphy",!0);var o=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore);CommunityApp.session.remove(CommunityApp.configuration.giphyConfig.offlineStore),u.set("body",o.body),u.set("selectedGiphy",o.selectedGiphy),u.set("selectedFixedWidthGiphy",o.selectedFixedWidthGiphy)}$("#attchUpload").val("");var n=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.postConfig.postPath,e,t);return o},a=CommunityApp.base.baseData.currentUser().id,i=e.view.params.postId,s=n(i,a),r={url:s,requestType:"GET",dataType:"JSON",callBack:u.fnLoadPostCallback},l=e;CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){u.loadReply(l)})},fnLoadPostCallback:function(e){if(e.data){e.data.PostAuthor.UserProfile.AvatarUrl+="?width=100",console.log(e.data.PostAuthor.UserProfile.AvatarUrl),u.set("subject",e.data.Subject),u.set("longBody",e.data.Body),u.set("relativeDate",e.data.RelativeDate),u.set("author",e.data.PostAuthor),u.set("authorTitle",e.data.PostAuthor.UserProfile.Title),u.set("authorFullName",e.data.PostAuthor.UserProfile.FirstName+" "+e.data.PostAuthor.UserProfile.LastName),u.set("replySocialMessage",e.data.SocialInfo?CommunityApp.common.formatSocialMessage(e.data.SocialInfo):""),CommunityApp.common.logTitle("Thread Post Reply To: "+e.data.Subject),e.data.PostAttachments&&"undefined"!=typeof e.data.PostAttachments&&null!==e.data.PostAttachments&&e.data.PostAttachments.length>0?u.set("hasImageAttachment",e.data.PostAttachments[0].IsImage):u.set("hasImageAttachment",!1);var t=e.data.PostAttachments&&"undefined"!=typeof e.data.PostAttachments&&null!==e.data.PostAttachments&&e.data.PostAttachments.length>1;u.set("hasExtraAttachmentUrl",t),t&&u.set("isExtraImageAttachment",e.data.PostAttachments&&"undefined"!=typeof e.data.PostAttachments&&null!==e.data.PostAttachments&&e.data.PostAttachments[1].IsImage);var o=u.get("hasImageAttachment");e.data.PostAttachments&&"undefined"!=typeof e.data.PostAttachments&&null!==e.data.PostAttachments&&e.data.PostAttachments.length>0&&!o?u.set("hasNonImageAttachment",!e.data.PostAttachments[0].IsImage):u.set("hasNonImageAttachment",!1);var n=e.data.PostAttachments&&"undefined"!=typeof e.data.PostAttachments&&null!==e.data.PostAttachments&&e.data.PostAttachments.length>0?e.data.PostAttachments[0].FileUrl:"";u.set("attachmentUrl",n);var a=e.data.PostAttachments&&"undefined"!=typeof e.data.PostAttachments&&null!==e.data.PostAttachments&&e.data.PostAttachments.length>1?e.data.PostAttachments[1].FileUrl:"";u.set("extraAttachmentUrl",a),u.set("dataBound",!0),setTimeout(function(){var e=$("#ca-thread-post-reply .km-content").data("kendoMobileScroller");e.reset();var t=$("#reply-form textarea").offset().top;console.log("offset: "+t),t-=$("#ca-thread-post-reply header").height()+10,e.scrollTo(0,-t),$("#txtPostReply").focus(),$("#txtPostReply").focus(function(){e.reset(),$("#reply-form .clearspace").css("height",0);var t=$(window).height()-$("#reply-form").height()-$("#ca-thread-post-reply header").height()-$("#ca-thread-post-reply footer").height();$("#reply-form .clearspace").css("height",t),e.reset();var o=$("#reply-form textarea").offset().top;console.log("offset: "+o),o-=$("#ca-thread-post-reply header").height()+10,e.scrollTo(0,-o)}),$("#txtPostReply").click(function(){e.reset(),$("#reply-form .clearspace").css("height",0);var t=$(window).height()-$("#reply-form").height()-$("#ca-thread-post-reply header").height()-$("#ca-thread-post-reply footer").height();$("#reply-form .clearspace").css("height",t),e.reset();var o=$("#reply-form textarea").offset().top;console.log("offset: "+o),o-=$("#ca-thread-post-reply header").height()+10,e.scrollTo(0,-o)})},500)}u.set("dataBound",!0)},selectResource:function(){var e={};e.senderView="#ca-thread-post-reply?postId="+u.get("postId")+"&threadId="+u.get("threadId")+"&level="+u.get("level")+"&sectionId="+u.get("sectionId")+"&subject="+u.get("subject"),e.postId=u.get("postId"),e.threadId=u.get("threadId"),e.level=u.get("level"),e.sectionId=u.get("sectionId"),e.subject=u.get("subject"),e.body=u.get("body"),e.senderObject="replyThread",CommunityApp.session.save(CommunityApp.configuration.giphyConfig.offlineStore,e);$("#select-resource-dialog").kendoWindow({modal:!0,width:300,resizable:!1,title:"Resource Selection",visible:!1,deactivate:function(e){}}).data("kendoWindow").center().open()},triggerUpload:function(e){u.set("forGiphy",!1),"giphyResource"===e?(u.set("forGiphy",!0),CommunityApp.common.navigateToView("#ca-select-giphy")):($("#attchUpload").click(),$("#attchUpload").change(function(){CommunityApp.common.readUrl(this,function(e,t){loadImage.parseMetaData(t,function(o){var n=document.getElementById("discussion-attachment-canvas"),a=n.getContext("2d");a.clearRect(0,0,n.width,n.height);var i=document.getElementById("discussion-attachment-canvas-reply-upload"),s=i.getContext("2d");s.clearRect(0,0,i.width,i.height);var r=new Image;if(o.exif){r.onload=function(){i.width="500",i.height=r.height/r.width*500,s.drawImage(r,0,0,r.width,r.height,0,0,i.width,i.height),a.drawImage(r,0,0,r.width,r.height,0,0,n.width,n.height)},u.set("orientation",o.exif.get("Orientation"));var l=loadImage(t,function(t){"function"==typeof t.toDataURL?(u.set("fileUrl",t.toDataURL()),r.src=t.toDataURL()):(u.set("fileUrl",e),r.src=e)},{orientation:u.get("orientation"),maxWidth:500,maxHeight:600});l||alert("not load image")}else u.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(u.set("fileUrl",e),r.onload=function(){i.width="500",i.height=r.height/r.width*500,a.drawImage(r,0,0,r.width,r.height,0,0,n.width,n.height),s.drawImage(r,0,0,r.width,r.height,0,0,i.width,i.height)},r.src=e):(u.set("fileUrl",e),r.onload=function(){a.drawImage(r,0,0,r.width,r.height,0,0,n.width,n.height)},r.src=e)}),u.set("hideIcon",!1)})}))},reply:function(){u.set("processing",!0);var e=u.get("body"),t=CommunityApp.base.baseData.currentUser().id,n=u.get("threadId"),a=u.get("postId"),i=u.get("level"),s=u.get("sectionId"),r=u.get("subject");if(""===e)navigator.notification.alert("Reply body is required",function(){},"Please Note:"),c();else{var l=o(t,n,a),d=new FormData,p=u.get("selectedFixedWidthGiphy");if(""===p){var m;""===u.get("orientation")?"undefined"!==$("#attchUpload")[0].files[0]&&"undefined"!=typeof $("#attchUpload")[0].files[0]&&($("#attchUpload")[0].files[0].size>1048576?(m=document.getElementById("discussion-attachment-canvas-reply-upload").toDataURL("image/jpeg"),d.append("file",CommunityApp.common.dataURItoBlob(m))):d.append("file",$("#attchUpload")[0].files[0])):(m=document.getElementById("discussion-attachment-canvas-reply-upload").toDataURL("image/jpeg"),d.append("file",CommunityApp.common.dataURItoBlob(m))),d.append("data",JSON.stringify({ReplySubject:r,ReplyHtmlBody:e,ReplySectionId:s,ParentPostLevel:i,ReplyParentPostId:a,ReplyThreadId:n}))}else d.append("data",JSON.stringify({ReplySubject:r,ReplyHtmlBody:e,ReplySectionId:s,ParentPostLevel:i,ReplyParentPostId:a,ReplyThreadId:n,FileUrl:p}));var f={url:l,requestType:"POST",dataType:"JSON",callBack:u.fnReplyCallback,data:d};CommunityApp.dataAccess.callService(f,null,null,!0,!1,!1)}},fnReplyCallback:function(e){if(console.log("REPLY RESPONSE: "+JSON.stringify(e)),e.data)if(200===e.data.HttpStatus){var t=e.data.AdditionalData;t>0?CommunityApp.common.navigateToView("ca-thread-discussion?threadId="+t):(CommunityApp.common.showErrorNotification("Error","Reply already exists"),c())}else CommunityApp.common.showErrorNotification("Error!","Unexpected error occurred!");u.set("processing",!1)},suggest:function(e,t,o){CommunityApp.sounds.suggest();var a=CommunityApp.base.baseData.currentUser().id,i=$("#ca-thread-qa").data("kendoMobileView").params.threadId,s=n(a,i,e),r={url:s,requestType:"POST",dataType:"JSON",callBack:u.suggestCallback,data:"="+t,sender:o};CommunityApp.dataAccess.callService(r)},suggestCallback:function(e,t){if(200===e.data.HttpStatus){var o=($(t).attr("data-id"),$(t).attr("data-suggest")),n=CommunityApp.base.baseData.currentUser();n.id,n.username;"true"==o?($(t).closest("li").removeClass("display-block"),$(t).closest("li").addClass("display-none"),$(t).closest("li").siblings(".unsuggest").removeClass("display-none"),$(t).closest(".discussion-item").find(".callout-1").addClass("suggested"),$(t).closest(".discussion-item").find(".arrow-up").addClass("suggested")):($(t).closest("li").removeClass("display-block"),$(t).closest("li").addClass("display-none"),$(t).closest("li").siblings(".suggest").removeClass("display-none"),$(t).closest(".discussion-item").find(".callout-1").removeClass("suggested"),$(t).closest(".discussion-item").find(".arrow-up").removeClass("suggested"),$(t).closest(".discussion-item").find(".suggestedby").addClass("display-none"))}else CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")},verify:function(e,t,o){CommunityApp.sounds.verify();var n=CommunityApp.base.baseData.currentUser().id,i=$("#ca-thread-qa").data("kendoMobileView").params.threadId,s=a(n,i,e),r={url:s,requestType:"POST",dataType:"JSON",callBack:u.verifyCallback,data:"="+t,sender:o};CommunityApp.dataAccess.callService(r)},verifyCallback:function(e,t){if(200===e.data.HttpStatus){var o=($(t).attr("data-id"),$(t).attr("data-verify")),n=CommunityApp.base.baseData.currentUser();n.id,n.username;"true"==o?($(t).closest("li").removeClass("display-block"),$(t).closest("li").addClass("display-none"),$(t).closest("li").siblings(".unverify").removeClass("display-none"),$(t).closest("li").siblings(".unsuggest").addClass("display-none"),$(t).closest("li").siblings(".suggest").addClass("display-none"),$(t).closest(".discussion-item").find(".callout-1").addClass("verified"),$(t).closest(".discussion-item").find(".arrow-up").addClass("verified"),$(t).closest(".discussion-item").find(".suggestedby").addClass("display-none")):($(t).closest("li").removeClass("display-block"),$(t).closest("li").addClass("display-none"),$(t).closest("li").siblings(".suggest").removeClass("display-none"),$(t).closest("li").siblings(".verify").removeClass("display-none"),$(t).closest("li").siblings(".unsuggest").addClass("display-none"),$(t).closest("li").siblings(".unverify").addClass("display-none"),$(t).closest(".discussion-item").find(".callout-1").removeClass("verified"),$(t).closest(".discussion-item").find(".arrow-up").removeClass("verified"),$(t).closest(".discussion-item").find(".callout-1").removeClass("suggested"),$(t).closest(".discussion-item").find(".arrow-up").removeClass("suggested"),$(t).closest(".discussion-item").find(".verifiedby").addClass("display-none"),$(t).closest(".discussion-item").find(".suggestedby").addClass("display-none"))}else CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")},onTyping:function(){var e=$("#ca-thread-post-reply .km-content").data("kendoMobileScroller"),t=$(window).height()-($("#reply-form").height()-$("#reply-form .clearspace").height())-$("#ca-thread-post-reply header").height()-$("#ca-thread-post-reply footer").height();$("#reply-form .clearspace").css("height",t),e.reset();var o=$("#reply-form textarea").offset().top;o-=$("#ca-thread-post-reply header").height()+10,e.scrollTo(0,-o)},onFinishedType:function(e){u.set("typing",!1)},loadPollData:function(e){u.set("hasPoll",!0),null===e.Description||""===e.Description?u.set("pollDescription",e.Name):u.set("pollDescription",e.Description),0===e.NumberOfAnswers?u.set("pollAnsweredUserCountText","No one answered this."):1===e.NumberOfAnswers?u.set("pollAnsweredUserCountText","1 user answered this."):u.set("pollAnsweredUserCountText",e.NumberOfAnswers+" users answered this.");var t=kendo.template($("#poll-item-tmpl").html()),o=kendo.render(t,e.PollItems);if($("#discussion-poll-items-list").find(".poll-item-fieldlist").empty(),$("#discussion-poll-items-list").find(".poll-item-fieldlist").attr("style",""),$("#discussion-poll-items-list").find(".poll-item-fieldlist").append(o),e.AlreadyAnswered===!0){var n=r(e.Id),a={url:n,requestType:"GET",dataType:"JSON",callBack:u.loadPollGraphCallback},i=e;CommunityApp.dataAccess.callService(a,null,null,null,null,null,function(){u.loadPollData(i)}),u.set("unansweredPoll",!1)}else u.set("unansweredPoll",!0)},loadPollGraphCallback:function(e){if(e.data){for(var t=e.data,o=[],n=0;n<t.length;n++){var a={};a.category=t[n].Name,a.value=t[n].Value,a.color=t[n].Color,o.push(a)}$("#discussion-poll-chart").kendoChart({title:{text:"",visible:!1},legend:{visible:!1},chartArea:{background:"",width:250,height:250},seriesDefaults:{labels:{visible:!1,background:"transparent",position:"insideEnd",template:"#= kendo.format('{0:P}', percentage)#"}},series:[{type:"pie",startAngle:0,data:o}]});var i=kendo.template($("#poll-legend-item-tmpl").html()),s=kendo.render(i,t);$("#discussion-poll-legend").find(".poll-legend").empty(),$("#discussion-poll-legend").find(".poll-legend").attr("style",""),$("#discussion-poll-legend").find(".poll-legend").append(s),u.set("showChart",!0)}},vote:function(){var e=l(),t=CommunityApp.base.baseData.currentUser().id,o=u.get("poll").Id,n=$("#discussion-poll-vote-form input[name=pollItem]:checked").val();if("undefined"==typeof n)return CommunityApp.common.showErrorNotification("Error!","Please select one of the answers!"),void d();console.log(o),console.log($("#discussion-poll-vote-form input[name=pollItem]:checked").val());var a={userId:t,pollId:o,vote:n};console.log("vote: "+n+" pollId: "+o+" userId: "+t);var i={url:e,requestType:"POST",dataType:"JSON",data:a,callBack:u.fnVoteToPollCallback};CommunityApp.dataAccess.callService(i)},fnVoteToPollCallback:function(e){if(console.log("voteCallback: "),console.log(e),e.data&&e.data>0){CommunityApp.common.showSuccessNotification("Posted your vote successfully!");var t=u.get("poll");t.AlreadyAnswered=!0,t.HasNoAnswers=!1,t.NumberOfAnswers+=1,u.loadPollData(t)}else CommunityApp.common.showErrorNotification("Unexpected Error!","Unexpected error occurred. Try again later!"),d()},mute:function(e){var o=e.checked,n=CommunityApp.base.baseData.currentUser().id,a=$("#ca-thread-discussion").data("kendoMobileView").params.threadId,i=t(n,a),s={url:i,requestType:"POST",dataType:"JSON",data:"="+o,callBack:u.fnMuteCallback,sender:{mute:o}};CommunityApp.dataAccess.callService(s)},fnMuteCallback:function(e,t){e&&e.data&&200==e.data.HttpStatus&&(t.mute?CommunityApp.common.showSuccessNotification("Stopped successfully!"):CommunityApp.common.showSuccessNotification("Unmuted successfully!"))},loadMute:function(e){var o=e.view.params.threadId,n=CommunityApp.base.baseData.currentUser().id,a=t(n,o),i={url:a,requestType:"GET",dataType:"JSON",callBack:u.fnLoadMuteCallback};CommunityApp.dataAccess.callService(i)},fnLoadMuteCallback:function(e){e&&e.data&&u.set("isMuted",e.data.Mute)}});return{viewModel:u}}(),CommunityApp.thread=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.threadPath;return CommunityApp.utilities.stringFormat(o,e,t)},t=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.subscribePath;return CommunityApp.utilities.stringFormat(o,e,t)},o=kendo.observable({id:0,totalReplies:0,status:"",type:"",isRead:!1,subject:"",sectionId:0,sectionName:"",followers:0,views:0,isFollowed:!1,sectionPage:function(e){return e+o.get("sectionId")},threadPage:function(){var e=o.get("type").toLowerCase(),t="discussion"===e?"#ca-thread-discussion?threadId=":"#ca-thread-qa?threadId=";return t+o.get("id")},load:function(t){var n=t.view.params.threadId,a=CommunityApp.base.baseData.currentUser().id,i=e(a,n),s={url:i,requestType:"GET",dataType:"JSON",callBack:o.fnLoadThreadCallback},r=t;CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){o.load(r)})},fnLoadThreadCallback:function(e){e.data&&(o.set("id",e.data.Id),o.set("totalReplies",e.data.TotalReplies),o.set("status",e.data.Status),o.set("type","discussion"===e.data.Type.toLowerCase()?"Discussion":"Question and Answers"),o.set("isRead",e.data.IsReadByCurrentUser),o.set("subject",e.data.Subject),o.set("sectionId",e.data.ThreadSection.Id),o.set("sectionName",e.data.ThreadSection.Name),o.set("followers",e.data.Followers),o.set("views",e.data.TotalViews),o.set("isFollowed",e.data.IsFollowed),CommunityApp.common.logTitle("Thread: "+e.data.Subject))},follow:function(e){var n=o.get("id"),a=CommunityApp.base.baseData.currentUser().id,i=e.checked,s=t(a,n),r={url:s,requestType:"POST",dataType:"JSON",data:"="+i,callBack:o.fnSubscribeCallback};CommunityApp.dataAccess.callService(r)},fnSubscribeCallback:function(e){if(e.data){var t=e.data.AdditionalData;switch(e.data.HttpStatus){case 200:"true"===t.toLowerCase()?CommunityApp.common.showSuccessNotification("Followed successfully!"):CommunityApp.common.showSuccessNotification("Unfollowed successfully!");break;default:"true"===t.toLowerCase()?CommunityApp.common.showErrorNotification("Unexpected error following this thread!"):CommunityApp.common.showErrorNotification("Unexpected error unfollowing this thread!")}}}});return{viewModel:o}}(),CommunityApp.about=function(){var e=kendo.observable({version:"",appName:"",website:"",load:function(){CommunityApp.common.logTitle("About"),cordova.getAppVersion(function(t){e.set("version",t)}),e.set("appName",CommunityApp.configuration.appConfig.appTitle),e.set("website","http://"+CommunityApp.configuration.appConfig.domain)},gotoWebsite:function(){cordova.InAppBrowser.open(encodeURI(e.get("website")),"_blank","location=no")}});return{viewModel:e}}(),CommunityApp.assessmentResult=function(){var e=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.assessmentResultPath;return console.log("assessment result service url:"+a),CommunityApp.utilities.stringFormat(a,e,t,o,n)},t=kendo.observable({result:null,dataBound:!1,load:function(e){var t=e.view.params.courseId,n=e.view.params.testId,a=e.view.params.userTestId,i=e.view.params.userId;o(t,n,a,i),CommunityApp.common.disableBackButton()},onHide:function(e){console.log("data hide event"),CommunityApp.common.enableBackButton()},fnLoadAssessmentResultCallBack:function(e,o){console.log("assessment result callback"),e.data&&(t.set("dataBound",!0),t.set("result",e.data))},fnFillView:function(){var e=t.get("result");if(null!==e){var o="";if(e.ContainsFillInAnswer)o+='<div class="assessment-result-margin assessment-result-success">You have successfully completed '+e.AssessmentName+'. we will review it and update your result soon.<br><br> <a href="#views/learning/categories.html?type=required">Return to Learning</a></div>';else if(e.Passed)o+='<div class="assessment-result-margin assessment-result-success">Congratulations you have successfully passed '+e.AssessmentName+'.<br><br> <a href="#views/learning/categories.html?type=required">Return to Learning</a></div>';else{o+="<div class='assessment-result-margin'>Sorry you didn't pass "+e.AssessmentName+" successfully.</div>",o+="<div class='assessment-result-margin'>You currently have "+e.Correct+" out of "+e.Total+" questions correct!</div>",o+="<div class='assessment-result-margin'>Please take a closer look at these questions:</div>",o+="<div class='assessment-result-margin'>";for(var n=0;n<e.WrongAnswers.length;n++)o+="<div class='assessment-result-questions'>"+e.WrongAnswers[n]+"</div>";o+='</div><div class="assessment-result-margin"><a onclick="CommunityApp.assessmentResult.viewModel.assessmentPage();"><span class="assessment-result-retake">Click here</span></a> to retake '+e.AssessmentName+" again.</div>"}return o}return""},coursePage:function(e){var o=(t.get("result"),"#views/learning/assessment.html");CommunityApp.common.navigateToView(o+"?courseId="+courseId+"&testId="+e+"&userTest=0&question=0")},assessmentPage:function(e){var o=t.get("result"),n="#views/learning/assessment.html";CommunityApp.common.navigateToView(n+"?courseId="+o.CourseId+"&testId="+o.AssessmentId+"&userTest=0&question=0")}}),o=function(n,a,i,s){t.set("dataBound",!1);var r=e(n,a,i,s),l={url:r,requestType:"GET",dataType:"JSON",callBack:t.fnLoadAssessmentResultCallBack},c=n,d=a,u=i,p=s;CommunityApp.dataAccess.callService(l,"result","<h2 class='centerAlign padding-1'>No result has been found!</h2>",null,null,null,function(){o(c,d,u,p)})};return{viewModel:t}}(),CommunityApp.assessmentQuestions=function(){var e=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.assessmentsPath;return console.log("assessment service url:"+a),CommunityApp.utilities.stringFormat(a,e,t,o,n)},t=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.saveAssessmentsPath;return console.log("save question service url:"+e),CommunityApp.utilities.stringFormat(e)},o=kendo.observable({question:null,courseId:0,testId:0,userTestId:0,dataBound:!1,load:function(e){var t=e.view.params.courseId,a=e.view.params.testId,i=e.view.params.userTest,s=e.view.params.question;o.set("courseId",t),o.set("testId",a),o.set("userTestId",i),n(t,a,i,s,e.view),i>0&&($("#ca-course-assessments").addClass("no-backbutton"),CommunityApp.common.disableBackButton())},onHide:function(e){console.log("data hide event"),CommunityApp.common.enableBackButton()},fnLoadAssessmentQuestionsCallBack:function(e,t){e.data&&(o.set("dataBound",!0),o.set("question",e.data),t.scroller.reset())},fnFillView:function(){var e=o.get("question");if(null!==e){var t="<li class='question-li'><span class='question-label'>"+e.Name+"</span></li>";if(t+="<div class='question-answers'>",1==e.Kind)t+="<input id='textAnswer' type='text'><div id='textAnswer_error'><label style='color:red;' style='display:none;'>Please enter an answer.</label></div>";else if(2==e.Kind){for(var n=0;n<e.Answers.length;n++)t+="<input id='rdbtn_"+e.Answers[n].Id+"' type='radio' class='radio-question-btn' onclick='CommunityApp.assessmentQuestions.viewModel.onRadioButtonClick(\""+e.Answers[n].InCorrect+"\");' name='radioAnswer' value='"+e.Answers[n].Id+"' /><label for='rdbtn_"+e.Answers[n].Id+"' class='radio-question-label'>"+e.Answers[n].Answer+"</label>";t+="<div id='rdbtn_error' style='display:none;'><label style='color:red;'>Please select answer.</label></div>",t+="<div id='rdbtn_incorrect_container' style='display:none;'><label style='color:red;' id='rdbtn_incorrect'></label></div>"}else{for(var a=0;a<e.Answers.length;a++)t+="<input id='chkbtn_"+e.Answers[a].Id+"' type='checkbox' class='check-question-btn' onclick='CommunityApp.assessmentQuestions.viewModel.onCheckButtonClick(\""+e.Answers[a].InCorrect+"\", this);' name='chkAnswer' value='"+e.Answers[a].Id+"' /><label for='chkbtn_"+e.Answers[a].Id+"' class='check-question-label'>"+e.Answers[a].Answer+"</label>";t+="<div id='chkbtn_error' style='display:none;'><label style='color:red;'>Please select At least One answer.</label></div>",t+="<div id='chkbtn_incorrect_container' style='display:none;'><label style='color:red;' id='chkbtn_incorrect'></label></div>"}return t+="<div>",e.NextQuestionId?t+="<button id='btnNext' class='question-button btn btn-primary bg-black pull-right' data-role='button' onclick='CommunityApp.assessmentQuestions.viewModel.onNextQuestionClick();'>Next</button>":(console.log("creating finish quiz buttton"),t+="<button  id='btnNext' class='question-button btn btn-primary bg-black pull-right' data-role='button' onclick='CommunityApp.assessmentQuestions.viewModel.onNextQuestionClick();'>Finish</button>"),t+="<button id='btnExit' class='question-button btn btn-primary bg-black pull-left' data-role='button' onclick='CommunityApp.assessmentQuestions.viewModel.onExitClick();'>Exit</button>",t+="</div><div class='clearfix'></div>"}return""},onNextQuestionClick:function(e){console.log("Next Question Button Clicked"),$("#btnNext").attr("disabled","disabled");var n="",a=!1,i=o.get("question");if(console.log("question kind = "+i.Kind),1==i.Kind?$("#textAnswer").val()&&$("#textAnswer").val().length>0?($("#textAnswer_error").hide(),a=!0,console.log("Is valid to save answer : "+a),n=$("#textAnswer").val()):($("#textAnswer_error").show(),a=!1,console.log("Is valid to save answer : "+a)):2==i.Kind?"0"==$("input[name='radioAnswer']:checked").length?($("#rdbtn_error").show(),a=!1,console.log("Is valid to save answer : "+a)):($("#rdbtn_error").hide(),a=!0,console.log("Is valid to save answer : "+a),n=$("input[name='radioAnswer']:checked").val(),console.log("Question answer : "+n)):"0"==$("input[name='chkAnswer']:checked").length?($("#chkbtn_error").show(),a=!1,console.log("Is valid to save answer : "+a)):($("#chkbtn_error").hide(),a=!0,console.log("Is valid to save answer : "+a),$('input[name="chkAnswer"]:checked').each(function(){n+=this.value+","}),n=n.slice(0,-1)),a){var s=t(),r={url:s,requestType:"POST",dataType:"JSON",callBack:o.saveQuestionAnswerCallback,data:{CourseId:o.get("courseId"),TestId:o.get("testId"),UserTestId:o.get("userTestId"),QuestionId:i.Id,NextQuestionId:i.NextQuestionId,Kind:i.Kind,Answers:n}};CommunityApp.dataAccess.callService(r)}else $("#btnNext").removeAttr("disabled")},onExitClick:function(e){var t="#views/learning/categories.html?type=required";CommunityApp.common.navigateToView(t)},saveQuestionAnswerCallback:function(e){if(e.data.Saved){var t=o.get("question"),n="";t.NextQuestionId?(n="#views/learning/assessment.html",CommunityApp.common.navigateToView(n+"?courseId="+t.CourseId+"&testId="+t.TestId+"&userTest="+e.data.UserTestId+"&question="+t.NextQuestionId)):(console.log("Assessment Finished"),n="#views/learning/assessmentresult.html",CommunityApp.common.navigateToView(n+"?courseId="+t.CourseId+"&testId="+t.TestId+"&userTestId="+t.UserTestId+"&userId="+e.data.UserId))}else console.log("failed to save answer")},onRadioButtonClick:function(e){e?($("#rdbtn_incorrect").html(e),$("#rdbtn_incorrect_container").show()):$("#rdbtn_incorrect_container").hide()},onCheckButtonClick:function(e,t){console.log("incorrect MSG status "+e)}}),n=function(t,n,a,i,s){o.set("dataBound",!1);var r=e(t,n,a,i),l={url:r,requestType:"POST",dataType:"JSON",callBack:o.fnLoadAssessmentQuestionsCallBack,sender:s};CommunityApp.dataAccess.callService(l,"question","<h2 class='centerAlign padding-1'>No questions are found!</h2>")};return{viewModel:o}}(),CommunityApp.learningCategories=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.categoriesPath;return CommunityApp.utilities.stringFormat(o,e,t)},t=kendo.observable({categories:[],channel:"required",sortType:1,dataBound:!1,buttonText:function(){return"required"==t.get("channel")?"Switch to Optional Categories":"Switch to Required Categories"},load:function(e){t.set("dataBound",!1);var n=1;t.set("channel",e.view.params.type),$("#sort-form").kendoMobileButtonGroup({select:function(e){n=$(e.sender.element).find(".km-state-active").data("val"),t.set("sortType",n),o(n,t.get("channel"))},index:0});var a=$("#learning-categories-scroller").data("kendoMobileScroller");a.reset(),o(n,t.get("channel")),$("#ca-learning-categories:last-child").addClass("display-none"),$("#ca-learning-categories").eq(0).removeClass("display-none")},fnLoadCategoriesCallBack:function(e,o){var n=CommunityApp.common.injectValue(e.data,"Type",o.type);t.set("categories",n),t.set("dataBound",!0)},switchCategories:function(){var e=t.get("channel");e="required"==e?"optional":"required",CommunityApp.common.navigateToView("views/learning/categories.html?type="+e)}}),o=function(n,a){var i=e(n,a),s={url:i,requestType:"GET",dataType:"JSON",callBack:t.fnLoadCategoriesCallBack,sender:{type:a}},r=n,l=a;CommunityApp.dataAccess.callService(s,"categories-list","<h2 class='centerAlign padding-1'>No categories are found!</h2>",null,null,null,function(){o(r,l)})};return{viewModel:t}}(),CommunityApp.categoryCurriculums=function(){var e=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.curriculumsPath;return CommunityApp.utilities.stringFormat(a,e,t,o,n)},t=kendo.observable({categoryCurriculums:[],channel:"required",sortType:1,hideCompleted:!1,categoryId:0,dataBound:!1,buttonText:function(){return"required"==t.get("channel")?"Switch to Optional Curriculums":"Switch to Required Curriculums"},load:function(e){t.set("dataBound",!1),t.set("channel",e.view.params.type);var n=e.view.params.categoryId;t.set("categoryId",n);var a=1,i=t.get("channel"),s=t.get("hideCompleted");$("#sort-form-curriculums").kendoMobileButtonGroup({select:function(e){a=$(e.sender.element).find(".km-state-active").data("val"),t.set("sortType",a),o(a,t.get("channel"),t.get("categoryId"),t.get("hideCompleted"))},index:0});var r=$("#curriculums-scroller").data("kendoMobileScroller");r.reset(),o(a,i,n,s),$("#ca-category-curriculums:last-child").addClass("display-none"),$("#ca-category-curriculums").eq(0).removeClass("display-none")},fnLoadCurriculumsCallBack:function(e,o){e.data=CommunityApp.common.injectValue(e.data,"CategoryId",o.CategoryId),e.data=CommunityApp.common.injectValue(e.data,"Type",o.Type),t.set("categoryCurriculums",e.data),t.set("dataBound",!0)},switchCurriculums:function(){var e=t.get("channel");e="required"==e?"optional":"required",CommunityApp.common.navigateToView("views/learning/curriculums.html?categoryId="+t.get("categoryId")+"&type="+e)},hideCompletedCurriculums:function(e){var n=e.checked;t.set("hideCompleted",n),o(t.get("sortType"),t.get("channel"),t.get("categoryId"),t.get("hideCompleted"))}}),o=function(n,a,i,s){var r=e(n,a,i,s),l={url:r,requestType:"GET",dataType:"JSON",callBack:t.fnLoadCurriculumsCallBack,sender:{CategoryId:t.get("categoryId"),Type:t.get("channel")}},c=n,d=a,u=i,p=s;CommunityApp.dataAccess.callService(l,"curriculums-list","<h2 class='centerAlign padding-1'>No categories are found!</h2>",null,null,null,function(){o(c,d,u,p)})};return{viewModel:t}}(),CommunityApp.courseLessons=function(){var e=function(e,t,o,n,a,i){var s=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.lessonsPath;return CommunityApp.utilities.stringFormat(s,e,t,o,n,a,i)},t=function(e,t,o,n,a,i,s){var r=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.assignTestPath;
return CommunityApp.utilities.stringFormat(r,e,t,o,n,a,i,s)},o=function(e,t,o,n,a,i,s,r){var l=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.finishTestPath;return CommunityApp.utilities.stringFormat(l,e,t,o,n,a,i,s,r)},n=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.scormPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},a=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.finishPdfLessonPath;return CommunityApp.utilities.stringFormat(t,e)},i=kendo.observable({courseLessons:[],categoryId:0,curriculumId:0,courseId:0,channel:"required",sortType:1,hideCompleted:!1,dataBound:!1,buttonText:function(){return"required"==i.get("channel")?"Switch to Optional Lessons":"Switch to Required Lessons"},load:function(e){var t=e.view.params.categoryId,o=e.view.params.curriculumId,n=e.view.params.courseId;t||(t=0),o||(o=0),i.set("categoryId",t),i.set("curriculumId",o),i.set("courseId",n);var a=i.get("sortType"),r=i.get("channel"),l=i.get("hideCompleted");$("#sort-form-lessons").kendoMobileButtonGroup({select:function(e){a=$(e.sender.element).find(".km-state-active").data("val"),i.set("sortType",a),s(a,i.get("channel"),i.get("categoryId"),i.get("hideCompleted"),i.get("curriculumId"),i.get("courseId"))},index:0});var c=e.view.scroller;c.reset(),"undefined"!==a&&"undefined"!=typeof a&&"undefined"!==r&&"undefined"!=typeof r&&"undefined"!==t&&"undefined"!=typeof t&&"undefined"!==l&&"undefined"!=typeof l&&"undefined"!==o&&"undefined"!=typeof o&&"undefined"!==n&&"undefined"!=typeof n&&s(a,r,t,l,o,n),$("#ca-course-lessons:last-child").addClass("display-none"),$("#ca-course-lessons").eq(0).removeClass("display-none")},fnLoadLessonsCallBack:function(e){e.data&&(i.set("dataBound",!0),e.data=CommunityApp.common.injectValue(e.data,"Type",i.get("channel")),i.set("courseLessons",e.data),$("input[name='player']").each(function(){function e(e){l(s,i.get("sortType"),i.get("channel"),i.get("categoryId"),i.get("hideCompleted"),i.get("curriculumId"),i.get("courseId"),o)}function t(e){r(s,i.get("sortType"),i.get("channel"),i.get("categoryId"),i.get("hideCompleted"),i.get("curriculumId"),i.get("courseId"),o)}var o=$(this).val(),n="#vplayer"+o,a=$(n)[0],s=$(this).next(),c=$f(a);c.addEvent("ready",function(){c.addEvent("finish",e),c.addEvent("play",t)})}))},switchLessons:function(){var e=i.get("channel");e="required"==e?"optional":"required",i.set("channel",e),s(i.get("sortType"),i.get("channel"),i.get("categoryId"),i.get("hideCompleted"),i.get("curriculumId"),i.get("courseId"))},page:function(e){var t=i.get("courseId"),o="#views/learning/assessment.html";CommunityApp.common.navigateToView(o+"?courseId="+t+"&testId="+e+"&userTest=0&question=0")},viewscorm:function(e){var t=$(e.target).data("lessonid"),o=$(e.target).data("scorm"),a=$(e.target).data("type"),s=n(o,t,a);console.log("SCORM Service URL: "+s);var r={url:s,requestType:"GET",dataType:"JSON",callBack:i.viewScormCallback},l=e;CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){i.viewscorm(l)})},viewScormCallback:function(e){if(e.data){var t=e.data,o="http://"+CommunityApp.configuration.appConfig.domain+t;console.log("SCORM URL: "+o),cordova.InAppBrowser.open(encodeURI(o),"_blank","location=no")}},pdfLoaded:function(e){console.log("pdf lesson id = "+e);var t=a(e),o={url:t,requestType:"POST",dataType:"JSON"};CommunityApp.dataAccess.callService(o)},openPDF:function(e){var t=$(e.target).data("pdfurl"),o=$(e.target).data("lessonid");CommunityApp.common.openFile(t,function(){i.pdfLoaded(o)})},hideCompletedLessons:function(e){var t=e.checked;i.set("hideCompleted",t),s(i.get("sortType"),i.get("channel"),i.get("categoryId"),i.get("hideCompleted"),i.get("curriculumId"),i.get("courseId"))},fnAssignLessonCallBack:function(e,t){e.data&&$(t).val(e.data)},fnFinishLessonCallBack:function(e,t){e.data&&$(t).val("")}}),s=function(t,o,n,a,r,l){i.set("dataBound",!1);var c=e(t,o,n,a,r,l),d={url:c,requestType:"GET",dataType:"JSON",callBack:i.fnLoadLessonsCallBack},u=t,p=o,m=n,f=a,g=r,h=l;CommunityApp.dataAccess.callService(d,"lessons-list","<h2 class='centerAlign padding-1'>No course materials are found!</h2>",null,null,null,function(){s(u,p,m,f,g,h)})},r=function(e,o,n,a,s,r,l,c){var d=t(o,n,a,s,r,l,c),u={url:d,requestType:"POST",dataType:"JSON",callBack:i.fnAssignLessonCallBack,sender:e};CommunityApp.dataAccess.callService(u)},l=function(e,t,n,a,s,r,c,d){var u=$(e).val(),p=o(t,n,a,s,r,c,d,u),m={url:p,requestType:"PUT",dataType:"JSON",callBack:i.fnFinishLessonCallBack,sender:e},f=e,g=t,h=n,y=a,v=s,C=r,A=c,b=d;CommunityApp.dataAccess.callService(m,null,null,null,null,null,function(){l(f,g,h,y,v,C,A,b)})};return{viewModel:i}}(),CommunityApp.curriculumCourses=function(){var e=function(e,t,o,n,a){var i=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.coursesPath;return CommunityApp.utilities.stringFormat(i,e,t,o,n,a)},t=kendo.observable({courses:[],channel:"required",sortType:1,hideCompleted:!1,categoryId:0,curriculumId:0,dataBound:!1,buttonText:function(){return"required"==t.get("channel")?"Switch to Optional Courses":"Switch to Required Courses"},load:function(e){t.set("dataBound",!1);var n=e.view.params.type;n||(n="required"),t.set("channel",n);var a=e.view.params.categoryId;a||(a=0);var i=e.view.params.curriculumId;t.set("categoryId",a),t.set("curriculumId",i);var s=1,r=t.get("channel"),l=t.get("hideCompleted");$("#sort-form-courses").kendoMobileButtonGroup({select:function(e){s=$(e.sender.element).find(".km-state-active").data("val"),t.set("sortType",s),o(s,t.get("channel"),t.get("categoryId"),t.get("hideCompleted"),t.get("curriculumId"))},index:0});var c=$("#courses-scroller").data("kendoMobileScroller");c.reset(),o(s,r,a,l,i),$("#ca-curriculum-courses:last-child").addClass("display-none"),$("#ca-curriculum-courses").eq(0).removeClass("display-none")},fnLoadCoursesCallBack:function(e,o){e.data=CommunityApp.common.injectValue(e.data,"CategoryId",o),t.set("courses",e.data),t.set("dataBound",!0)},switchCourses:function(){var e=t.get("channel");e="required"==e?"optional":"required",CommunityApp.common.navigateToView("views/learning/courses.html?curriculumId="+t.get("curriculumId")+"&categoryId="+t.get("categoryId")+"&type="+e)},hideCompletedCourses:function(e){var n=e.checked;t.set("hideCompleted",n),o(t.get("sortType"),t.get("channel"),t.get("categoryId"),t.get("hideCompleted"),t.get("curriculumId"))}}),o=function(n,a,i,s,r){var l=e(n,a,i,s,r),c={url:l,requestType:"GET",dataType:"JSON",callBack:t.fnLoadCoursesCallBack,sender:t.get("categoryId")},d=n,u=a,p=i,m=s,f=r;CommunityApp.dataAccess.callService(c,"courses-list","<h2 class='centerAlign padding-1'>No courses are found!</h2>",null,null,null,function(){o(d,u,p,m,f)})};return{viewModel:t}}(),CommunityApp.learning=function(){var e=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.featuredLearningPath},t=kendo.observable({load:function(o){console.log("load triggered");var n=e(),a=o,i=CommunityApp.dataAccess.kendoDataSource(1,10,n,"GET",null,"featured-learning-listview","<h2 class='centerAlign padding-1'>No featured learning videos are found yet!</h2>",null,function(){t.load(a)}),s=$("#featured-learning-listview").data("kendoMobileListView");s.setDataSource(i),s.dataSource.read(),s.refresh(),$(".km-load-more").remove()},likeSuccessCallback:function(e,t,o){var n=$("#featured-learning-listview").data("kendoMobileListView"),a=n.dataSource.data(),i=$(o).data("id"),s=_.find(a,function(e){return e.Id==i}),r=_.indexOf(a,s),l=n.dataSource.at(r);"like"==e?(l.SocialInfo.LikesCount=t,l.SocialInfo.UserLiked=!0):(l.SocialInfo.LikesCount=t,l.SocialInfo.UserLiked=!1),n.setDataItem($(o).closest("ul").closest("li").find(".feed-article"),l)}});return{viewModel:t}}(),CommunityApp.learningScore=function(){var e=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.scorePath;return e},t=kendo.observable({requiredScore:0,optionalScore:0,requiredPercentage:function(){return t.get("requiredScore")+"%"},optionalPercentage:function(){return t.get("optionalScore")+"%"},load:function(o){CommunityApp.common.logTitle("Learning Score");var n=e(),a={url:n,requestType:"GET",dataType:"JSON",callBack:t.fnLoadScoreCallback},i=o;CommunityApp.dataAccess.callService(a,null,null,null,null,null,function(){t.load(i)})},fnLoadScoreCallback:function(e){e.data&&(t.set("requiredScore",e.data.RequiredLearning),t.set("optionalScore",e.data.OptionalLearning))}});return{viewModel:t}}(),CommunityApp.scorm=function(){var e=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.learningConfig.learningPath+CommunityApp.configuration.learningConfig.scormPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},t=kendo.observable({scormUrl:"",scormAbsoluteUrl:function(){var e=t.get("scormUrl");return"http://"+CommunityApp.configuration.appConfig.domain+e},load:function(o){var n=o.view.params.scorm,a=o.view.params.lessonId,i=o.view.params.type,s=e(n,a,i),r={url:s,requestType:"GET",dataType:"JSON",callBack:t.fnLoadScormCallback},l=o;CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){t.load(l)}),$("#ca-scorm-lesson:last-child").addClass("display-none"),$("#ca-scorm-lesson").eq(0).removeClass("display-none")},fnLoadScormCallback:function(e){e.data&&t.set("scormUrl",e.data)}});return{viewModel:t}}(),CommunityApp.libraryScroller=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.postConfig.postPath,e,t);return o},t=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.postViewsPath;return CommunityApp.utilities.stringFormat(o,e,t)},o=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.deleteCommentPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},n=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.addCommentPath;return CommunityApp.utilities.stringFormat(o,e,t)},a=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.allFilesPath;return CommunityApp.utilities.stringFormat(a,e,t,o)+"?resizeFactor="+n},i=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.folderPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},s=function(){$("#imageCommentForm").unbind("submit"),$("#imageCommentForm").one("submit",function(){return $("button[type='submit']",this).html("Processing...").attr("disabled","disabled"),CommunityApp.libraryScroller.operations({addCommentSuccessCallback:CommunityApp.libraryScroller.viewModel.fnAddCommentCallback}).addComment($("#txtImageComment").val()),!0})},r=[],l=kendo.observable({title:"",description:"",folderId:0,libraryId:0,zoomedIn:!1,social:{},likesText:"",commentsText:"",showComments:!1,comments:[],commentsFound:!1,dataBound:!1,filePostId:0,imageUrl:"",activeIndex:0,author:{},page:function(e){return e+l.get("filePostId")+"&mode="+l.get("mode")},download:function(){console.log("ImageUrl: "+l.get("imageUrl"));var e=l.get("imageUrl"),t=e.substr(e.lastIndexOf("/")+1),o="Download";"android"===CommunityApp.common.deviceType()?o="Download":"iphone"!==CommunityApp.common.deviceType()&&"ipad"!==CommunityApp.common.deviceType()||(o="Download"),console.log("ImageName: "+t);var n=function(n){var i=n.root.toURL()+o+"/"+t;if($("#mainImagePageScroller").hide(),$('<div class="k-loading-mask" style="width: 100%; height: 100%; top: 0px; left: 0px;"><span class="k-loading-text">Downloading...</span><div class="k-loading-image"></div><div class="k-loading-color"></div></div>').appendTo("#ca-library-files-scroller .km-content"),"android"===CommunityApp.common.deviceType()){var s=cordova.plugins.permissions;s.hasPermission(s.WRITE_EXTERNAL_STORAGE,function(t){if(t.hasPermission)a(e,i);else{var o=function(){CommunityApp.common.showErrorNotification("Error!","Requires storage permission!")};s.requestPermission(s.WRITE_EXTERNAL_STORAGE,function(t){t.hasPermission?a(e,i):o()},o)}},null)}else"iphone"!==CommunityApp.common.deviceType()&&"ipad"!==CommunityApp.common.deviceType()||(i=n.root.toURL()+t,console.log(i),a(e,i))},a=function(e,t){var o=new FileTransfer;o.download(e,t,function(e){$("#ca-library-files-scroller .k-loading-mask").remove(),$("#mainImagePageScroller").show(),"iphone"===CommunityApp.common.deviceType()||"ipad"===CommunityApp.common.deviceType()?cordova.plugins.imagesaver.saveImageToGallery(e.toURL(),i,s):CommunityApp.common.showSuccessNotification("Downloaded successfully!")},function(e){$("#ca-library-files-scroller .k-loading-mask").remove(),$("#mainImagePageScroller").show(),CommunityApp.common.showErrorNotification("Error!","Requires storage permission!")})},i=function(){CommunityApp.common.showSuccessNotification("Downloaded successfully!")},s=function(){CommunityApp.common.showErrorNotification("Error!","Download Failed!")},r=function(e){CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")};return null===e||""===e?void CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!"):void window.requestFileSystem(LocalFileSystem.PERSISTENT,0,n,r)},comment:function(){if(l.get("showComments")===!1){l.set("showComments",!0);var o={},n=CommunityApp.base.baseData.currentUser().id,a=e(l.get("filePostId"),n),i=t(l.get("filePostId"),n),s={url:a,requestType:"GET",dataType:"JSON",callBack:l.fnCommentCallBack,sender:JSON.stringify(o)};CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){l.comment()});var r={url:i,requestType:"POST",dataType:"JSON"};console.log("postViewUrl: "+i),CommunityApp.dataAccess.callService(r)}},isAllowedToDeleteComment:function(e){var t=l.get("author"),o=CommunityApp.base.baseData.currentUser().id==e||CommunityApp.base.baseData.currentUser().id==t.Id;return o},load:function(e){$("#library-files-scrollview").find(".swiper-wrapper").empty(),$("#library-files-scrollview").find(".swiper-wrapper").attr("style",""),l.set("dataBound",!1),l.set("showComments",!1),s();var t=$("#txtImageComment"),o=e.view;if($("#imageCommentForm .clearfix").css("height",0),$("#ca-library-files-scroller").removeClass("zoomed-in"),$("#ca-library-files-scroller").css("background-image",""),$("#ca-library-files-scroller .full-download")&&$("#ca-library-files-scroller .full-download").remove(),l.set("zoomedIn",!1),t){console.log("commentform height: "+$("#add-imageComment-form").height());var n=$(window).height()-$("#imageCommentForm").height()-$("#ca-library-files-scroller header").height()-$("#ca-library-files-scroller footer").height()-$("#add-imageComment-form").height();t.val("");var r=$("#mainImagePageScroller").data("kendoMobileScroller");t.focus(function(){if(console.log("focus event, offset:"+$(this).offset().top+", header height:"+$("#ca-library-files-scroller header").height()),null!==r&&"undefined"!=typeof r&&r.reset(),"undefined"!=typeof o.scroller&&o.scroller.reset(),null!==r&&"undefined"!=typeof r){var e=$("#imageCommentForm").offset().top;e-=$("#ca-library-files-scroller header").height()+10,0===e&&(e=100),r.scrollTo(0,-e)}$("#imageCommentForm .clearfix").css("height",n)}),t.click(function(){if(console.log("click event, offset:"+$(this).offset().top+", header height:"+$("#ca-library-files-scroller header").height()),null!==r&&"undefined"!=typeof r&&r.reset(),"undefined"!=typeof o.scroller&&o.scroller.reset(),null!==r&&"undefined"!=typeof r){var e=$("#imageCommentForm").offset().top;e-=$("#ca-library-files-scroller header").height()+10,0===e&&(e=100),r.scrollTo(0,-e)}})}var c=e.view.params.folderId,d=e.view.params.libraryId;l.set("folderId",c),l.set("libraryId",d);var u=e.view.params.index,p=CommunityApp.base.baseData.currentUser().id;l.set("activeIndex",u);var m=i(p,d,c),f={url:m,requestType:"GET",dataType:"JSON",callBack:l.fnLoadFolderCallback},g=e;CommunityApp.dataAccess.callService(f,null,null,null,null,null,function(){l.load(g)});var h=a(p,d,c,.2),y={url:h,requestType:"GET",dataType:"JSON",callBack:l.fnLoadFilesCallback,sender:u};CommunityApp.dataAccess.callService(y,null,null,null,null,null,function(){l.load(g)})},fnLoadFolderCallback:function(e){e.data&&(CommunityApp.common.logTitle("Folder Scroller: "+e.data.Title),l.set("title",e.data.Title),l.set("description",e.data.Description))},fnLoadFilesCallback:function(e,t){if(e.data){var o,n=t;for(l.set("social",e.data[l.get("activeIndex")].MediaGalleryFilePost.SocialInfo),o=0;o<e.data.length;o++)e.data[o].socialMessage="",e.data[o].MediaGalleryFilePost.SocialInfo.LikesCount>1?e.data[o].socialMessage+=e.data[o].MediaGalleryFilePost.SocialInfo.LikesCount+" Likes   ":1==e.data[o].MediaGalleryFilePost.SocialInfo.LikesCount&&(e.data[o].socialMessage+="1 Like   "),e.data[o].MediaGalleryFilePost.SocialInfo.CommentsCount>1?e.data[o].socialMessage+=e.data[o].MediaGalleryFilePost.SocialInfo.CommentsCount+" Comments":1==e.data[o].MediaGalleryFilePost.SocialInfo.CommentsCount&&(e.data[o].socialMessage+="1 Comment"),e.data[o].socialMessageId="socialMessage_"+o;r=e.data;var a=kendo.template($("#library-folder-files-scrollview-tmpl").html()),i=kendo.render(a,e.data);$("#library-files-scrollview").find(".swiper-wrapper").empty(),$("#library-files-scrollview").find(".swiper-wrapper").attr("style",""),$("#library-files-scrollview").find(".swiper-wrapper").append(i);var s=new Swiper("#library-files-scrollview",{initialSlide:n,onInit:function(e){l.applyLazyImages(e),l.applyZoom()},onSlideChangeStart:function(e){l.applyLazyImages(e)}}),c=$("#ca-library-files-scroller").data("kendoMobileView");c&&null!==c&&c.bind("hide",function(e){null!==s&&s.detachEvents()})}},fnPageCallback:function(e,t){if(e.data){var o=kendo.template($("#library-folder-files-scrollview-tmpl").html()),n=kendo.render(o,e.data.Items),a=$("#library-files-scrollview")[0].swiper;"prepend"==t&&(a.prependSlide(n),a.slideTo(e.data.PageSize,0,!1)),"append"==t&&a.appendSlide(n),l.applyZoom()}},closeScroller:function(){var e=l.get("folderId"),t=l.get("libraryId");CommunityApp.common.navigateToView("#ca-library-subfolders?folderId="+e+"&libraryId="+t,"fade")},applyZoom:function(){$("#ca-library-files-scroller").click(function(){$(this).removeClass("zoomed-in"),$(this).css("background-image",""),l.set("zoomedIn",!1),$("#ca-library-files-scroller .full-download")&&$("#ca-library-files-scroller .full-download").remove()}),$(".zoom-target").each(function(){$(this).click(function(e){var t=l.get("zoomedIn");t?($("#ca-library-files-scroller").removeClass("zoomed-in"),$("#ca-library-files-scroller .full-download").remove(),l.set("zoomedIn",!1)):($("#ca-library-files-scroller").addClass("zoomed-in"),$("#ca-library-files-scroller").css("background-image",'url("'+$(this).find("img").data("src")+'")'),$('<div class="full-download" style="display: block;text-align: right;padding: 25px 10px 0 0;"><a onclick="CommunityApp.libraryScroller.viewModel.download();" class="no-text-decoration fontsize-14"><span class="glyphicon glyphicon-download-alt"></span></a></div>').appendTo("#ca-library-files-scroller"),l.set("zoomedIn",!0)),e.stopPropagation()})})},resetZoom:function(){$("body").zoomTo()},applyLazyImages:function(e){console.log("active index: "+e.activeIndex);var t=e.slides[e.activeIndex],o=$(t).find("img").data("src");$(t).find("img").attr("src",o),$(t).find("img")[0].onload=function(){$(t).find(".loading").hide(),$(t).find("img").removeClass("display-none"),l.set("dataBound",!0)},l.set("author",r[e.activeIndex].MediaGalleryFilePost.PostAuthor),l.set("filePostId",r[e.activeIndex].MediaGalleryFilePost.Id),l.set("activeIndex",e.activeIndex),l.set("social",r[l.get("activeIndex")].MediaGalleryFilePost.SocialInfo),l.set("comments",[]),l.set("showComments",!1),l.set("imageUrl",r[e.activeIndex].MediaGalleryFilePost.PostAttachments[0].FileUrl);var n=$("#mainImagePageScroller").data("kendoMobileScroller");null!==n&&"undefined"!=typeof n&&n.reset()},fnCommentCallBack:function(e,t){if(e.data){t=JSON.parse(t);t.mode;l.set("social",e.data.SocialInfo),null===e.data.PostComments?(l.set("comments",[]),l.set("commentsFound",!1)):(l.set("comments",e.data.PostComments),l.set("commentsFound",e.data.PostComments.length>0));var o=$("#image-comments").data("kendoMobileListView");o&&null!==o&&o.bind("dataBound",function(e){$("a[name='deleteComment']").each(function(){var e=$(this).attr("data-authorid");l.isAllowedToDeleteComment(e)&&$(this).removeClass("display-none")})}),$("#imageCommentForm .clearfix").css("height",0);var n=$("#mainImagePageScroller").data("kendoMobileScroller");if(null!==n&&"undefined"!=typeof n){var a=n.height();0===a&&(a=100),n.scrollTo(0,n.scrollHeight()*-1+a)}}},fnAddCommentCallback:function(o,n,a,i){if($("#txtImageComment").val(""),200===o){var r={},d=CommunityApp.base.baseData.currentUser().id,u=e(l.get("filePostId"),d),p=t(l.get("filePostId"),d),m={url:u,requestType:"GET",dataType:"JSON",callBack:l.fnCommentCallBack,sender:JSON.stringify(r)},f=o,g=n,h=a,y=i;CommunityApp.dataAccess.callService(m,null,null,null,null,null,function(){l.fnAddCommentCallback(f,g,h,y)});var v={url:p,requestType:"POST",dataType:"JSON"};CommunityApp.dataAccess.callService(v),c(l.get("social"))}else CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!");$("button[type='submit']","#imageCommentForm").html("<span class='glyphicon glyphicon-plus margin-2'></span>&nbsp;Add Comment").removeAttr("disabled"),s()},resetAddComment:function(e){$("#txtImageComment").val("")},fnDeleteCommentCallback:function(e,t){$(t).parent().parent().parent().remove(),d(l.get("social")),CommunityApp.common.showSuccessNotification("Comment has been deleted successfully!")},likePost:function(){p({likeSuccessCallback:l.likeSuccessCallback}).like(l.get("filePostId"),!0)},unlikePost:function(){p({likeSuccessCallback:l.likeSuccessCallback}).like(l.get("filePostId"),!1)},likeSuccessCallback:function(e){u(l.get("social"),"like"===e)}}),c=function(e){var t={UserLiked:e.UserLiked,LikesCount:e.LikesCount,UserId:e.UserId,PosyId:e.PostId,CommentsCount:e.CommentsCount+1};t.LikesCount>1?l.set("likesText",t.LikesCount+" Likes"):1==t.LikesCount?l.set("likesText","1 Like"):l.set("likesText",""),t.CommentsCount>1?l.set("commentsText",t.CommentsCount+" Comments"):1==t.CommentsCount?l.set("commentsText","1 Comment"):l.set("commentsText",""),l.set("social",t),$("#socialMessage_"+l.get("activeIndex")).text(l.get("likesText")+"   "+l.get("commentsText")),r[l.get("activeIndex")].MediaGalleryFilePost.SocialInfo=t,r[l.get("activeIndex")].socialMessage=l.get("likesText")+"   "+l.get("commentsText")},d=function(e){var t={UserLiked:e.UserLiked,LikesCount:e.LikesCount,UserId:e.UserId,PosyId:e.PostId,CommentsCount:e.CommentsCount-1};t.LikesCount>1?l.set("likesText",t.LikesCount+" Likes"):1==t.LikesCount?l.set("likesText","1 Like"):l.set("likesText",""),t.CommentsCount>1?l.set("commentsText",t.CommentsCount+" Comments"):1==t.CommentsCount?l.set("commentsText","1 Comment"):l.set("commentsText",""),l.set("social",t),$("#socialMessage_"+l.get("activeIndex")).text(l.get("likesText")+"   "+l.get("commentsText")),r[l.get("activeIndex")].MediaGalleryFilePost.SocialInfo=t,r[l.get("activeIndex")].socialMessage=l.get("likesText")+"   "+l.get("commentsText")},u=function(e,t){var o;o=t?{UserLiked:!0,LikesCount:e.LikesCount+1,UserId:e.UserId,PosyId:e.PostId,CommentsCount:e.CommentsCount}:{UserLiked:!1,LikesCount:e.LikesCount-1,UserId:e.UserId,PosyId:e.PostId,CommentsCount:e.CommentsCount},o.LikesCount>1?l.set("likesText",o.LikesCount+" Likes"):1==o.LikesCount?l.set("likesText","1 Like"):l.set("likesText",""),o.CommentsCount>1?l.set("commentsText",o.CommentsCount+" Comments"):1==o.CommentsCount?l.set("commentsText","1 Comment"):l.set("commentsText",""),l.set("social",o),$("#socialMessage_"+l.get("activeIndex")).text(l.get("likesText")+"   "+l.get("commentsText")),r[l.get("activeIndex")].MediaGalleryFilePost.SocialInfo=o,r[l.get("activeIndex")].socialMessage=l.get("likesText")+"   "+l.get("commentsText")},p=function(e){var t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.utilities.stringFormat(o?CommunityApp.configuration.postConfig.likePostPath:CommunityApp.configuration.postConfig.unlikePostPath,e,t);return n};return{like:function(e,o,n){var a=CommunityApp.base.baseData.currentUser().id;if(a&&0!==a){var i=t(e,a,o);o?CommunityApp.sounds.like():CommunityApp.sounds.unlike();var s={url:i,requestType:"POST",dataType:"JSON",callBack:this.fnLikeCallBack,sender:n};CommunityApp.dataAccess.callService(s)}},fnLikeCallBack:function(t,o){if(200===t.data.HttpStatus){var n=t.data.AdditionalData.toString().toLowerCase().split(",")[0],a=t.data.AdditionalData.toString().toLowerCase().split(",")[1];e&&e.likeSuccessCallback&&e.likeSuccessCallback(n,a,o)}else CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")},deleteComment:function(e,t,n){CommunityApp.sounds.del();var a=CommunityApp.base.baseData.currentUser().id,i=o(e,t,a),s={url:i,requestType:"DELETE",dataType:"JSON",callBack:this.fnDeleteCommentCallback,sender:n};CommunityApp.dataAccess.callService(s)},fnDeleteCommentCallback:function(t,o){e.commentSuccessCallback(t,o)},addComment:function(e){console.log("addComment");var t=$("textarea","#add-imageComment-form").kendoValidator().data("kendoValidator");if(t.validate()){CommunityApp.sounds.post();var o=CommunityApp.base.baseData.currentUser().id,a="posted a comment through the mobile app",i=n(l.filePostId,o),s={url:i,requestType:"POST",dataType:"JSON",data:{Subject:a,Body:e,ExpirationDate:(new Date).getMonth()+1+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()},callBack:this.fnPostCommentCallBack,sender:l.filePostId+",post"};CommunityApp.dataAccess.callService(s)}},fnPostCommentCallBack:function(t,o){o.split(",")[0],o.split(",")[1];e.addCommentSuccessCallback(t.data.HttpStatus,l.folderId,l.libraryId,l.activeIndex)}}};return{operations:p,viewModel:l}}(),CommunityApp.libraryFolderFiles=function(){var e=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.filesPath;return CommunityApp.utilities.stringFormat(a,e,t,o)+"?resizeFactor="+n},t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.folderPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},o=kendo.observable({title:"",description:"",inprogress:!1,load:function(n){o.set("inprogress",!0);var a=n.view.params.folderId,i=n.view.params.libraryId,s=CommunityApp.base.baseData.currentUser().id,r="#ca-library-folder-add?folderId="+a+"&libraryId="+i;CommunityApp.common.setAddFolderPath(n.view,r);var l=t(s,i,a),c={url:l,requestType:"GET",dataType:"JSON",callBack:o.fnLoadFolderCallback},d=n;CommunityApp.dataAccess.callService(c,null,null,null,null,null,function(){o.load(d)});var u,p,m=e(s,i,a,.25),f=50,g=1,h=0,y=0,v=4,C=CommunityApp.dataAccess.kendoDataSource(g,f,m,"GET",null,"library-folder-files","<h2 class='centerAlign padding-1'>No files are found!</h2>",null,function(){o.load(d)});C.fetch(function(){var e=C.view();e=CommunityApp.common.injectIndex(g,f,e);var t=kendo.template($("#library-folder-files-tmpl").html()),o=kendo.render(t,e);console.log(o),$("#library-folder-files").find(".container-fluid").empty(),$("#library-folder-files").find(".container-fluid").append(o),u=n.view.scroller,u.reset(),u.bind("scroll",function(n){$(".image-item").each(function(){$(this).visible()&&(y=$(this).attr("data-index"),h=C.total(),f=C.pageSize(),g=C.page(),y==g*f-v&&g*f<h&&(g+=1,C.page(g),C.fetch(function(){p=C.view();var n=CommunityApp.utilities.areEqual(e,p);n||setTimeout(function(){console.log("rendering page: "+C.page()),p=CommunityApp.common.injectIndex(g,f,p),o=kendo.render(t,p),$("#library-folder-files").find(".container-fluid").append(o)},100)})))})})})},fnLoadFolderCallback:function(e){e.data&&(CommunityApp.common.logTitle("Folder: "+e.data.Title),o.set("title",e.data.Title),o.set("description",e.data.Description)),o.set("inprogress",!1)},filesRedirect:function(e,t,o,n,a,i){if(console.log(n.toLowerCase()),null!==a)switch(n.toLowerCase()){case"image":var s="#ca-library-files-scroller?folderId="+e+"&libraryId="+t+"&index="+o;CommunityApp.common.navigateToView(s);break;case"pdf":case"word":case"excel":case"video":if("android"===CommunityApp.common.deviceType()){console.log("fileUrl: "+a);var r=a.substr(a.lastIndexOf("/")+1),l="Download";"android"===CommunityApp.common.deviceType()?l="Download":"iphone"!==CommunityApp.common.deviceType()&&"ipad"!==CommunityApp.common.deviceType()||(l="Download"),console.log("FileName: "+r);var c=function(e){var t=e.root.toURL()+l+"/"+r;$("#library-subfolder-files-container").hide(),$('<div class="k-loading-mask" style="width: 100%; height: 100%; top: 0px; left: 0px;"><span class="k-loading-text">Downloading...</span><div class="k-loading-image"></div><div class="k-loading-color"></div></div>').appendTo("#ca-library-subfolders .km-content");var o=cordova.plugins.permissions;o.hasPermission(o.WRITE_EXTERNAL_STORAGE,function(e){if(e.hasPermission)u(a,t);else{var n=function(){CommunityApp.common.showErrorNotification("Error!","Requires storage permission!")};o.requestPermission(o.WRITE_EXTERNAL_STORAGE,function(e){e.hasPermission?u(a,t):n()},n)}},null)},d=function(e){CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")};if(null===a||""===a)return void CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,c,d);var u=function(e,t){var o=new FileTransfer;e=e.replace(/ /g,"%20"),console.log("replaced fileUrl: "+e),o.download(e,t,function(e){$("#ca-library-subfolders .k-loading-mask").remove(),$("#library-subfolder-files-container").show();var t=e.toURL();t=t.replace(/%20/g," "),cordova.InAppBrowser.open(encodeURI(t),"_system")},function(e){$("#ca-thread-discussion .k-loading-mask").remove(),$("#thread-discussions-main-container").show(),CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!"),alert("Please check the application permission.")})}}else cordova.InAppBrowser.open(encodeURI(a),"_system");break;default:cordova.InAppBrowser.open(encodeURI(a),"_system")}else{var p="#ca-post?postId="+i+"&mode=post";CommunityApp.common.navigateToView(p)}}});return{viewModel:o}}(),CommunityApp.folder=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.libraryFoldersPath;return CommunityApp.utilities.stringFormat(o,e,t)},t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.folderPath;
return CommunityApp.utilities.stringFormat(n,e,t,o)},o=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.galleryPath;return CommunityApp.utilities.stringFormat(t,e)},n=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.filesPath;return CommunityApp.utilities.stringFormat(a,e,t,o)+"?resizeFactor="+n},a=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.cloudinaryPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},i=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.uploadCloudinaryDirectly,s=function(){$("#add-folder-form")&&($("button[type='submit']","#add-folder-form").html("<span class='km-icon km-add'></span>Add Folder").removeAttr("disabled"),$("#add-folder-form").unbind("submit"),$("#add-folder-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-22 pull-right'></div>").attr("disabled","disabled"),l.addFolder(),!0}))},r=function(){$("#add-file-form")&&($("button[type='submit']","#add-file-form").html("<span class='km-icon km-upload'></span>Upload File").removeAttr("disabled"),$("#add-file-form").unbind("submit"),$("#add-file-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-22 pull-right'></div>").attr("disabled","disabled"),l.addFile(),!0}))},l=kendo.observable({title:"",description:"",iconUrl:"",contestRelated:!1,allowedFileTypes:"",parentFolderId:0,libraryId:0,hasSubfolders:!1,hasFiles:!1,isLibrary:!1,fileUrl:"",fileEmbed:"",tags:"",inprogress:!1,isImage:!0,orientation:"",previewSelectedFile:"",fileType:"",uploadCloudinaryDirectly:!1,hideIcon:function(){var e=l.get("iconUrl");return""===e||null===e||!e||"undefined"==typeof e},hideFile:function(){var e=l.get("fileUrl"),t=l.get("isImage");return""===e||null===e||!e||"undefined"==typeof e||!t},load:function(e){var n=CommunityApp.base.baseData.currentUser().id,a=e.view.params.folderId,i=e.view.params.libraryId,c=e;l.set("libraryId",i),l.set("parentFolderId",a),l.set("iconUrl",""),l.set("fileUrl",""),l.set("tags",""),l.set("fileEmbed",""),l.set("title",""),l.set("description",""),l.set("orientation",""),l.set("previewSelectedFile",""),$("#fileUpload").val("");var d=this.element.find("ul.container-listview");if($("#select-form").kendoMobileButtonGroup({select:function(e){d.hide().eq(e.index).show()},index:0}),i&&a){l.set("isLibrary",!1);var u=t(n,i,a),p={url:u,requestType:"GET",dataType:"JSON",callBack:l.fnLoadFolderCallback};CommunityApp.dataAccess.callService(p,null,null,null,null,null,function(){l.load(c)})}else if(i){l.set("isLibrary",!0);var m=o(i),f={url:m,requestType:"GET",dataType:"JSON",callBack:l.fnLoadLibraryCallback};CommunityApp.dataAccess.callService(f,null,null,null,null,null,function(){l.load(c)})}s(),r()},fnLoadFolderCallback:function(e){e.data&&(l.set("hasSubfolders",e.data.HasSubfolders),l.set("hasFiles",e.data.TotalFiles>0))},fnLoadLibraryCallback:function(e){e.data&&l.set("hasSubfolders",e.data.TotalFolders>0)},addFolder:function(){l.set("inprogress",!0);var t=l.get("libraryId"),o=CommunityApp.base.baseData.currentUser().id,n=new FormData;n.append("file",CommunityApp.common.dataURItoBlob(l.get("fileUrl"))),n.append("data",JSON.stringify({Title:l.get("title"),Description:l.get("description"),AllowedFileTypes:l.get("allowedFileTypes"),ParentFolderId:l.get("parentFolderId")}));var a=e(o,t),i={url:a,dataType:"JSON",requestType:"POST",data:n,callBack:l.fnAddFolderCallback,sender:t};CommunityApp.dataAccess.callService(i,null,null,!0,!1,!1)},getUploadCloudinaryDirectlyValue:function(){var e={url:i,dataType:"JSON",requestType:"GET",callBack:l.fnUploadCloudinaryDirectlyCallback};CommunityApp.dataAccess.callService(e,null,null,!0,!1,!1)},addFile:function(){var e=CommunityApp.session.load("uploadCloudinaryDirectly",!0);l.set("uploadCloudinaryDirectly",e),l.uploadFile()},fnUploadCloudinaryDirectlyCallback:function(e){var t=!1;t=null!==e.data&&e.data,CommunityApp.session.save("uploadCloudinaryDirectly",t,!0)},uploadFile:function(){var e,t=l.get("uploadCloudinaryDirectly"),o=l.get("libraryId"),a=CommunityApp.base.baseData.currentUser().id,i=l.get("parentFolderId"),s="https://api.cloudinary.com/v1_1/pulseltd/image/upload",r=new FormData,c=l.get("isImage");if(t===!0){c?""===l.get("orientation")?(s=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image"),"undefined"!==$("#fileUpload")[0].files[0]&&"undefined"!=typeof $("#fileUpload")[0].files[0]&&($("#fileUpload")[0].files[0].size>1048576?(e=document.getElementById("file-canvas-upload").toDataURL("image/jpeg"),r.append("file",CommunityApp.common.dataURItoBlob(e))):r.append("file",$("#fileUpload")[0].files[0]))):(s=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image"),e=document.getElementById("file-canvas-upload").toDataURL("image/jpeg"),r.append("file",CommunityApp.common.dataURItoBlob(e))):("video"===l.get("fileType")&&(s=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"video")),r.append("file",$("#fileUpload")[0].files[0])),r.append("api_key",CommunityApp.configuration.cloudinaryConfig.api_key),r.append("upload_preset",CommunityApp.configuration.cloudinaryConfig.upload_preset);var d={url:s,dataType:"JSON",requestType:"POST",data:r,callBack:l.fnUploadCloudinaryCallback};CommunityApp.dataAccess.callService(d,null,null,!0,!1,!1)}else{c?""===l.get("orientation")?"undefined"!==$("#fileUpload")[0].files[0]&&"undefined"!=typeof $("#fileUpload")[0].files[0]&&($("#fileUpload")[0].files[0].size>1048576?(e=document.getElementById("file-canvas-upload").toDataURL("image/jpeg"),r.append("file",CommunityApp.common.dataURItoBlob(e)),r.append("data",JSON.stringify({Title:l.get("title"),Description:l.get("description"),ParentFolderId:l.get("parentFolderId"),VideoEmbed:l.get("fileEmbed"),FileUrl:e,Tags:l.get("tags")}))):(r.append("file",$("#fileUpload")[0].files[0]),r.append("data",JSON.stringify({Title:l.get("title"),Description:l.get("description"),ParentFolderId:l.get("parentFolderId"),VideoEmbed:l.get("fileEmbed"),FileUrl:l.get("fileUrl"),Tags:l.get("tags")})))):(e=document.getElementById("file-canvas-upload").toDataURL("image/jpeg"),r.append("file",CommunityApp.common.dataURItoBlob(e)),r.append("data",JSON.stringify({Title:l.get("title"),Description:l.get("description"),ParentFolderId:l.get("parentFolderId"),VideoEmbed:l.get("fileEmbed"),FileUrl:e,Tags:l.get("tags")}))):(r.append("file",$("#fileUpload")[0].files[0]),r.append("data",JSON.stringify({Title:l.get("title"),Description:l.get("description"),ParentFolderId:l.get("parentFolderId"),VideoEmbed:l.get("fileEmbed"),FileUrl:l.get("fileUrl"),Tags:l.get("tags")})));var u=n(a,o,i,.2);console.log(u);var p={url:u,dataType:"JSON",requestType:"POST",data:r,callBack:l.fnAddFileCallback};CommunityApp.dataAccess.callService(p,null,null,!0,!1,!1)}},fnAddFolderCallback:function(e,t){if(e.data)if(200==e.data.HttpStatus){var o=t,n=e.data.AdditionalData;CommunityApp.common.navigateToView("#ca-library-subfolders?libraryId="+o+"&folderId="+n)}else CommunityApp.common.showErrorNotification("Missing Data","Required data are missing!");else CommunityApp.common.showErrorNotification("Missing Data","Required data are missing!");l.set("inprogress",!1)},fnUploadCloudinaryCallback:function(e){console.log("end upload file request: "+e.data.HttpStatus),console.log(e);var t=l.get("libraryId"),o=CommunityApp.base.baseData.currentUser().id,n=l.get("parentFolderId");if(e.data){var i=a(o,t,n);console.log(i);var s={FileName:e.data.original_filename,Format:e.data.format,MediaType:e.data.resource_type,PublicId:e.data.public_id,Url:e.data.url,Version:e.data.version,Angle:0,Value:{Title:l.get("title"),Description:l.get("description"),ParentFolderId:l.get("parentFolderId"),VideoEmbed:l.get("fileEmbed"),FileUrl:"",Tags:l.get("tags")}};console.log(JSON.stringify(s));var c={url:i,requestType:"POST",dataType:"JSON",data:JSON.stringify(s),callBack:l.fnAddFileCallback};CommunityApp.dataAccess.callService(c,null,null,!0,!1,"application/json")}else CommunityApp.common.showErrorNotification("Unexpected Error!","Unexpected Error! Try again later."),r()},fnAddFileCallback:function(e){if(console.log("end upload file request: "+e.data.HttpStatus),console.log(e),e.data&&200==e.data.HttpStatus){var t=l.get("libraryId"),o=l.get("parentFolderId");CommunityApp.common.navigateToView("#ca-library-subfolders?libraryId="+t+"&folderId="+o)}},triggerUpload:function(){$("#iconUpload").click(),$("#iconUpload").unbind("change"),$("#iconUpload").change(function(){CommunityApp.common.readUrl(this,function(e){l.set("iconUrl",e);var t=document.getElementById("folder-icon-canvas"),o=t.getContext("2d"),n=new Image;n.onload=function(){o.drawImage(n,0,0,n.width,n.height,0,0,t.width,t.height)},n.src=e})})},triggerUploadFile:function(){$("#fileUpload").click(),$("#fileUpload").unbind("change"),$("#fileUpload").change(function(){CommunityApp.common.readUrl(this,function(e,t){var o=t.type.substr(0,5);return console.log("file type: "+t.type),l.set("fileType",o),"image"!==o?(l.set("isImage",!1),l.set("fileUrl",e),void("video"===o?l.set("previewSelectedFile","Video Selected"):l.set(t.type+" Selected"))):(l.set("isImage",!0),void loadImage.parseMetaData(t,function(o){var n=document.getElementById("file-canvas"),a=n.getContext("2d");a.clearRect(0,0,n.width,n.height);var i=document.getElementById("file-canvas-upload"),s=i.getContext("2d");s.clearRect(0,0,i.width,i.height);var r=new Image;if(o.exif){r.onload=function(){i.width="500",i.height=r.height/r.width*500,s.drawImage(r,0,0,r.width,r.height,0,0,i.width,i.height),a.drawImage(r,0,0,r.width,r.height,0,0,n.width,n.height)},l.set("orientation",o.exif.get("Orientation"));var c=loadImage(t,function(t){"function"==typeof t.toDataURL?(l.set("fileUrl",t.toDataURL()),r.src=t.toDataURL()):(l.set("fileUrl",e),r.src=e)},{orientation:l.get("orientation"),maxWidth:900,maxHeight:1200});c||alert("not load image")}else l.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(l.set("fileUrl",e),r.onload=function(){i.width="900",i.height=r.height/r.width*900,s.drawImage(r,0,0,r.width,r.height,0,0,i.width,i.height),a.drawImage(r,0,0,r.width,r.height,0,0,n.width,n.height)},r.src=e):(l.set("fileUrl",e),r.onload=function(){a.drawImage(r,0,0,r.width,r.height,0,0,n.width,n.height)},r.src=e)}))})})}});return{viewModel:l}}(),CommunityApp.libraryFolders=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.libraryFoldersPath;return CommunityApp.utilities.stringFormat(o,e,t)},t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath,o=kendo.observable({name:"",description:"",inprogress:!1,pagesRendered:[],load:function(n){o.set("inprogress",!0);var a=n;if("undefined"!==n.view.params.libraryId&&"undefined"!=typeof n.view.params.libraryId){var i="ca-library-folder-add?libraryId="+n.view.params.libraryId;CommunityApp.common.setAddFolderPath(n.view,i);var s={url:t+n.view.params.libraryId,requestType:"GET",dataType:"JSON",callBack:o.fnLoadLibrarySectionCallback};CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){o.load(a)})}var r,l,c=CommunityApp.base.baseData.currentUser().id,d=e(c,n.view.params.libraryId),u=0,p=10,m=1,f=0,g=4,h=CommunityApp.dataAccess.kendoDataSource(m,p,d,"GET",null,"library-folders","<h2 class='centerAlign padding-1'>No folders are found!</h2>",null,function(){o.load(a)});h.read().then(function(){var e=h.view();e=CommunityApp.common.injectIndex(m,p,e);var t=kendo.template($("#library-folders-tmpl").html()),o=kendo.render(t,e);$("#library-folders").find(".container-fluid").empty(),$("#library-folders").find(".container-fluid").append(o),r=n.view.scroller,r.reset(),r.bind("scroll",function(e){$(".folder-item").each(function(){$(this).visible()&&(f=$(this).attr("data-index"),u=h.total(),p=h.pageSize(),m=h.page(),f==m*p-g&&m*p<u&&(m+=1,h.page(m),h.read().then(function(){setTimeout(function(){console.log("rendering page: "+h.page()),l=h.view(),l=CommunityApp.common.injectIndex(m,p,l),o=kendo.render(t,l),$("#library-folders").find(".container-fluid").append(o)},100)})))})})})},fnLoadLibrarySectionCallback:function(e){e.data&&(CommunityApp.common.logTitle("Library: "+e.data.Name),o.set("name",e.data.Name),o.set("description",e.data.Description)),o.set("inprogress",!1)},folderRedirect:function(e,t,o){var n;n="true"===t.toLowerCase()?"#ca-library-subfolders?folderId="+e+"&libraryId="+o:"#ca-library-subfolders?folderId="+e+"&libraryId="+o,CommunityApp.common.navigateToView(n)}});return{viewModel:o}}(),CommunityApp.librarySubfolders=function(){var e=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.subfoldersPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.folderPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},o=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.filesPath;return CommunityApp.utilities.stringFormat(a,e,t,o)+"?resizeFactor="+n},n=kendo.observable({title:"",description:"",tabIndex:0,inprogress:!1,pages_read:[],noSubfolders:!1,noFiles:!1,load:function(a){n.set("inprogress",!0),n.set("noSubfolders",!1),n.set("noFiles",!1);var i=this.element.find("div.km-listview");$("#select-view").kendoMobileButtonGroup({select:function(e){i.hide().eq(e.index).show()},index:n.get("tabIndex")});var s=CommunityApp.base.baseData.currentUser().id,r=a.view.params.folderId,l=a.view.params.libraryId;l||(l=0);var c="ca-library-folder-add?folderId="+r+"&libraryId="+l;CommunityApp.common.setAddFolderPath(a.view,c);var d=t(s,l,r),u={url:d,requestType:"GET",dataType:"JSON",callBack:n.fnLoadFolderCallback},p=a;CommunityApp.dataAccess.callService(u,null,null,null,null,null,function(){n.load(p)});var m,f,g=e(s,l,r),h=0,y=24,v=1,C=0,A=4;n.set("pages_read",[]);var b=CommunityApp.dataAccess.kendoDataSource(v,y,g,"GET",null,"library-subfolders","<h2 class='centerAlign padding-1'>No folders are found!</h2>",null,function(){n.load(p)});b.read().then(function(){var e=b.view();e=CommunityApp.common.injectIndex(v,y,e);var t=$("#select-view").data("kendoMobileButtonGroup");e.length>0?($("#library-subfolders").show(),$("#library-files").hide(),n.set("tabIndex",0),t.select(0)):($("#library-subfolders").hide(),$("#library-files").show(),n.set("tabIndex",1),t.select(1),n.set("noSubfolders",!0));var o=kendo.template($("#library-subfolders-tmpl").html()),i=kendo.render(o,e);$("#library-subfolders").find(".container-fluid").empty(),$("#library-subfolders").find(".container-fluid").append(i),m=a.view.scroller,m.reset(),m.bind("scroll",function(e){$(".folder-item").each(function(){$(this).visible()&&(C=$(this).attr("data-index"),h=b.total(),y=b.pageSize(),v=b.page(),C==v*y-A&&v*y<h&&(v+=1,b.page(v),b.read().then(function(){setTimeout(function(){console.log("rendering page: "+b.page()),f=b.view(),f=CommunityApp.common.injectIndex(v,y,f);var e=kendo.render(o,f);$("#library-subfolders").find(".container-fluid").append(e)},0)})))})})});var w,k,S=o(s,l,r,.25),P=50,I=1,T=0,U=0,x=4,B=CommunityApp.dataAccess.kendoDataSource(I,P,S,"GET",null,"library-files","<h2 class='centerAlign padding-1'>No files are found!</h2>",null,function(){n.load(p)});B.fetch(function(){var e=B.view();e=CommunityApp.common.injectIndex(I,P,e),e.length>0?(n.set("noFiles",!1),$("#select-folder").attr("style","")):(n.set("noSubfolders",!0),console.log("no subfolders: "+n.get("noSubfolders")),n.set("noFiles",!0),$("#select-folder").attr("style","border-radius: 4px; border-width: 1px"));var t=0;for(t=0;t<e.length;t++)e[t].MediaGalleryFilePost.PostAuthor.UserProfile.FullName.length>16?e[t].MediaGalleryFilePost.PostAuthor.UserProfile.ShortenName=e[t].MediaGalleryFilePost.PostAuthor.UserProfile.FullName.substr(0,13)+"...":e[t].MediaGalleryFilePost.PostAuthor.UserProfile.ShortenName=e[t].MediaGalleryFilePost.PostAuthor.UserProfile.FullName;var o=kendo.template($("#library-folder-files-tmpl").html()),i=kendo.render(o,e);$("#library-files").find(".container-fluid").empty(),$("#library-files").find(".container-fluid").append(i);var s=n.get("pages_read");s.push(I),console.log("after pushing 1st page: "+JSON.stringify(s)),n.set("inprogress",!1),w=a.view.scroller,w.reset(),w.bind("scroll",function(e){$(".image-item").each(function(){if($(this).visible()&&(U=$(this).attr("data-index"),T=B.total(),P=B.pageSize(),I=B.page(),U==I*P-x&&I*P<T)){var e=B.view();e=CommunityApp.common.injectIndex(I,P,e),I+=1,B.page(I),B.fetch(function(){if(console.log("after fetching: "+JSON.stringify(s)),s.indexOf(I)<0){s.push(I),console.log("pushing a new page: "+JSON.stringify(s)),k=B.view(),k=CommunityApp.common.injectIndex(I,P,k);var t=0;for(t=0;t<k.length;t++)k[t].MediaGalleryFilePost.PostAuthor.UserProfile.FullName.length>16?k[t].MediaGalleryFilePost.PostAuthor.UserProfile.ShortenName=k[t].MediaGalleryFilePost.PostAuthor.UserProfile.FullName.substr(0,13)+"...":k[t].MediaGalleryFilePost.PostAuthor.UserProfile.ShortenName=k[t].MediaGalleryFilePost.PostAuthor.UserProfile.FullName;var n=CommunityApp.utilities.areEqual(e,k);n||setTimeout(function(){console.log("rendering page: "+B.page());var e=kendo.render(o,k);$("#library-files").find(".container-fluid").append(e)},0)}})}})})})},fnLoadFolderCallback:function(e){e.data&&(CommunityApp.common.logTitle("Sub folder: "+e.data.Title),n.set("title",e.data.Title),n.set("description",e.data.Description))},folderRedirect:function(e,t,o){var n;n="true"===t.toLowerCase()?"#ca-library-subfolders?folderId="+e+"&libraryId="+o:"#ca-library-subfolders?folderId="+e+"&libraryId="+o,CommunityApp.common.navigateToView(n)}});return{viewModel:n}}(),CommunityApp.library=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.topLevelsPath,o=180,n=120;return $(window).width()>=768&&(o=375,n=250),CommunityApp.utilities.stringFormat(t,e,o,n)},t=kendo.observable({inprogress:!1,pages_read:[],load:function(o){CommunityApp.common.logTitle("Top Level Media Galleries"),t.set("inprogress",!0);var n=CommunityApp.base.baseData.currentUser().id,a=(e(n),CommunityApp.session.load("offline_resourcesTopLevel_cache"));if(null!==a&&"undefined"!=typeof a&&"undefined"!==a){console.log(a);var i=kendo.template($("#toplevel-list-tmpl").html()),s=kendo.render(i,a.Items);$("#toplevels").find(".container-fluid").empty(),$("#toplevels").find(".container-fluid").append(s),t.set("inprogress",!1);var r=1,l=o.view.scroller;l.reset(),pages_read=[],pages_read.push(r),t.set("pages_read",pages_read);var c=l.scrollHeight(),d=650;l.bind("scroll",function(e){total=a.Total,pageSize=20,r=1,c=l.scrollHeight(),c-e.scrollTop<=d&&pageSize*r<total&&(r+=1,pages_read.indexOf(r)<0&&(pages_read.push(r),t.set("pages_read",pages_read),t.read(r,e.view,t.fnReadLibraryToplevelCallback)))})}else t.read(1,o.view,t.fnReadLibraryToplevelCallback)},read:function(o,n,a){var i=CommunityApp.base.baseData.currentUser().id,s=e(i),r=20;s+="?page="+o+"&pageSize="+r;var l=$("#ca-library-toplevel").data("kendoMobileView"),c={url:s,dataType:"JSON",requestType:"GET",callBack:a,sender:{page:o,pageSize:r,view:l}},d=o,u=n;CommunityApp.dataAccess.callService(c,"toplevel-library-listview","<h2 class='centerAlign padding-1'>No top level libraries are found!</h2>",null,null,null,function(){t.read(d,u,a)})},fnReadLibraryToplevelCallback:function(e,o){if(e.data){var n=o.page,a=o.pageSize,i=e.data.Items;i=CommunityApp.common.injectIndex(n,a,i);var s=kendo.template($("#toplevel-list-tmpl").html()),r=kendo.render(s,i),l=t.get("pages_read");scroller=o.view.scroller,1==n&&($("#toplevels").find(".container-fluid").empty(),scroller.reset(),l=[],CommunityApp.session.save("offline_resourcesTopLevel_cache",e.data)),$("#toplevels").find(".container-fluid").append(r),t.set("inprogress",!1),l.push(n),t.set("pages_read",l),scrollHeight=scroller.scrollHeight();var c=650;scroller.bind("scroll",function(i){total=e.data.Total,a=o.pageSize,n=o.page,scrollHeight=scroller.scrollHeight(),scrollHeight-i.scrollTop<=c&&a*n<total&&(n+=1,l.indexOf(n)<0&&(l.push(n),t.set("pages_read",l),t.read(n,o.view,t.fnReadLibraryToplevelCallback)))})}}});return{viewModel:t}}(),CommunityApp.notifications=function(){var e=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.notificationsConfig.notificationsPath+CommunityApp.configuration.notificationsConfig.userNotificationsPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},t=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.notificationsConfig.notificationsPath+CommunityApp.configuration.notificationsConfig.unreadsCountPath;return CommunityApp.utilities.stringFormat(t,e)},o=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.notificationsConfig.notificationsPath+CommunityApp.configuration.notificationsConfig.markAsReadPath;return CommunityApp.utilities.stringFormat(o,e,t)},n=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.notificationsConfig.notificationsPath+CommunityApp.configuration.notificationsConfig.deletePath;return CommunityApp.utilities.stringFormat(o,e,t)},a=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.notificationsConfig.notificationsPath+CommunityApp.configuration.notificationsConfig.pushNotificationsDevicePath;return CommunityApp.utilities.stringFormat(t,e)},i=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.notificationsConfig.notificationsPath+CommunityApp.configuration.notificationsConfig.deletePushNotificationsDevicePath;return CommunityApp.utilities.stringFormat(o,e,t)},s=kendo.observable({drags:[],pages_read:[],read:function(t,o){var n=CommunityApp.base.baseData.currentUser().id,a=e(n,50,50),i=25;a+="&page="+t+"&pageSize="+i;var r={url:a,dataType:"JSON",requestType:"GET",callBack:s.fnReadPageNotificationsCallback,sender:{page:t,pageSize:i,view:o}},l=t,c=o;CommunityApp.dataAccess.callService(r,"notifications-listview","<h2 class='centerAlign padding-1'>No current notifications!</h2>",null,null,function(){s.read(l,c)})},fnReadPageNotificationsCallback:function(e,t){if(e.data){var o=t.page,n=t.pageSize,a=e.data.Items,i=4;a=CommunityApp.common.injectIndex(o,n,a);var r=kendo.template($("#notifications-list-tmpl").html()),l=kendo.render(r,a),c=s.get("pages_read");scroller=t.view.scroller,1==o&&($("#notifications-listview").empty(),scroller.reset()),$("#notifications-listview").append(l),c.push(o),s.set("pages_read",c),s.enableSwipe(),scroller.bind("scroll",function(a){$(".noti-container").each(function(){$(this).visible()&&(viewedIndex=$(this).attr("data-index"),total=e.data.Total,n=t.pageSize,o=t.page,viewedIndex==o*n-i&&o*n<total&&(o+=1,c.indexOf(o)<0&&(c.push(o),s.set("pages_read",c),s.read(o,t.view))))})})}},load:function(e){CommunityApp.common.logTitle("Notifications"),s.read(1,e.view),CommunityApp.common.pullToRefresh(e,function(e){s.load(e)})},updateBadge:function(){var e=CommunityApp.base.baseData.currentUser().id;if(e>0){var o=t(e),n={url:o,dataType:"JSON",requestType:"GET",callBack:s.fnUpdateBadgeCallback};CommunityApp.dataAccess.callService(n,null,null,!0,null,null,function(){s.updateBadge()})}},fnUpdateBadgeCallback:function(e){e.data&&$("a[name='noti-badge']").each(function(){var t=$(this).data("kendoMobileButton");t&&null!==t&&"undefined"!=typeof t?"0"==e.data?t.badge(!1):t.badge(e.data):"0"==e.data?$(this).find(".km-badge").html(""):$(this).find(".km-badge").html(e.data)})},enableSwipe:function(){$("#notifications-listview").find(".noti-container .item").each(function(){$(this).kendoTouch({enableSwipe:!0,swipe:function(e){s.swipe(e)}})})},swipe:function(e){var t=e.sender.element,o=t.attr("data-id"),n=_.contains(s.drags,o);"left"===e.direction&&0===t.position().left?(t.animate({right:"+=120"}),s.drags.push(o)):"right"===e.direction&&t.position().left<0&&n&&(t.css("padding-left","15px"),t.animate({right:"-=120"}),s.drags=_.filter(s.drags,function(e){return e!=o}))},deleteNotification:function(e,t){var o=CommunityApp.base.baseData.currentUser().id,a=n(o,e),i={url:a,dataType:"JSON",requestType:"DELETE",callBack:s.fnDeleteCallback,sender:t},r=e,l=t;CommunityApp.dataAccess.callService(i,null,null,null,null,null,function(){s.deleteNotification(r,l)})},fnDeleteCallback:function(e,t){200===e.data.HttpStatus?($(t).closest(".noti-container").remove(),CommunityApp.notifications.viewModel.updateBadge()):CommunityApp.common.showErrorNotification("Error!","Unexpected error occurred!")},open:function(e){var t,n=$(e),a=JSON.parse(n.attr("data-attributes")),i=n.attr("data-type"),r=n.attr("data-id"),l="";switch(i.toLowerCase()){case"friendrequest":l="views/friends/requests.html";break;case"badgeawarded":l="ca-user-badges";break;case"conversationstart":case"conversationreply":t=_.find(a,function(e){return"Conversation"==e.Name}),l="views/conversations/convolist.html?convid="+t.Value;break;case"likepost":case"usertag":case"postcomment":t=_.find(a,function(e){return"Post"==e.Name}),l="ca-post?postId="+t.Value;break;case"forumreply":case"forumthreadcreate":var c=_.find(a,function(e){return"Thread"==e.Name}),d=_.find(a,function(e){return"ThreadType"==e.Name});c&&d&&(l="discussion"==d.Value.toLowerCase()?"ca-thread-discussion":"ca-thread-qa",l=l+"?threadId="+c.Value)}$(e).closest("li.noti-container").find(".item").removeClass("bg-lightblue"),$(e).closest("li.noti-container").find(".item").addClass("bg-white");var u=CommunityApp.base.baseData.currentUser().id,p=o(u,r),m={url:p,dataType:"JSON",requestType:"PUT",callBack:s.fnMarkAsReadCallback},f=e;CommunityApp.dataAccess.callService(m,null,null,null,null,null,function(){s.open(f)}),""!==l&&null!==l&&CommunityApp.common.navigateToView(l)},fnMarkAsReadCallback:function(e){CommunityApp.notifications.viewModel.updateBadge()},registerDevice:function(){function e(e,t,o){var n=a(o),i={url:n,dataType:"JSON",requestType:"POST",data:{DeviceId:e.deviceId,Model:e.model,Platform:e.platform,RegistrationId:e.regId,Version:e.version,Manufacturer:e.manufacturer,Serial:e.serial,AppVersion:t}};CommunityApp.dataAccess.callService(i)}var t=CommunityApp.base.baseData.currentUser().id,o=CommunityApp.session.load("push_device");null!==o&&"undefined"!=typeof o&&t>0&&("function"==typeof cordova.getAppVersion?cordova.getAppVersion(function(n){e(o,n,t)}):e(o,"",t))},deleteDevice:function(){function e(e,t){var o=i(t,e.deviceId);console.log("delete device serviceurl: "+o);var n={url:o,dataType:"JSON",requestType:"DELETE"};CommunityApp.dataAccess.callService(n)}var t=CommunityApp.base.baseData.currentUser().id,o=CommunityApp.session.load("push_device");console.log("deleteDevice call"),console.log(o),null!==o&&"undefined"!=typeof o&&t>0&&e(o,t)},clear:function(){var t=CommunityApp.base.baseData.currentUser().id,o=e(t,50,50),n={url:o,dataType:"JSON",requestType:"DELETE",callBack:s.fnClearNotificationsCallback};CommunityApp.dataAccess.callService(n,null,null,null,null,null,function(){s.clear()})},fnClearNotificationsCallback:function(e){e.data&&200==e.data.HttpStatus&&(s.destroyBadge(),$("#notifications-listview").empty(),$("#notifications-listview").html("<h2 class='centerAlign padding-1'>No notifications are found!</h2>"))},destroyBadge:function(){$("a[name='noti-badge']").each(function(){var e=$(this).data("kendoMobileButton");e&&null!==e&&"undefined"!=typeof e&&e.badge(!1)})}});return{viewModel:s}}(),CommunityApp.poll=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.pollConfig.pollPath+CommunityApp.configuration.pollConfig.latestUnansweredPollPath;return o=CommunityApp.utilities.stringFormat(o,t,e)},t=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.pollConfig.pollPath+CommunityApp.configuration.pollConfig.lastAnsweredPollPath;return o=CommunityApp.utilities.stringFormat(o,t,e)},o=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.pollConfig.pollPath+CommunityApp.configuration.pollConfig.pollByIdPath;return n=CommunityApp.utilities.stringFormat(n,e,t,o)},n=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.pollConfig.pollPath+CommunityApp.configuration.pollConfig.pollGraphPath;return t=CommunityApp.utilities.stringFormat(t,e)},a=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.pollConfig.pollPath+CommunityApp.configuration.pollConfig.voteToPollPath;return e},i=function(){$("#poll-vote-form")&&($("button[type='submit']","#poll-vote-form").html("Vote").removeAttr("disabled"),$("#poll-vote-form").unbind("submit"),$("#poll-vote-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-22 pull-right'></div>").attr("disabled","disabled"),s.vote(),!0}))},s=kendo.observable({id:0,description:"",createdDate:"",userCountText:"",dataBound:!1,unansweredPoll:!1,noPoll:!1,hasPrevPoll:!1,hasNextPoll:!1,showChart:!1,prevPollPage:"#ca-poll-view",nextPollPage:"#ca-poll-view",pollItems:[],load:function(t){s.set("dataBound",!1),s.set("unansweredPoll",!1),s.set("noPoll",!1),s.set("showChart",!1),s.set("id",0);var n=t,a=CommunityApp.base.baseData.currentUser();if("undefined"!=t.view.params.pollId&&"undefined"!=typeof t.view.params.pollId){var r=t.view.params.pollId,l=o(r,a.id,"Homepage");console.log(l);var c={url:l,requestType:"GET",dataType:"JSON",callBack:s.loadPollByIdCallback};CommunityApp.dataAccess.callService(c,null,null,null,null,null,function(){s.load(n)})}else{var d=e("Homepage",a.id),u={url:d,requestType:"GET",dataType:"JSON",callBack:s.loadLatestUnansweredPollCallback};CommunityApp.dataAccess.callService(u,null,null,null,null,null,function(){s.load(n)})}i()},loadAfterVote:function(){s.set("dataBound",!1),s.set("unansweredPoll",!1),s.set("showChart",!1);var e=CommunityApp.base.baseData.currentUser(),t=s.get("id"),n=o(t,e.id,"Homepage");console.log(n);var a={url:n,requestType:"GET",dataType:"JSON",callBack:s.loadPollByIdCallback};CommunityApp.dataAccess.callService(a,null,null,null,null,null,function(){s.loadAfterVote()})},setPollDatas:function(e){s.set("id",e.Id),null===e.Description||""===e.Description?s.set("description",e.Name):s.set("description",e.Description);var t=new Date(e.DateCreated),o=t.toDateString();s.set("createdDate","Posted on "+o.substr(0,3)+", "+o.substr(4,3)+". "+o.substr(8,o.length-8)),0===e.NumberOfAnswers?s.set("userCountText","No one answered this."):1===e.NumberOfAnswers?s.set("userCountText","1 user answered this."):s.set("userCountText",e.NumberOfAnswers+" users answered this.");var a=kendo.template($("#poll-item-tmpl").html()),i=kendo.render(a,e.PollItems);if($("#poll-items-list").find(".poll-item-fieldlist").empty(),$("#poll-items-list").find(".poll-item-fieldlist").attr("style",""),$("#poll-items-list").find(".poll-item-fieldlist").append(i),
null===e.PreviousPollId||e.PreviousPollId==e.Id?s.set("hasPrevPoll",!1):(s.set("hasPrevPoll",!0),s.set("prevPollPage","#ca-poll-view?pollId="+e.PreviousPollId)),null===e.NextPollId||e.NextPollId==e.Id?s.set("hasNextPoll",!1):(s.set("hasNextPoll",!0),s.set("nextPollPage","#ca-poll-view?pollId="+e.NextPollId)),e.AlreadyAnswered===!0){var r=e,l=n(e.Id),c={url:l,requestType:"GET",dataType:"JSON",callBack:s.loadPollGraphCallback};CommunityApp.dataAccess.callService(c,null,null,null,null,null,function(){s.setPollDatas(r)}),s.set("unansweredPoll",!1)}else s.set("unansweredPoll",!0);s.set("dataBound",!0)},loadPollGraphCallback:function(e){if(e.data){for(var t=e.data,o=[],n=0;n<t.length;n++){var a={};a.category=t[n].Name,a.value=t[n].Value,a.color=t[n].Color,o.push(a)}$("#poll-chart").kendoChart({title:{text:"",visible:!1},legend:{visible:!1},chartArea:{background:"",width:350,height:350},seriesDefaults:{labels:{visible:!1,background:"transparent",position:"insideEnd",template:"#= kendo.format('{0:P}', percentage)#"}},series:[{type:"pie",startAngle:0,data:o}]});var i=kendo.template($("#poll-legend-item-tmpl").html()),r=kendo.render(i,t);$("#poll-legend").find(".poll-legend").empty(),$("#poll-legend").find(".poll-legend").attr("style",""),$("#poll-legend").find(".poll-legend").append(r),s.set("showChart",!0)}},loadPollByIdCallback:function(e){if(e.data){var t=e.data;s.setPollDatas(t)}else s.set("noPoll",!0)},loadLatestUnansweredPollCallback:function(e){if(e.data){var o=e.data;s.setPollDatas(o)}else{var n=CommunityApp.base.baseData.currentUser(),a=t("Homepage",n.id),i={url:a,requestType:"GET",dataType:"JSON",callBack:s.loadLastAnsweredPollCallback},r=e;CommunityApp.dataAccess.callService(i,null,null,null,null,null,function(){s.loadLatestUnansweredPollCallback(r)})}},loadLastAnsweredPollCallback:function(e){if(e.data){var t=e.data;s.setPollDatas(t)}else s.set("noPoll",!0)},vote:function(){var e=a(),t=CommunityApp.base.baseData.currentUser().id,o=s.get("id"),n=$("#poll-vote-form input[name=pollItem]:checked").val();if("undefined"==typeof n)return CommunityApp.common.showErrorNotification("Error!","Please select one of the answers!"),$("button[type='submit']","#poll-vote-form").html("Vote").removeAttr("disabled"),void i();console.log(o),console.log($("#poll-vote-form input[name=pollItem]:checked").val());var r={userId:t,pollId:o,vote:n},l={url:e,requestType:"POST",dataType:"JSON",data:r,callBack:s.fnVoteToPollCallback};CommunityApp.dataAccess.callService(l)},fnVoteToPollCallback:function(e){e.data&&e.data>0?(CommunityApp.common.showSuccessNotification("Posted your vote successfully!"),s.loadAfterVote()):(CommunityApp.common.showErrorNotification("Unexpected Error!","Unexpected error occurred. Try again later!"),$("button[type='submit']","#poll-vote-form").html("Vote").removeAttr("disabled"),i())}});return{viewModel:s}}(),CommunityApp.hotPosts=function(){var e=kendo.observable({refresh:function(e){CommunityApp.common.logTitle("Featured Promotions");var t=kendo.template($("#posts-thumbs-list-no-user-tmpl").html()),o=CommunityApp.session.load(CommunityApp.configuration.sectionConfig.offlineStore);if(o&&null!==o&&"undefined"!=typeof o&&o.length>0){var n=kendo.render(t,o);$("#hot-posts-list").find(".container-fluid").empty(),$("#hot-posts-list").find(".container-fluid").append(n)}},likeSuccessCallback:function(t,o,n){var a=CommunityApp.session.load(CommunityApp.configuration.sectionConfig.offlineStore),i=$(n).data("id"),s=_.find(a,function(e){return e.Id==i}),r=_.indexOf(a,s),l=a[r];"like"==t?(l.SocialInfo.LikesCount=o,l.SocialInfo.UserLiked=!0):(l.SocialInfo.LikesCount=o,l.SocialInfo.UserLiked=!1),a[r]=l,CommunityApp.session.save(CommunityApp.configuration.sectionConfig.offlineStore,a),e.refresh()}});return{viewModel:e}}(),CommunityApp.postShare=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.sharePath;return CommunityApp.utilities.stringFormat(t,e)},t=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.postPath;return CommunityApp.utilities.stringFormat(o,e,t)},o=kendo.observable({title:"",body:"",emails:"",postId:0,slug:"",load:function(e){var n=e.view.params.postId,a=CommunityApp.base.baseData.currentUser().id;o.set("emails","");var i=t(n,a),s={url:i,dataType:"JSON",requestType:"GET",callBack:o.fnLoadPostCallback},r=e;CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){o.load(r)}),$("#shareForm").one("submit",function(){return o.share(),!0})},fnLoadPostCallback:function(e){e.data&&(CommunityApp.common.logTitle("Post Share: "+e.data.Subject),o.set("title",e.data.Subject),o.set("body",e.data.Body),o.set("postId",e.data.Id),o.set("slug",e.data.Slug));var t=CommunityApp.main.getKendoApplication(),n=t.view(),a=n.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==a){var i=a.rightElement;$(i[0].children[1]).one("click",function(){console.log("top right share click"),o.share()})}},fnSharePostCallback:function(e){e.data&&200==e.data.HttpStatus&&CommunityApp.common.navigateToView("#:back")},share:function(){if(""!==o.get("emails")){var t=CommunityApp.base.baseData.currentUser().id,n={UserId:t,Title:o.get("title"),Body:o.get("body"),Emails:o.get("emails"),PostId:o.get("postId"),Slug:o.get("slug")},a=e(o.get("postId")),i={url:a,requestType:"POST",dataType:"JSON",data:n,callBack:o.fnSharePostCallback};CommunityApp.dataAccess.callService(i)}}});return{viewModel:o}}(),CommunityApp.post=function(){var e=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.postConfig.postPath,e,t);return o},t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.deleteCommentPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},o=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.postViewsPath;return CommunityApp.utilities.stringFormat(o,e,t)},n=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.addCommentPath;return CommunityApp.utilities.stringFormat(o,e,t)},a=function(e){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+e},i=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.deleteAttachment;return CommunityApp.utilities.stringFormat(t,e)},s=function(){$("#commentForm").unbind("submit"),$("#commentForm").one("submit",function(){return $("button[type='submit']",this).html("Processing...").attr("disabled","disabled"),CommunityApp.post.operations({addCommentSuccessCallback:CommunityApp.post.viewModel.fnAddCommentCallback}).addComment($("#txtComment").val()),!0})},r=kendo.observable({id:0,subject:"",shortBody:"",longBody:"",readMore:!0,isShortText:!1,postDateFormatted:new Date,totalViews:0,author:{},attachments:[],comments:[],commentsFound:!1,emptyCommentsMessage:"",social:{},isStatus:!1,likesText:"",commentsText:"",mode:"",rate:0,totalRates:0,rateText:"",isThreadFollowed:!1,sectionPage:"",sectionTitle:"",authorFullName:"",authorTitle:"",dataBound:!1,isComment:!1,loadingAttachment:!1,editAllowed:!1,postLevel:0,parentId:0,parentPostUrl:function(){return"#ca-post?postId="+r.get("parentId")},isCommentPost:function(){var e=r.get("postLevel");return e>1},isCommentPostReady:function(){var e=r.isCommentPost(),t=r.get("dataBound");return e&&t},isCommentAndFound:function(){var e=r.isCommentPost(),t=r.get("commentsFound");return e&&t},shortInfo:function(){var e=r.get("postDateFormatted")+"  .  "+r.get("totalViews")+" Views",t=r.get("likesText"),o=r.get("commentsText");return""!==t&&(e+="  .  "+t),""!==o&&(e+="  .  "+o),e},attachmentImageUrl:function(){var e=r.get("attachments"),t=e.length>0?e[0].FileUrl+"?width=500&height=350":"";return t=t.replace("samsung.pulsellc.com","localhost:7777")},authorProfileUrl:function(){var e=r.get("author");return"#ca-user-profile?userId="+e.Id},page:function(e){return e+r.get("id")+"&mode="+r.get("mode")},isAllowedToDeleteComment:function(e){var t=r.get("author"),o=CommunityApp.base.baseData.currentUser().id==e||CommunityApp.base.baseData.currentUser().id==t.Id;return o},readMoreClass:function(){return r.get("isStatus")===!0?"pull-left read-more-2 no-text-decoration":"pull-left read-more no-text-decoration"},load:function(t){r.set("attachments",[]),r.set("dataBound",!1),r.set("longBody",""),r.set("loadingAttachment",!0);var n=document.getElementById("topPostAttachment");n.addEventListener("load",function(){r.set("loadingAttachment",!1)},!1),"#ca-comment-add"==t.view.id&&(r.set("isComment",!0),s());var a=$("#mainScroller").data("kendoMobileScroller");null!==a&&"undefined"!=typeof a&&a.reset();var i=$("#txtComment"),l=t.view;if(i){$("#commentForm .clearfix").css("height",0);var d=$(window).height()-$("#commentForm").height()-$("#ca-comment-add header").height()-$("#ca-comment-add footer").height();$("#commentForm .clearfix").css("height",d),i.val(""),i.click(function(){null!==a&&"undefined"!=typeof a&&a.reset(),"undefined"!=typeof l.scroller&&l.scroller.reset();var e=$("#commentForm").offset().top;e-=$("#ca-comment-add header").height()+10,0===e&&(e=100),"undefined"!=typeof l.scroller&&l.scroller.scrollTo(0,-e)}),i.focus(function(){null!==a&&"undefined"!=typeof a&&a.reset(),"undefined"!=typeof l.scroller&&l.scroller.reset();var e=$("#commentForm").offset().top;e-=$("#ca-comment-add header").height()+10,0===e&&(e=100),"undefined"!=typeof l.scroller&&l.scroller.scrollTo(0,-e)})}$("#ratePost, #ratePost-bottom").raty({cancelOff:"images/cancel-off.png",cancelOn:"images/cancel-on.png",starHalf:"images/star-half.png",starOff:"images/star-off.png",starOn:"images/star-on.png",click:function(e,t){CommunityApp.sounds.post();var o=e,n=r.get("id"),a=CommunityApp.base.baseData.currentUser().id;c({rateCompleteCallback:r.rateCallback}).ratePost(n,a,o)}});var u=CommunityApp.base.baseData.currentUser().id,p=t.view.params.postId,m=t.view.params.mode,f=t.view.params.oper;r.set("mode",m);var g={mode:m,operation:f},h=e(p,u),y=o(p,u);if("undefined"!==p&&"undefined"!=typeof p){var v={url:h,requestType:"GET",dataType:"JSON",callBack:r.fnLoadCallBack,sender:JSON.stringify(g)},C=t;CommunityApp.dataAccess.callService(v,null,null,null,null,null,function(){r.load(C)});var A={url:y,requestType:"POST",dataType:"JSON"};CommunityApp.dataAccess.callService(A);var b=$("#post-comments").data("kendoMobileListView");b&&null!==b&&b.bind("dataBound",function(e){$("a[name='deleteComment']").each(function(){var e=$(this).attr("data-authorid");r.isAllowedToDeleteComment(e)&&$(this).removeClass("display-none")})})}},switchBody:function(){var e=r.get("readMore");r.set("readMore",!e)},fnLoadCallBack:function(e,t){if(e.data){CommunityApp.common.logTitle("Post: "+e.data.Subject),t=JSON.parse(t);var o=t.mode;t.operation;e.data.PostAuthor.UserProfile.AvatarUrl+="?width=100",r.set("id",e.data.Id),r.set("subject",e.data.Subject),r.set("shortBody",CommunityApp.utilities.getChars(e.data.Body,50));var n=CommunityApp.utilities.isLongerThanChars(e.data.Body,50);r.set("readMore",n),r.set("isShortText",!n),r.set("longBody",e.data.Body),r.set("postDateFormatted",e.data.PostDateText),r.set("totalViews",e.data.TotalViews),r.set("author",e.data.PostAuthor),r.set("authorTitle",e.data.PostAuthor.UserProfile.Title),r.set("attachments",e.data.PostAttachments),r.set("authorFullName",e.data.PostAuthor.UserProfile.FirstName+" "+e.data.PostAuthor.UserProfile.LastName),r.set("comments",e.data.PostComments),r.set("commentsFound",e.data.PostComments.length>0),r.set("emptyCommentsMessage","Be the first to comment to "+e.data.PostAuthor.UserProfile.FirstName),r.set("social",e.data.SocialInfo),r.set("isStatus","status"===o),r.set("rate",e.data.Rate),r.set("totalRates",e.data.TotalRatings),r.set("isThreadFollowed",e.data.IsThreadFollowed),r.set("mode",o?o:"post"),r.set("sectionPage","#ca-section-posts?sectionId="+e.data.PostThread.ThreadSection.Id),r.set("sectionTitle","More "+e.data.PostThread.ThreadSection.Name);var a=CommunityApp.base.baseData.currentUser().id==e.data.PostAuthor.Id;console.log("Author Id : "+e.data.PostAuthor.Id),console.log("Current User Id : "+CommunityApp.base.baseData.currentUser().id),console.log("Allow To Delete Attachment : "+a),r.set("editAllowed",a),r.set("postLevel",e.data.PostLevel),r.set("parentId",e.data.ParentId),e.data.SocialInfo&&(e.data.SocialInfo.LikesCount>1?r.set("likesText",e.data.SocialInfo.LikesCount+" likes"):1==e.data.SocialInfo.LikesCount?r.set("likesText","1 like"):r.set("likesText",""),e.data.SocialInfo.CommentsCount>1?r.set("commentsText",e.data.SocialInfo.CommentsCount+" comments"):1==e.data.SocialInfo.CommentsCount?r.set("commentsText","1 comment"):r.set("commentsText","")),r.get("totalRates")>0?r.set("rateText","("+r.get("totalRates")+")"):r.set("rateText",""),$("#listBottomScroller").removeClass("height-4"),$("#listBottomScroller").removeClass("height-5"),$("#listBottomScroller").addClass("status"===o?"height-4":"height-5"),$("#ratePost, #ratePost-bottom").raty("score",r.get("rate")),$("#ratePost, #ratePost-bottom").prev().html(r.get("rateText")),r.set("dataBound",!0),r.get("isComment")===!0&&$("#txtComment").focus()}},fnDeleteCommentCallback:function(e,t){$(t).closest("li").remove(),CommunityApp.common.showSuccessNotification("Comment has been deleted successfully!")},fnAddCommentCallback:function(e,t,o){200===e?CommunityApp.common.navigateToView("ca-post?postId="+t+"&mode="+o+"&oper=comment"):CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!"),$("button[type='submit']","#commentForm").html("<span class='glyphicon glyphicon-plus margin-2'></span>&nbsp;Comment").removeAttr("disabled"),s()},resetAddComment:function(e){$("#txtComment").val("")},deletePostAttachment:function(e){var t=parseInt(e.getAttribute("data-param"));if(console.log("Attachment Id is : "+t),0===t){var o=r.get("attachments");if(o&&"undefined"!=typeof o&&null!==o&&o.length>0){t=o[0].AttachmentId,console.log("New Attachment Id is : "+t);var n=i(t);console.log("deleteAttachmentServiceUrl "+n);var a={url:n,requestType:"POST",dataType:"JSON",callBack:r.DeleteAttachmentCallBack};CommunityApp.dataAccess.callService(a)}}},DeleteAttachmentCallBack:function(e){console.log("Delete Attachment Callback "+e.data),$("#attachmentContainer_"+e.data).hide(),$("#attachmentSpace").hide(),$("#attachmentuserinfo").hide()},topAttachmentId:function(){var e=r.get("attachments");return e&&"undefined"!=typeof e&&null!==e&&e.length>0?"attachmentContainer_"+e[0].AttachmentId:"attachmentContainer_0"},likePost:function(e){c({likeSuccessCallback:r.likeSuccessCallback}).like(r.get("id"),!0)},unlikePost:function(){c({likeSuccessCallback:r.likeSuccessCallback}).like(r.get("id"),!1)},likeSuccessCallback:function(e){l(r.get("social"),"like"===e)},onActionsPopoverOpen:function(e){var t=$("#swtFollowPost").data("kendoMobileSwitch");t.check(r.get("isThreadFollowed"))},rateCallback:function(e,t){switch(e){case 406:case 200:CommunityApp.common.showSuccessNotification("Thank you for rating!");break;case 404:case 412:case 500:CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")}},follow:function(e){var t=r.get("id");c({followCompleteCallback:r.followCallback}).follow(t,e.checked)},followCallback:function(e,t){switch(e){case 200:t?CommunityApp.common.showSuccessNotification("Followed Successfully!"):CommunityApp.common.showSuccessNotification("Unfollowed Successfully!");break;case 406:CommunityApp.common.showErrorNotification("Followed Before!","You have already followed this post!");break;case 404:case 412:case 500:CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")}},openFile:function(e){var t=e.substr(e.lastIndexOf("/")+1),o=t.substr(t.lastIndexOf(".")+1);if(null!==e)switch(o.toLowerCase()){case"gif":case"png":case"jpg":case"jpeg":case"pdf":case"doc":case"docx":case"xls":case"xlsx":console.log("fileUrl: "+e);var n="Download";"android"===CommunityApp.common.deviceType()?n="Download":"iphone"!==CommunityApp.common.deviceType()&&"ipad"!==CommunityApp.common.deviceType()||(n="Download"),console.log("FileName: "+t);var a=function(o){var a=o.root.toURL()+n+"/"+t;$("#ca-post #mainScroller").hide(),$('<div class="k-loading-mask" style="width: 100%; height: 100%; top: 0px; left: 0px;"><span class="k-loading-text">Downloading...</span><div class="k-loading-image"></div><div class="k-loading-color"></div></div>').appendTo("#ca-post .km-content");var i=cordova.plugins.permissions;i.hasPermission(i.WRITE_EXTERNAL_STORAGE,function(t){if(t.hasPermission)s(e,a);else{var o=function(){CommunityApp.common.showErrorNotification("Error!","Requires storage permission!")};i.requestPermission(i.WRITE_EXTERNAL_STORAGE,function(t){t.hasPermission?s(e,a):o()},o)}},null)},i=function(e){CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!")};if(null===e||""===e)return void CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!");window.requestFileSystem(LocalFileSystem.PERSISTENT,0,a,i);var s=function(e,t){var o=new FileTransfer;e=e.replace(/ /g,"%20"),console.log("replaced fileUrl: "+e),o.download(e,t,function(e){$("#ca-post .k-loading-mask").remove(),$("#ca-post #mainScroller").show();var t=e.toURL();t=t.replace(/%20/g," "),cordova.InAppBrowser.open(encodeURI(t),"_system")},function(e){$("#ca-post .k-loading-mask").remove(),$("#ca-post #mainScroller").show(),CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!"),alert("Please check the application permission.")})};break;default:cordova.InAppBrowser.open(encodeURI(e),"_system")}},likeCommentSuccessCallback:function(e,t,o){"like"==e?($(o).addClass("display-none"),$(o).prev().removeClass("display-none"),$(o).next().html("("+t+")"),$(o).next().removeClass("display-none")):($(o).addClass("display-none"),$(o).next().removeClass("display-none"),$(o).next().next().html("("+t+")"),t>0?$(o).next().next().removeClass("display-none"):$(o).next().next().addClass("display-none"))}}),l=function(e,t){var o;o=t?{UserLiked:!0,LikesCount:e.LikesCount+1,UserId:e.UserId,PosyId:e.PostId,CommentsCount:e.CommentsCount}:{UserLiked:!1,LikesCount:e.LikesCount-1,UserId:e.UserId,PosyId:e.PostId,CommentsCount:e.CommentsCount},o.LikesCount>1?r.set("likesText",o.LikesCount+" likes"):1==o.LikesCount?r.set("likesText","1 like"):r.set("likesText",""),o.CommentsCount>1?r.set("commentsText",o.CommentsCount+" comments"):1==o.CommentsCount?r.set("commentsText","1 comment"):r.set("commentsText",""),r.set("social",o)},c=function(e){var o=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.utilities.stringFormat(o?CommunityApp.configuration.postConfig.likePostPath:CommunityApp.configuration.postConfig.unlikePostPath,e,t);return n},i=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.ratePostPath;return CommunityApp.utilities.stringFormat(o,e,t)},s=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.subscribePath;return CommunityApp.utilities.stringFormat(o,e,t)};return{like:function(e,t,n){var a=CommunityApp.base.baseData.currentUser().id;if(a&&0!==a){var i=o(e,a,t);t?CommunityApp.sounds.like():CommunityApp.sounds.unlike();var s={url:i,requestType:"POST",dataType:"JSON",callBack:this.fnLikeCallBack,sender:n};CommunityApp.dataAccess.callService(s)}},fnLikeCallBack:function(t,o){if(200===t.data.HttpStatus){var n=t.data.AdditionalData.toString().toLowerCase().split(",")[0],a=t.data.AdditionalData.toString().toLowerCase().split(",")[1];e&&e.likeSuccessCallback&&e.likeSuccessCallback(n,a,o)}},deleteComment:function(e,o,n){CommunityApp.sounds.del();var a=CommunityApp.base.baseData.currentUser().id,i=t(e,o,a),s={url:i,requestType:"DELETE",dataType:"JSON",callBack:this.fnDeleteCommentCallback,sender:n};CommunityApp.dataAccess.callService(s)},fnDeleteCommentCallback:function(t,o){e.commentSuccessCallback(t,o)},addComment:function(e){var t=$("textarea","#add-comment-form").kendoValidator().data("kendoValidator");if(t.validate()){CommunityApp.sounds.post();var o=CommunityApp.base.baseData.currentUser().id,a=$("#ca-comment-add").data("kendoMobileView"),i=a.params.postId,s=a.params.mode,r="posted a comment through the mobile app",l=n(i,o),c={url:l,requestType:"POST",dataType:"JSON",data:{Subject:r,Body:e,ExpirationDate:(new Date).getMonth()+1+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()},callBack:this.fnPostCommentCallBack,sender:i+","+s};CommunityApp.dataAccess.callService(c)}},fnPostCommentCallBack:function(t,o){var n=o.split(",")[0],a=o.split(",")[1];e.addCommentSuccessCallback(t.data.HttpStatus,n,a)},deletePost:function(e,t){CommunityApp.sounds.del();var o=a(e),n={url:o,requestType:"DELETE",dataType:"JSON",callBack:this.fnDeleteCallback,sender:t};CommunityApp.dataAccess.callService(n)},fnDeleteCallback:function(t,o){e.deletePostSuccessCallback(t.data.HttpStatus,o)},ratePost:function(e,t,o){var n=i(e,t);console.log(o);var a={url:n,requestType:"POST",dataType:"JSON",data:"="+o,callBack:this.fnRateCallback};CommunityApp.dataAccess.callService(a)},fnRateCallback:function(t){e.rateCompleteCallback(t.data.HttpStatus,t.data.AdditionalData)},follow:function(e,t){var o=CommunityApp.base.baseData.currentUser().id,n=s(e,o),a={url:n,requestType:"POST",dataType:"JSON",callBack:this.fnFollowCallback,data:"="+t,sender:t};CommunityApp.dataAccess.callService(a)},fnFollowCallback:function(t,o){e.followCompleteCallback(t.data.HttpStatus,o)}}};return{operations:c,viewModel:r}}(),CommunityApp.recentPosts=function(){var e,t=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.bannerConfig.bannerPath+CommunityApp.configuration.bannerConfig.latestPath;return e},o=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.bannerConfig.bannerPath+CommunityApp.configuration.bannerConfig.secondaryPath;return e},n=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.newRecentPostsPagedPath;return CommunityApp.utilities.stringFormat(n,e,t,o)},a=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.postConfig.postsPath+CommunityApp.configuration.postConfig.recentPostId;return CommunityApp.utilities.stringFormat(n,e,t,o)},i=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.forumConfig.forumsPath+CommunityApp.configuration.forumConfig.recentForumsPath;return e},s=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.profileConfig.allStatusesPath,e);return t},r=kendo.observable({firstPost:{},pages_read:[],selectedTab:0,showStatusUpdate:!1,processBanners:function(e){var t=CommunityApp.session.load(CommunityApp.configuration.bannerConfig.mobileLatestOfflineStore);if(null!==t&&"undefined"!=typeof t&&t.lenght>0){var o=_.first(t).Id;r.getLatestMobileLatestBannerId(function(t){o!==t&&r.saveMobileLatestBannersOffline(function(){e()})})}else r.saveMobileLatestBannersOffline(function(){e()})},getLatestMobileLatestBannerId:function(e){var o=t()+"/id",n={url:o,dataType:"JSON",requestType:"GET",callBack:r.fnGetLatestMobileLatestBannerId,sender:{callBack:e}};CommunityApp.dataAccess.callService(n)},fnGetLatestMobileLatestBannerId:function(e,t){e&&e.data&&t.callBack(e.data)},page:function(e){var t=r.get("firstPost");return e+t.Id},processLatestPosts:function(e){var t=CommunityApp.session.load(CommunityApp.configuration.postConfig.offlineStore);(null===t||"undefined"==typeof t||t.length<1||"undefined"==typeof t[0].TypeId||"undefined"===t[0].TypeId)&&r.loadOffline(CommunityApp.configuration.postConfig.recentPostsMax,function(){e()})},saveMobileLatestBannersOffline:function(e){var o=t(),n={url:o,requestType:"GET",dataType:"JSON",callBack:r.fnLoadBannerCallback,sender:{callback:e}};CommunityApp.dataAccess.callService(n)},fnLoadBannerCallback:function(e,t){if(e.data){var o=e.data;CommunityApp.session.save(CommunityApp.configuration.bannerConfig.mobileLatestOfflineStore,o),t.callback&&t.callback()}},loadMobileLatestBannersOffline:function(){var t=CommunityApp.session.load(CommunityApp.configuration.bannerConfig.mobileLatestOfflineStore);if(t&&t.length>0){var o=0;for(o=0;o<t.length-1;o++){var n=0;for(n=o+1;n<t.length;n++)if(t[o].SortOrder>t[n].SortOrder){var a=t[o];t[o]=t[n],t[n]=a}}e&&e.destroy();var i=kendo.template($("#recent-posts-banner-tmpl").html()),s=kendo.render(i,t);$("#ca-home-main-view").find(".swiper-wrapper").empty(),$("#ca-home-main-view").find(".swiper-wrapper").attr("style",""),$("#ca-home-main-view").find(".swiper-wrapper").append(s),e=new Swiper("#recentPostBannerSwiper",{loop:!0,initialSlide:0,autoplay:5e3,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination",paginationClickable:!0})}},getLatestUpdateId:function(e,t){var o=CommunityApp.base.baseData.currentUser().id,n=a(o,282,185);n+="&page=1&pageSize="+e;var i={url:n,dataType:"JSON",requestType:"GET",callBack:r.fnGetLatestUpdateIdCallback,sender:{callBack:t}};CommunityApp.dataAccess.callService(i)},fnGetLatestUpdateIdCallback:function(e,t){e&&e.data&&t.callBack(e.data)},loadOffline:function(e,t){var o=CommunityApp.base.baseData.currentUser().id,a=n(o,282,185);a+="&page=1&pageSize="+e;var i={url:a,dataType:"JSON",requestType:"GET",callBack:r.fnLoadOfflineCallback,sender:{max:e,callBack:t}};CommunityApp.dataAccess.callService(i)},fnLoadOfflineCallback:function(e,t){if(e&&e.data){var o=CommunityApp.common.injectIndex(1,t.max,e.data.Items);CommunityApp.session.save(CommunityApp.configuration.postConfig.offlineStore,o),t.callBack()}},readOffline:function(){var e=CommunityApp.session.load(CommunityApp.configuration.postConfig.offlineStore);if(e&&e.length>0){var t=kendo.template($("#posts-thumbs-flip-tmpl").html()),o=kendo.render(t,e);$("#recent-posts-list").find(".container-fluid").empty(),$("#recent-posts-list").find(".container-fluid").append(o)}},read:function(e,t){var o=CommunityApp.base.baseData.currentUser().id,a=n(o,282,185),i=20;a+="&page="+e+"&pageSize="+i;var s={url:a,dataType:"JSON",requestType:"GET",callBack:r.fnReadRecentPostsCallback,sender:{page:e,pageSize:i,view:t}},l=e,c=t;CommunityApp.dataAccess.callService(s,"recent-posts-list","<h2 class='centerAlign padding-1'>No posts are found!</h2>",null,null,null,function(){r.read(l,c)})},fnReadRecentPostsCallback:function(e,t){if(e.data){var o=t.page,n=t.pageSize,a=e.data.Items,i=4;a=CommunityApp.common.injectIndex(o,n,a);var s=kendo.template($("#posts-thumbs-flip-tmpl").html()),l=kendo.render(s,a),c=r.get("pages_read");scroller=t.view.scroller,1==o&&($("#recent-posts-list").find(".container-fluid").empty(),scroller.reset(),c=[]),$("#recent-posts-list").find(".container-fluid").append(l),c.push(o),r.set("pages_read",c),scroller.unbind("scroll"),scroller.bind("scroll",function(a){$("#recent-posts-list").find(".container-fluid").children().each(function(){$(this).visible(!0)&&(viewedIndex=$(this).data("index"),total=e.data.Total,n=t.pageSize,o=t.page,viewedIndex==o*n-i&&o*n<total&&(o+=1,c.indexOf(o)<0&&(c.push(o),r.set("pages_read",c),r.read(o,t.view))))})})}},loadStatusUpdate:function(e){console.log("load status update");var t,o,n=CommunityApp.base.baseData.currentUser().id,a=s(n),i=20,l=1,c=0,d=0,u=4,p=e,m=CommunityApp.dataAccess.kendoDataSource(l,i,a,"GET",null,null,null,null,function(){r.loadStatusUpdate(p)});m.read().then(function(){var n=m.view();n=CommunityApp.common.injectIndex(l,i,n),n=CommunityApp.common.injectValue(n,"class_name","recent-status");var a=kendo.template($("#status-list-tmpl").html()),s=kendo.render(a,n);$("#recent-status-update-list").find(".container-fluid").empty(),$("#recent-status-update-list").find(".container-fluid").append(s),t=e.view.scroller,t.reset(),t.unbind("scroll"),t.bind("scroll",function(e){$(".recent-status").each(function(){$(this).visible()&&(d=$(this).attr("data-index"),c=m.total(),i=m.pageSize(),l=m.page(),d==l*i-u&&l*i<c&&(l+=1,m.page(l),m.read().then(function(){setTimeout(function(){console.log("rendering page: "+m.page()),o=m.view(),o=CommunityApp.common.injectIndex(l,i,o),o=CommunityApp.common.injectValue(o,"class_name","recent-status"),s=kendo.render(a,o),$("#recent-status-update-list").find(".container-fluid").append(s)},100)})))})})})},loadForums:function(e){var t,o,n=i(),a=20,s=1,l=0,c=0,d=4,u=e,p=CommunityApp.dataAccess.kendoDataSource(s,a,n,"GET",null,null,null,null,function(){r.loadForums(u)});p.read().then(function(){var n=p.view();n=CommunityApp.common.injectIndex(s,a,n),n=CommunityApp.common.injectValue(n,"discussion_type","recent-thread");var i=kendo.template($("#forum-list-tmpl").html()),r=kendo.render(i,n);$("#recent-discussions-list").find(".container-fluid").empty(),$("#recent-discussions-list").find(".container-fluid").append(r),t=e.view.scroller,t.reset(),t.unbind("scroll"),t.bind("scroll",function(e){$(".recent-thread").each(function(){$(this).visible()&&(c=$(this).attr("data-index"),l=p.total(),a=p.pageSize(),s=p.page(),c==s*a-d&&s*a<l&&(s+=1,p.page(s),p.read().then(function(){setTimeout(function(){console.log("rendering page: "+p.page()),o=p.view(),o=CommunityApp.common.injectIndex(s,a,o),o=CommunityApp.common.injectValue(o,"discussion_type","recent-thread"),r=kendo.render(i,o),$("#recent-discussions-list").find(".container-fluid").append(r)},100)})))})})})},refresh:function(e){CommunityApp.common.pullToRefresh(e,function(e){CommunityApp.session.remove(CommunityApp.configuration.postConfig.offlineStore),r.processLatestPosts(function(){r.readOffline()}),r.processBanners(function(){r.loadMobileLatestBannersOffline()})}),CommunityApp.common.logTitle("The Latest"),r.set("showStatusUpdate",!1);var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.showStatusUpdatePath,n={url:t,dataType:"JSON",requestType:"GET",callBack:r.fnShowStatusUpdateCallback};CommunityApp.dataAccess.callService(n,null,null,!0,!1,!1);var a=$("#latest-select").data("kendoMobileButtonGroup");a&&"undefined"!=typeof a&&a.destroy(),$("#latest-select").kendoMobileButtonGroup({index:r.get("selectedTab")}),a=$("#latest-select").data("kendoMobileButtonGroup"),a.unbind("select"),a.bind("select",function(t){r.set("selectedTab",t.index),0===t.index?($("#recent-posts-list").show(),$("#recent-discussions-list").hide(),$("#recent-status-update-list").hide()):1===t.index?(r.loadForums(e),$("#recent-posts-list").hide(),$("#recent-discussions-list").show(),$("#recent-status-update-list").hide()):2===t.index&&(r.loadStatusUpdate(e),$("#recent-posts-list").hide(),$("#recent-discussions-list").hide(),$("#recent-status-update-list").show())}),r.readOffline(),r.loadMobileLatestBannersOffline(),0===r.get("selectedTab")?$("#recent-discussions-list").hide():$("#recent-posts-list").hide();var i=o(),s={url:i,requestType:"GET",dataType:"JSON",callBack:r.fnLoadSecondaryBannerCallback};CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){r.refresh(e)})},fnShowStatusUpdateCallback:function(e){
e&&r.set("showStatusUpdate",e.data)},likeSuccessCallback:function(e,t,o){switch($(o).addClass("display-none"),e){case"like":$(o).prev().removeClass("display-none");break;case"unlike":$(o).next().removeClass("display-none")}},fnLoadSecondaryBannerCallback:function(e){if(e.data&&e.data.length>0){var t=e.data[0],o=t.Url,n='<div class="shop-samsung-ribbon"><img src="images/icn_banner_employeeprogram.png"></img></div>';n+='<div class="shop-samsung-content text-center">',n+='<img src="images/img_ShopSamsung.png"></img>',n+='<h1 class="bold margin-0 black fontsize-14">Access special offers on Samsung<br> Products, available to AT&T employees.</h1>',n+='<div class="shop-samsung-cta bold">',n+="<a onclick=\"CommunityApp.common.openShopSamsung('"+o+"');\">GET THE APP</a>",n+="</div></div>",$("#recent-posts-list").find(".shop-samsung-link").empty(),$("#recent-posts-list").find(".shop-samsung-link").append(n)}}});return{viewModel:r}}(),CommunityApp.badges=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.profileConfig.badgesPath,e);return t},t=kendo.observable({badges:[],load:function(o){CommunityApp.common.logTitle(o.view.title);var n=CommunityApp.session.currentUser.load(),a="undefined"!==o.view.params.userId&&"undefined"!=typeof o.view.params.userId?o.view.params.userId:n.id,i=n.id!=a?a:n.id;if(i&&i>0){var s=e(i),r={url:s,requestType:"GET",dataType:"JSON",callBack:CommunityApp.badges.viewModel.fnLoadCallBack},l=o;CommunityApp.dataAccess.callService(r,"badges-list-view","<h2 class='centerAlign padding-1'>No badges are found yet!</li>",null,null,null,function(){t.load(l)})}},fnLoadCallBack:function(e){t.set("badges",e.data)}});return{viewModel:t}}(),CommunityApp.changePassword=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.changePasswordPath;return t=CommunityApp.utilities.stringFormat(t,e)},t=function(){$("#change-password-form")&&($("button[type='submit']","#change-password-form").html("Save Changes").removeAttr("disabled"),$("#change-password-form").unbind("submit"),$("#change-password-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-22 pull-right'></div>").attr("disabled","disabled"),o.changePassword(),!0}))},o=kendo.observable({newPasswd:"",confirmPasswd:"",sender:"",load:function(e){o.set("sender",""),o.set("newPasswd",""),o.set("confirmPasswd","");var n="";e.view.params.sender&&"undefined"!==e.view.params.sender&&"undefined"!=typeof e.view.params.sender&&(n=e.view.params.sender),o.set("sender",n),"login"===n&&($("header").hide(),$("footer").hide()),t()},changePassword:function(){var n=CommunityApp.base.baseData.currentUser().id,a=o.get("newPasswd"),i=o.get("confirmPasswd");if(a!=i)return CommunityApp.common.showErrorNotification("New Password","Passwords do not match!"),void t();if(!a.match(/^[a-zA-Z0-9]{6,}$/))return CommunityApp.common.showErrorNotification("New Password","Invalid Password!"),void t();var s=e(n),r={url:s,requestType:"POST",dataType:"JSON",data:"="+a,callBack:o.fnChangePasswordCallback};CommunityApp.dataAccess.callService(r,null,null,!0,!1,"application/x-www-form-urlencoded")},fnChangePasswordCallback:function(e){e.data&&200==e.data.HttpStatus&&"Success"==e.data.HttpMessage?(CommunityApp.common.showSuccessNotification("Your password has been changed successfully!"),"login"===o.get("sender")&&(CommunityApp.common.navigateToView("#ca-login-second"),$("header").show(),$("footer").show())):CommunityApp.common.showErrorNotification("Update Error","Unexpected error!"),o.set("newPasswd",""),o.set("confirmPasswd",""),t()}});return{viewModel:o}}(),CommunityApp.favorites=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.favoritesPath;return t=CommunityApp.utilities.stringFormat(t,e)},t=function(t){CommunityApp.common.logTitle(t.view.title);var o=t.view.params.userId,n=CommunityApp.base.baseData.currentUser().id,a="undefined"!==o&&"undefined"!=typeof o?o:n,i=t,s=CommunityApp.dataAccess.kendoDataSource(1,10,e(a),"GET",null,"user-favorites-list","<h2 class='centerAlign padding-1'>No favorites are found yet!</h2>",null,function(){viewModel.load(i)}),r=$("#user-favorites-list").data("kendoMobileListView");null!==r&&"undefined"!=typeof r&&(r.setDataSource(s),r.dataSource.read(),r.refresh())};return{load:t}}(),CommunityApp.userAccount=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.authCodePath,t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.accessTokenPath,o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.logOffPath,n=(CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.navConfig.navPath+CommunityApp.configuration.navConfig.appNav,CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.showHelpDesk),a=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.joinNowPath;return t=CommunityApp.utilities.stringFormat(t,e)};CommunityApp.common.hideLogOffButton();var i=function(){$("#loginForm").unbind("submit"),$("#loginForm").one("submit",function(){return $("button[type='submit']",this).html("Processing...").attr("disabled","disabled"),s.userLogin(),!0})},s=kendo.observable({isUserLoggedIn:!1,userName:"",password:"",procedureInterval:null,joinNowPath:"",showHelpDesk:!0,loadLogin:function(e){CommunityApp.common.logTitle(e.view.title);var t=CommunityApp.session.load("persist-username");null!==t&&""!==t&&($("#user-acc-username").val(t),s.set("userName",t)),s.set("joinNowPath","#ca-employee-verify"),"function"==typeof cordova.getAppVersion?cordova.getAppVersion(function(e){var t=a(CommunityApp.common.deviceType()),o={url:t,requestType:"POST",dataType:"JSON",callBack:s.fnJoinNowPathCallBack,data:"="+e,httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]};console.log(t),CommunityApp.dataAccess.callService(o)}):s.set("joinNowPath","#ca-employee-verify");var o={url:n,requestType:"GET",dataType:"JSON",callBack:s.fnShowHelpDeskCallBack,httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]};CommunityApp.dataAccess.callService(o),i()},fnJoinNowPathCallBack:function(e){e.data?s.set("joinNowPath",e.data):s.set("joinNowPath","#ca-employee-verify")},joinNowRedirect:function(){CommunityApp.common.navigateToView(s.get("joinNowPath"))},fnShowHelpDeskCallBack:function(e){console.log(e),console.log(e.data),null!==e.data?s.set("showHelpDesk",e.data):s.set("showHelpDesk",!0),console.log(s.get("showHelpDesk"))},userLogin:function(t,o){CommunityApp.session.clear(!0);var n={};if(null!==t&&""!==t&&"undefined"!=typeof t&&null!==o&&""!==o&&"undefined"!=typeof o)console.log("username and password ARE explicitly passed as : username: "+t+" and password: "+o),n={url:e,requestType:"POST",dataType:"JSON",callBack:this.fnAuthCodeCallBack,data:{Username:t,Password:o},httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]};else{console.log("username and password are not explicitly passed");var a=$("#user-acc-username").val(),i=$("#user-acc-password").val();n={url:e,requestType:"POST",dataType:"JSON",callBack:this.fnAuthCodeCallBack,data:{Username:a,Password:i},httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]}}CommunityApp.dataAccess.callService(n)},fnAuthCodeCallBack:function(e){if(e.data)switch(e.data.StatusMessage.toString().toLowerCase()){case"valid":case"forcepasswordchange":var o=e.data.Token,n={url:t,requestType:"POST",dataType:"JSON",callBack:CommunityApp.userAccount.viewModel.fnAccessTokenCallBack,data:"="+o,httpHeader:["x-clientid","x-client-secret"],headerValue:[CommunityApp.configuration.authConfig.clientId,CommunityApp.configuration.authConfig.clientSecret]};CommunityApp.dataAccess.callService(n);break;case"invalidusercredentials":CommunityApp.common.showErrorNotification("Invalid Credentials","Incorrect username or password"),$("button[type='submit']","#loginForm").html("Sign In").removeAttr("disabled"),i();break;default:CommunityApp.common.showErrorNotification("Invalid Login Data","The login data is either incorrect or expired, please try again!")}else CommunityApp.common.showErrorNotification("Unexpected Error","Incorrect username or password"),$("button[type='submit']","#loginForm").html("Sign In").removeAttr("disabled"),i()},fnAccessTokenCallBack:function(e){if(e.data)switch(e.data.StatusMessage.toString().toLowerCase()){case"valid":CommunityApp.userAccount.viewModel.authenticate(e.data.UserId,e.data.Username,e.data.Token),CommunityApp.userAccount.viewModel.isUserLoggedIn&&(CommunityApp.common.navigateToView("#ca-loading-view"),CommunityApp.userAccount.viewModel.onLoginSuccess(e.data.Username));break;case"forcepasswordchange":CommunityApp.userAccount.viewModel.authenticate(e.data.UserId,e.data.Username,e.data.Token),CommunityApp.userAccount.viewModel.isUserLoggedIn&&CommunityApp.common.navigateToView("#ca-change-password?sender=login");break;default:CommunityApp.common.showErrorNotification("Invalid Login Data","The login data is either incorrect or expired, please try again!")}else CommunityApp.common.showErrorNotification("Unexpected Error","Unexpected error occurred to the system, please try again later!");$("button[type='submit']","#loginForm").html("Sign In").removeAttr("disabled"),i()},authenticate:function(e,t,o){console.log("inside authenticate"),s.set("isUserLoggedIn",!0),CommunityApp.session.currentUser.save(e,t),CommunityApp.session.accessToken.save(o),$.ajaxSetup({headers:{Authorization:"Basic "+o}}),CommunityApp.common.showLogOffButton(),CommunityApp.common.enableBackButton(),$("#btnLogOff").click(function(){CommunityApp.userAccount.viewModel.logOff()}),console.log("authentication complete")},logOff:function(){CommunityApp.notifications.viewModel.deleteDevice(),$.ajaxSetup({headers:{}}),$("#loginForm").removeClass("display-none");var e=CommunityApp.session.accessToken.load(),t={url:o,requestType:"POST",dataType:"JSON",callBack:CommunityApp.userAccount.viewModel.fnLogOffCallBack,data:"="+e,httpHeader:["x-clientid","x-client-secret"],headerValue:[CommunityApp.configuration.authConfig.clientId,CommunityApp.configuration.authConfig.clientSecret]};CommunityApp.dataAccess.callService(t)},fnLogOffCallBack:function(e){s.set("isUserLoggedIn",!1),s.set("userName",""),s.set("password",""),CommunityApp.session.clear(!0),CommunityApp.common.hideLogOffButton(),CommunityApp.common.navigateToView("#ca-login-view"),CommunityApp.common.disableBackButton(),clearInterval(s.procedureInterval)},onLoginSuccess:function(e){function t(){console.info("It worked!")}function o(e){console.error(e)}CommunityApp.sounds.preload(),CommunityApp.common.logUserId(e),CommunityApp.session.save("persist-username",e),"android"===CommunityApp.common.deviceType()&&AndroidFullScreen.immersiveMode(t,o),CommunityApp.notifications.viewModel.registerDevice(),CommunityApp.notifications.viewModel.updateBadge(),CommunityApp.folder.viewModel.getUploadCloudinaryDirectlyValue(),CommunityApp.recentPosts.viewModel.processLatestPosts(function(){CommunityApp.recentPosts.viewModel.readOffline()}),CommunityApp.recentPosts.viewModel.processBanners(function(){CommunityApp.recentPosts.viewModel.loadMobileLatestBannersOffline()}),s.procedureInterval=setInterval(r,CommunityApp.configuration.appConfig.repeatProcInterval)},gotoHelpDesk:function(){var e="http://"+CommunityApp.configuration.appConfig.domain+"/members/helpdesk";cordova.InAppBrowser.open(encodeURI(e),"_system","location=no")}}),r=function(){CommunityApp.configuration.appConfig.instantNotifications&&CommunityApp.notifications.viewModel.updateBadge()};return{viewModel:s}}(),CommunityApp.myPhotos=function(){var e=function(e){var t=CommunityApp.session.currentUser.load(),o="undefined"!==e&&"undefined"!=typeof e?e:t.id,n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.profileConfig.myPhotosPath,o,CommunityApp.configuration.appConfig.myPhotosFolderId);return n},t=function(e,t,o,n){var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.librariesConfig.librariesPath+CommunityApp.configuration.librariesConfig.filesPath;return CommunityApp.utilities.stringFormat(a,e,t,o)+"?resizeFactor="+n},o=kendo.observable({title:"",description:"",inprogress:!1,fileUrl:"",photos:[],hasPhotos:!1,showIcon:function(){var e=o.get("fileUrl");return""!==e},load:function(t){CommunityApp.common.logTitle(t.view.title),CommunityApp.common.setAddFolderPath(t.view,"#ca-upload-profile-photos"),$("#photos-scrollview").find(".swiper-wrapper").empty();var n=t.view.params.userId,a=e(n),i={url:a,requestType:"GET",dataType:"JSON",callBack:o.fnLoadPhotosCallback},s=t;CommunityApp.dataAccess.callService(i,"library-files-scrollview","<h2 class='centerAlign padding-1'>No photos are found!</h2>",null,null,null,function(){o.load(s)})},fnLoadPhotosCallback:function(e){if(e.data){o.set("photos",e.data),o.set("hasPhotos",e.data.length>0);var t=kendo.template($("#user-myphotos-tmpl").html()),n=kendo.render(t,o.get("photos"));$("#photos-scrollview").find(".swiper-wrapper").empty(),$("#photos-scrollview").find(".swiper-wrapper").attr("style",""),$("#photos-scrollview").find(".swiper-wrapper").append(n);new Swiper("#photos-scrollview")}},loadUploadPhoto:function(e){CommunityApp.common.logTitle(e.view.title)},closeScroller:function(){CommunityApp.common.navigateToView("#:back")},triggerUpload:function(){$("#photoUpload").click(),$("#photoUpload").change(function(){CommunityApp.common.readUrl(this,function(e){o.set("fileUrl",e);var t=document.getElementById("photo-icon-canvas"),n=t.getContext("2d"),a=new Image;a.onload=function(){n.drawImage(a,0,0,a.width,a.height,0,0,t.width,t.height)},a.src=e})})},addPhoto:function(){o.set("inprogress",!0),console.log("start file upload request");var e=0,n=CommunityApp.base.baseData.currentUser().id,a=0,i=new FormData;i.append("file",$("#photoUpload")[0].files[0]),i.append("data",JSON.stringify({Title:o.get("title"),Description:o.get("description"),FileUrl:o.get("fileUrl"),ParentFolderId:CommunityApp.configuration.appConfig.myPhotosFolderId}));var s=t(n,e,a,.2);console.log(s);var r={url:s,dataType:"JSON",requestType:"POST",data:i,callBack:o.fnAddPhotoCallback};CommunityApp.dataAccess.callService(r,null,null,!0,!1,!1)},fnAddPhotoCallback:function(e){if(o.set("inprogress",!1),console.log("end upload file request: "+e.data.HttpStatus),e.data){var t=CommunityApp.base.baseData.currentUser().id;200==e.data.HttpStatus?CommunityApp.common.navigateToView("#ca-user-myphotos?userId="+t):CommunityApp.common.showErrorNotification("Upload Error","Error uploading the photo")}else CommunityApp.common.showErrorNotification("Upload Error","Error uploading the photo")}});return{viewModel:o}}(),CommunityApp.profile=function(){var e,t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath,o=function(e){var t=CommunityApp.base.baseData.currentUser(),o=e!=t.id?e:t.id,n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.storyBoardPath;return n=CommunityApp.utilities.stringFormat(n,o)},n=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.profileConfig.statusPath,e);return t},a=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.profileConfig.badgesPath,e);return t},i=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.profileConfig.availableBadgesPath,e);return t},s=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.favoritesPath;return t=CommunityApp.utilities.stringFormat(t,e)},r=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.accessRightsPath;return t=CommunityApp.utilities.stringFormat(t,e)},l=function(){$("#edit-profile-form")&&($("button[type='submit']","#edit-profile-form").html("Save Changes").removeAttr("disabled"),$("#edit-profile-form").unbind("submit"),$("#edit-profile-form").one("submit",function(){return $("button[type='submit']",this).html("Processing...<div class='loading pos-22 pull-right'></div>").attr("disabled","disabled"),d.edit(),!0}))},c=function(e){var t=n(e),o={url:t,requestType:"GET",dataType:"JSON",callBack:CommunityApp.profile.viewModel.fnStatusLoadCallBack},a=e;CommunityApp.dataAccess.callService(o,"profile-status-list","<h2 class='centerAlign padding-1'>No status posts are found!</h2>",null,null,null,function(){c(a)})},d=kendo.observable({name:"",group:"",avatar:"",bio:"",email:"",totalPosts:0,memberSince:"",points:0,id:0,title:"",firstName:"",lastName:"",dataBound:!1,inProgress:!0,orientation:"",avatarFile:"",tabIndex:0,tabIndexBadges:0,statuses:[],badges:[],availableBadges:[],noBio:!0,showPoints:!1,showBadges:!1,shortBio:function(){var e=d.get("bio");return CommunityApp.utilities.getChars(e,200)},page:function(e){return e+d.get("id")},isCurrentUser:function(){return console.log("current user: "+CommunityApp.base.baseData.currentUser().id+" user id: "+d.get("id")),CommunityApp.base.baseData.currentUser().id==d.get("id")},load:function(n){d.set("showPoints",CommunityApp.configuration.appConfig.showPoints),CommunityApp.configuration.appConfig.showBadges||$("#select-badges").remove(),d.set("dataBound",!1),d.set("inProgress",!0),d.set("noBio",!0),e=null;var r=n.view.scroller,u=this.element.find("div.km-listview");$("#select-profile-view").kendoMobileButtonGroup({select:function(e){u.hide().eq(e.index).show(),r.reset()},index:d.get("tabIndex")});var p=this.element.find("#profile-badges div.km-listview-badges");$("#select-badges-view").kendoMobileButtonGroup({select:function(e){p.hide().eq(e.index).show(),r.reset()},index:d.get("tabIndexBadges")});var m=CommunityApp.session.currentUser.load(),f="undefined"!=n.view.params.userId&&"undefined"!=typeof n.view.params.userId?n.view.params.userId:m.id,g=f!=m.id?f:m.id,h=n;if(g!==m.id?$("#ca-user-profile").removeClass("no-backbutton"):$("#ca-user-profile").addClass("no-backbutton"),"undefined"!==g&&"undefined"!=typeof g){var y={url:t+g,requestType:"GET",dataType:"JSON",callBack:CommunityApp.profile.viewModel.fnLoadCallBack};CommunityApp.dataAccess.callService(y,null,null,null,null,null,function(){d.load(h)})}var v,C,A=0,b=24,w=1,k=0,S=4;d.set("pages_read",[]);var P=CommunityApp.dataAccess.kendoDataSource(w,b,o(g),"GET",null,"profile-storyboard","<h2 class='centerAlign padding-1'>No stories are found yet!</h2>",null,function(){d.load(h)});P.read().then(function(){var e=P.view();e=CommunityApp.common.injectIndex(w,b,e);var t=kendo.template($("#story-board-tmpl").html()),o=kendo.render(t,e);$("#profile-storyboard").find(".container-fluid").empty(),$("#profile-storyboard").find(".container-fluid").append(o),d.set("inProgress",!1),v=n.view.scroller,v.reset(),v.bind("scroll",function(e){$(".storyboard-item").each(function(){$(this).visible()&&(k=$(this).attr("data-index"),A=P.total(),b=P.pageSize(),w=P.page(),k==w*b-S&&w*b<A&&(w+=1,P.page(w),P.read().then(function(){setTimeout(function(){console.log("rendering page: "+P.page()),C=P.view(),C=CommunityApp.common.injectIndex(w,b,C);var e=kendo.render(t,C);$("#profile-storyboard").find(".container-fluid").append(e)},0)})))})})}),"undefined"!==g&&"undefined"!=typeof g&&c(g);var I=$("#profile-status-list").data("kendoMobileListView");if(I.bind("dataBound",function(e){$(".km-popup-overlay").each(function(){$(this).find(".km-popup-arrow").addClass("popover-arrow")})}),$("#profile-badges").show(),$("#profile-badges").css("visibility","hidden"),g&&g>0){var T=a(g),U={url:T,requestType:"GET",dataType:"JSON",sender:n,callBack:CommunityApp.profile.viewModel.fnBadgesLoadCallBack};CommunityApp.dataAccess.callService(U,"profile-badges-list-view","<h2 class='centerAlign padding-1 width-full'>No badges are found yet!</h2>",null,null,null,function(){d.load(h)});var x=i(g);console.log(x);var B={url:x,requestType:"GET",dataType:"JSON",sender:n,callBack:CommunityApp.profile.viewModel.fnAvailableBadgesLoadCallBack};CommunityApp.dataAccess.callService(B,"profile-available-badges-list-view","<h2 class='centerAlign padding-1 width-full'>No badges are found!</h2>",null,null,null,function(){d.load(h)})}var N=$("#user-favorites-list").data("kendoMobileListView");if(null!==N&&"undefined"!=typeof N){var F=CommunityApp.dataAccess.kendoDataSource(1,10,s(g),"GET",null,"user-favorites-list","<h2 class='centerAlign padding-1'>No favorites are found yet!</h2>",null,function(){d.load(h)});N.remove(N.dataSource.data()),N.setDataSource(F),N.dataSource.read(),N.scroller().reset(),N.refresh()}$("#profile-storyboard").show(),$("#profile-status").hide(),$("#profile-badges").show();var L=$("#select-profile-view").data("kendoMobileButtonGroup");"undefined"!=n.view.params.tab&&"undefined"!=typeof n.view.params.tab&&"1"===n.view.params.tab&&($("#profile-storyboard").hide(),$("#profile-status").show(),$("#profile-badges").hide(),L.select(1)),$(".km-load-more").remove(),l(),"android"===CommunityApp.common.deviceType()&&setTimeout(function(){var e=$("#ca-user-edit-profile .km-content").data("kendoMobileScroller");if(null!==e){e.reset();var t=$("#edit-profile-form #txt-firstName").offset().top;console.log("offset: "+t),t-=$("#ca-user-edit-profile header").height()+10,e.scrollTo(0,-t),$("#txt-firstName").focus(),$("#txt-firstName").focus(function(){e.reset(),$("#edit-profile-form .clearspace").css("height",0);var t=$(window).height()-$("#profile-image-section").height()-$("#ca-user-edit-profile header").height()-$("#ca-user-edit-profile footer").height();$("#edit-profile-form .clearspace").css("height",t),e.reset();var o=$("#edit-profile-form #txt-firstName").offset().top;console.log("offset: "+o),o-=$("#ca-user-edit-profile header").height()+10,e.scrollTo(0,-o)}),$("#txt-firstName").click(function(){e.reset(),$("#edit-profile-form .clearspace").css("height",0);var t=$(window).height()-$("#profile-image-section").height()-$("#ca-thread-post-reply header").height()-$("#ca-thread-post-reply footer").height();$("#edit-profile-form .clearspace").css("height",t),e.reset();var o=$("#edit-profile-form #txt-firstName").offset().top;console.log("offset: "+o),o-=$("#ca-user-edit-profile header").height()+10,e.scrollTo(0,-o)}),$("#txt-lastName").focus(function(){e.reset(),$("#edit-profile-form .clearspace").css("height",0);var t=$(window).height()-$("#profile-image-section").height()-$("#ca-user-edit-profile header").height()-$("#ca-user-edit-profile footer").height();$("#edit-profile-form .clearspace").css("height",t),e.reset();var o=$("#edit-profile-form #txt-firstName").offset().top;console.log("offset: "+o),o-=$("#ca-user-edit-profile header").height()+10,e.scrollTo(0,-o)}),$("#txt-lastName").click(function(){e.reset(),$("#edit-profile-form .clearspace").css("height",0);var t=$(window).height()-$("#profile-image-section").height()-$("#ca-thread-post-reply header").height()-$("#ca-thread-post-reply footer").height();$("#edit-profile-form .clearspace").css("height",t),e.reset();var o=$("#edit-profile-form #txt-firstName").offset().top;console.log("offset: "+o),o-=$("#ca-user-edit-profile header").height()+10,e.scrollTo(0,-o)}),$("#txt-bio").focus(function(){e.reset(),$("#edit-profile-form .clearspace").css("height",0);var t=$(window).height()-$("#profile-image-section").height()-$("#ca-user-edit-profile header").height()-$("#ca-user-edit-profile footer").height();$("#edit-profile-form .clearspace").css("height",t),e.reset();var o=$("#edit-profile-form #txt-firstName").offset().top;console.log("offset: "+o),o-=$("#ca-user-edit-profile header").height()+10,e.scrollTo(0,-o)}),$("#txt-bio").click(function(){e.reset(),$("#edit-profile-form .clearspace").css("height",0);var t=$(window).height()-$("#profile-image-section").height()-$("#ca-thread-post-reply header").height()-$("#ca-thread-post-reply footer").height();$("#edit-profile-form .clearspace").css("height",t),e.reset();var o=$("#edit-profile-form #txt-firstName").offset().top;console.log("offset: "+o),o-=$("#ca-user-edit-profile header").height()+10,e.scrollTo(0,-o)})}},500)},fnBadgesLoadCallBack:function(e,t){d.set("badges",e.data);var o=$("#profile-badges-list").data("kendoMobileListView");o.refresh(),$("#profile-badges").css("visibility","visible"),$("#profile-storyboard").show(),$("#profile-status").hide(),$("#profile-badges").hide();var n=$("#select-profile-view").data("kendoMobileButtonGroup");"undefined"!=t.view.params.tab&&"undefined"!=typeof t.view.params.tab&&"1"===t.view.params.tab&&($("#profile-storyboard").hide(),$("#profile-status").show(),$("#profile-badges").hide(),n.select(1))},fnAvailableBadgesLoadCallBack:function(e,t){d.set("availableBadges",e.data);var o=$("#profile-available-badges-list").data("kendoMobileListView");o.refresh(),$("#badges-earned").show(),$("#badges-available").hide();var n=$("#select-badges-view").data("kendoMobileButtonGroup");n.select(d.get("tabIndexBadges"))},fnDeleteStatusCallback:function(e,t){if(200===e){CommunityApp.common.showSuccessNotification("Status is deleted successfully!");var o=$(t).closest("div[id^='actionsPopOver_']").data("kendoMobilePopOver");o.close(),c(CommunityApp.base.baseData.currentUser().id)}else CommunityApp.common.showErrorNotification("Unexpected Error!","Unexpected error occurred. Try again later!")},fnStatusLoadCallBack:function(e){d.set("statuses",e.data);var t=$("#profile-status-list").data("kendoMobileListView");t.refresh()},fnLoadCallBack:function(e){if(e.data){if(d.set("avatar",e.data.UserProfile.AvatarUrl),d.set("avatarFile",e.data.UserProfile.AvatarUrl),d.set("name",e.data.UserProfile.FirstName+" "+e.data.UserProfile.LastName),d.set("email",e.data.Email),d.set("totalPosts",e.data.UserProfile.TotalPosts),d.set("memberSince",e.data.MemberSince),d.set("points",e.data.UserPoints),d.set("id",e.data.Id),d.set("title",e.data.Title),d.set("firstName",e.data.UserProfile.FirstName),d.set("lastName",e.data.UserProfile.LastName),e.data.UserProfileExtension&&null!==e.data.UserProfileExtension){var t=e.data.UserProfileExtension.Bio;null===t||0===t.length?(d.set("noBio",!0),d.set("shortBio","")):(t=t.replace(/(<([^>]+)>)/gi,""),t.length>60&&(t=t.substr(0,60)+" ... Read More"),d.set("shortBio",t),d.set("noBio",!1))}else d.set("noBio",!0),d.set("shortBio","");CommunityApp.common.logTitle("Profile: "+d.get("name")),e.data.UserProfileExtension&&null!==e.data.UserProfileExtension&&d.set("bio",e.data.UserProfileExtension.Bio),d.set("dataBound",!0)}},isAllowed:function(e,t,o){var n=CommunityApp.base.baseData.currentUser().id,a=r(n),i={url:a,requestType:"POST",dataType:"JSON",data:{Permission:e,SectionId:t},callBack:CommunityApp.profile.viewModel.fnAccessRightsCallback,sender:o};CommunityApp.dataAccess.callService(i)},fnAccessRightsCallback:function(e,t){t(e.data?e.data:e)},edit:function(){var e=CommunityApp.base.baseData.currentUser().id,o=t+e,n=new FormData;n.append("file",CommunityApp.common.dataURItoBlob(d.get("avatarFile"))),n.append("data",JSON.stringify({FirstName:d.get("firstName"),LastName:d.get("lastName"),Bio:d.get("bio")}));var a={url:o,requestType:"PUT",dataType:"JSON",data:n,callBack:d.fnEditProfileCallback};CommunityApp.dataAccess.callService(a,null,null,!0,!1,!1)},fnEditProfileCallback:function(e){e.data&&(200==e.data.HttpStatus?CommunityApp.common.navigateToView("#ca-user-profile?userId="+e.data.AdditionalData):CommunityApp.common.showErrorNotification("Update Error","Unexpected error!"))},triggerUpload:function(){$("#uploadAvatar").click(),$("#uploadAvatar").change(function(){CommunityApp.common.readUrl(this,function(e,t){d.set("avatar",e),loadImage.parseMetaData(t,function(o){o.exif&&d.set("orientation",o.exif.get("Orientation"));loadImage(t,function(t){"function"==typeof t.toDataURL?d.set("avatarFile",t.toDataURL()):d.set("avatarFile",e)},{orientation:d.get("orientation"),maxWidth:300,maxHeight:300})})})})}});return{viewModel:d}}(),CommunityApp.registration=function(){var e=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.verifyPath},t=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.registerPath},o=function(e){return CommunityApp.utilities.stringFormat(CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.storeCodesPath,e)},n=function(e){return CommunityApp.utilities.stringFormat(CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.storeNamesPath,e)},a=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.forgotPasswordPath},i=function(){$("#verifyForm").unbind("submit"),$("#verifyForm").one("submit",function(){return $("button[type='submit']",this).html("Processing...").attr("disabled","disabled"),l.verify(),!0})},s=function(){$("#registrationForm").unbind("submit"),$("#registrationForm").one("submit",function(){return $("button[type='submit']",this).html("Processing...").attr("disabled","disabled"),l.register(),!0})},r=function(){$("#resetPasswordForm").unbind("submit"),$("#resetPasswordForm").one("submit",function(){return $("button[type='submit']",this).html("Processing...").attr("disabled","disabled"),l.forgetPassword(),!0})},l=kendo.observable({code:"",jobTitle:"",firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",company:"",inputStoreCode:"",inputStoreName:"",employeeId:"",storeCodes:[],storeNames:[],backupStoreNames:[],confirmPasswordFocus:!1,jobTitles:[],showPassword:function(e){"password"==$("#regPassword").prop("type")?($("#regPassword").prop("type","text"),$(e).html("[Hide]")):($("#regPassword").prop("type","password"),$(e).html("[Show]"))},showConfirmPassword:function(e){"password"==$("#regConfirmPassword").prop("type")?($("#regConfirmPassword").prop("type","text"),$(e).html("[Hide]")):($("#regConfirmPassword").prop("type","password"),$(e).html("[Show]"))},storeCodesFound:function(){var e=l.get("storeCodes");return e.length>0},storeNamesFound:function(){var e=l.get("storeNames");return e.length>0},addressesFound:function(){var e=l.get("addresses");return e.length>0},loadVerify:function(e){CommunityApp.common.logTitle(e.view.title),i()},verify:function(){var t=l.get("code"),o=e(),n={url:o,requestType:"POST",dataType:"JSON",callBack:this.fnVerifyCallback,data:"="+t,httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]};CommunityApp.dataAccess.callService(n)},fnVerifyCallback:function(e){if(e.data){var t=e.data;t.Verified===!0?CommunityApp.configuration.appConfig.allowT2Reg&&isNaN(t.Code.charAt(0))?CommunityApp.common.navigateToView("#ca-employee-registration-t2?group="+t.Group+"&code="+t.Code):CommunityApp.common.navigateToView("#ca-employee-registration?group="+t.Group+"&code="+t.Code):CommunityApp.common.showErrorNotification("Invalid Code","Invalid verfification code");
}$("button[type='submit']","#verifyForm").html("<span class='km-icon km-key display-inline-block'></span>&nbsp;Verify").removeAttr("disabled"),i()},loadResetPassword:function(){l.set("email",""),r()},forgetPassword:function(){var e=l.get("email"),t=a(),o={url:t,requestType:"POST",dataType:"JSON",callBack:this.fnForgotPasswordCallback,data:"="+e,httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]};CommunityApp.dataAccess.callService(o)},fnForgotPasswordCallback:function(e){e&&e.data&&("success"==e.data.HttpMessage.toLowerCase()?CommunityApp.common.showSuccessNotification("Sent Successfully"):CommunityApp.common.showErrorNotification("Error","No accounts match that information, make sure you’ve entered in the correct e-mail address")),$("button[type='submit']","#resetPasswordForm").html("<span class='km-icon km-key display-inline-block'></span>&nbsp;Reset").removeAttr("disabled"),r()},resetVerify:function(){l.set("code",""),CommunityApp.common.navigateToView("#ca-login-view")},loadRegistration:function(e){CommunityApp.common.logTitle(e.view.title),$("#registerATTUID").focus(function(){$("#errorATT").hide()}),$("#registerFirstName").focus(function(){$("#errorFirstName").hide()}),$("#registerLastName").focus(function(){$("#errorLastName").hide()}),$("#registerEmail").focus(function(){$("#errorEmail").hide()}),$("#regPassword").focus(function(){$("#errorPassword").hide()}),$("#regConfirmPassword").focus(function(){$("#errorConfirmPassword").hide()});var t=[{Job:"Retail Sales Consultant"},{Job:"Assistant Sales Manager"},{Job:"Retail Sales Manager"},{Job:"Area Retail Sales Manager"},{Job:"Sales Execution Lead"},{Job:"Sales Execution Manager"},{Job:"Director"},{Job:"Field Sales Manager"},{Job:"Samsung Admin"}];l.set("jobTitles",t),l.set("company",e.view.params.group),l.set("region",e.view.params.group),l.set("code",e.view.params.code),s(),l.loadStoreData(e.view.params.code)},register:function(){var e=!0;l.set("confirmPasswordFocus",!1);var o=l.get("employeeId"),n=l.get("firstName"),a=l.get("lastName"),i=l.get("email"),r=l.get("password"),c=l.get("confirmPassword");if(null!==o&&""!==o||(e=!1,$("#errorATT").show()),null!==n&&""!==n||(e=!1,$("#errorFirstName").show()),null!==a&&""!==a||(e=!1,$("#errorLastName").show()),null!==i&&""!==i||(e=!1,$("#errorEmail").show()),null!==r&&""!==r||(e=!1,$("#errorPassword").show()),null!==c&&""!==c||(e=!1,$("#errorConfirmPassword").show()),e){var d=t(),u={url:d,requestType:"POST",dataType:"JSON",callBack:this.fnRegisterCallback,data:{PrimaryJobTitle:l.get("jobTitle"),FirstName:l.get("firstName"),LastName:l.get("lastName"),Email:l.get("email"),EmployeeId:l.get("employeeId"),Password:l.get("password"),Company:l.get("company"),IsCustom:!0,Username:l.get("email"),LanguageRole:"English",ConfirmPassword:l.get("confirmPassword"),IsCustomWithStoreCode:!0,StoreCode:l.get("inputStoreCode"),StoreName:l.get("inputStoreName"),Region:l.get("company")},httpHeader:["x-clientId"],headerValue:[CommunityApp.configuration.authConfig.clientId]};CommunityApp.dataAccess.callService(u)}else $("button[type='submit']","#registrationForm").html("<span class='km-icon km-person display-inline-block'></span>&nbsp;Register").removeAttr("disabled"),s()},fnRegisterCallback:function(e){e.data&&"success"==e.data.toLowerCase()?CommunityApp.userAccount.viewModel.userLogin(l.get("email"),l.get("password")):CommunityApp.common.showErrorNotification("Registration Error",e.data),$("button[type='submit']","#registrationForm").html("<span class='km-icon km-person display-inline-block'></span>&nbsp;Register").removeAttr("disabled"),s()},loadStoreData:function(e){var t=o(e),a={url:t,requestType:"GET",dataType:"JSON",callBack:this.fnLoadStoreCodesCallback,httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]};CommunityApp.dataAccess.callService(a);var i=n(e),s={url:i,requestType:"GET",dataType:"JSON",callBack:this.fnStoreNamesCallback,httpHeader:["x-clientid"],headerValue:[CommunityApp.configuration.authConfig.clientId]};CommunityApp.dataAccess.callService(s)},fnLoadStoreCodesCallback:function(e){e.data&&(console.log(e.data),l.set("storeCodes",e.data))},fnStoreNamesCallback:function(e){e.data&&(l.set("storeNames",e.data),l.set("backupStoreNames",e.data))},storeCodeInput:function(){var e=l.get("inputStoreCode"),t=l.get("backupStoreNames");if(""!==e){var o=_.filter(t,function(t){return t.StoreCode==e});l.set("storeNames",o)}else l.set("storeNames",t)},fieldFocus:function(){l.set("confirmPasswordFocus",!0)},fieldBlur:function(){l.set("confirmPasswordFocus",!1)}});return{viewModel:l}}(),CommunityApp.status=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.utilities.stringFormat(CommunityApp.configuration.profileConfig.statusPath,e);return t},t=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.updateStatusPath;return CommunityApp.utilities.stringFormat(o,e,t)},o=kendo.observable({statuses:[],body:"",id:0,userId:0,orientation:"",forGiphy:!1,selectedGiphy:"",selectedFixedWidthGiphy:"",isCurrentUser:function(){var e=CommunityApp.base.baseData.currentUser().id,t=e==o.get("userId");return t},scrollerClass:function(){var e=o.isCurrentUser()?"height-1":"height-3";return e},load:function(e){CommunityApp.common.logTitle("Status List");var t="undefined"!==e.view.params&&"undefined"!=typeof e.view.params?e.view.params.userId:e.params.userId;o.set("userId",t),a(o.scrollerClass());var i=CommunityApp.session.currentUser.load(),s="undefined"!==t&&"undefined"!=typeof t?t:i.id;s>0&&n(s);var r=$("#user-status-list").data("kendoMobileListView");r.bind("dataBound",function(e){$(".km-popup-overlay").each(function(){$(this).find(".km-popup-arrow").addClass("popover-arrow")})})},loadAddStatus:function(e){CommunityApp.common.logTitle(e.view.title),o.set("body",""),o.set("forGiphy",!1),o.set("selectedGiphy",""),o.set("selectedFixedWidthGiphy","");var t="undefined"!==e.view.params&&"undefined"!=typeof e.view.params?e.view.params.from:e.params.from;if("undefined"!==t&&"undefined"!=typeof t&&"selectGiphy"===t){o.set("forGiphy",!0);var n=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore);CommunityApp.session.remove(CommunityApp.configuration.giphyConfig.offlineStore),o.set("body",n.body),o.set("selectedGiphy",n.selectedGiphy),o.set("selectedFixedWidthGiphy",n.selectedFixedWidthGiphy),console.log("selectedGiphy: "+n.selectedGiphy)}},selectResource:function(){var e={};e.senderView="#ca-user-status-add?status=add",e.body=o.get("body"),e.senderObject="newStatus",CommunityApp.session.save(CommunityApp.configuration.giphyConfig.offlineStore,e);$("#select-resource-dialog").kendoWindow({modal:!0,width:300,resizable:!1,title:"Resource Selection",visible:!1,deactivate:function(e){}}).data("kendoWindow").center().open()},triggerUpload:function(e){"giphyResource"===e?(o.set("forGiphy",!0),CommunityApp.common.navigateToView("#ca-select-giphy")):($("#attchUploadStatus").click(),$("#attchUploadStatus").change(function(){o.set("forGiphy",!1),CommunityApp.common.readUrl(this,function(e,t){loadImage.parseMetaData(t,function(n){var a=document.getElementById("status-attachment-canvas-new"),i=a.getContext("2d");i.clearRect(0,0,a.width,a.height);var s=document.getElementById("status-attachment-canvas-new-upload"),r=s.getContext("2d");r.clearRect(0,0,s.width,s.height);var l=new Image;if(n.exif){l.onload=function(){s.width="900",s.height=l.height/l.width*900,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},o.set("orientation",n.exif.get("Orientation"));var c=loadImage(t,function(t){"function"==typeof t.toDataURL?(o.set("attachmentUrl",t.toDataURL()),l.src=t.toDataURL()):(o.set("attachmentUrl",e),l.src=e)},{orientation:o.get("orientation"),maxWidth:900,maxHeight:1200});c||alert("not load image")}else o.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(o.set("attachmentUrl",e),l.onload=function(){s.width="900",s.height=l.height/l.width*900,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e):(o.set("attachmentUrl",e),l.onload=function(){i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e)})})}))},fnLoadCallBack:function(e){o.set("statuses",e.data);var t=$("#user-status-list").data("kendoMobileListView");t.refresh()},add:function(){var t=$("textarea","#add-status-form").kendoValidator().data("kendoValidator");if(t.validate()){CommunityApp.sounds.post();var n=CommunityApp.session.currentUser.load();if(n.id&&0!==n.id){var a=o.get("selectedFixedWidthGiphy"),i=e(n.id),s={},r={};if(""===a){var l="https://api.cloudinary.com/v1_1/pulseltd/image/upload";l=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image");var c=new FormData;""===o.get("orientation")?(l=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image"),"undefined"!==$("#attchUploadStatus")[0].files[0]&&"undefined"!=typeof $("#attchUploadStatus")[0].files[0]?($("#attchUploadStatus")[0].files[0].size>1048576?(Pic=document.getElementById("status-attachment-canvas-new-upload").toDataURL("image/jpeg"),c.append("file",CommunityApp.common.dataURItoBlob(Pic))):c.append("file",$("#attchUploadStatus")[0].files[0]),c.append("api_key",CommunityApp.configuration.cloudinaryConfig.api_key),c.append("upload_preset",CommunityApp.configuration.cloudinaryConfig.upload_preset),s={url:l,dataType:"JSON",requestType:"POST",data:c,callBack:o.fnUploadCloudinaryCallback},CommunityApp.dataAccess.callService(s,null,null,!0,!1,!1)):(postData={Subject:"Profile post - Mobile App",Body:o.get("body"),ExpirationDate:(new Date).getMonth()+1+"/"+(new Date).getDate()+"/"+(new Date).getFullYear(),AuthorId:n.id},r={url:i,requestType:"POST",dataType:"JSON",data:postData,callBack:CommunityApp.status.viewModel.fnPostCallBack},CommunityApp.dataAccess.callService(r))):(l=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image"),Pic=document.getElementById("status-attachment-canvas-new-upload").toDataURL("image/jpeg"),c.append("file",CommunityApp.common.dataURItoBlob(Pic)),c.append("api_key",CommunityApp.configuration.cloudinaryConfig.api_key),c.append("upload_preset",CommunityApp.configuration.cloudinaryConfig.upload_preset),s={url:l,dataType:"JSON",requestType:"POST",data:c,callBack:o.fnUploadCloudinaryCallback},CommunityApp.dataAccess.callService(s,null,null,!0,!1,!1))}else postData={Subject:"Profile post - Mobile App",Body:o.get("body"),ExpirationDate:(new Date).getMonth()+1+"/"+(new Date).getDate()+"/"+(new Date).getFullYear(),AuthorId:n.id,AttachmentExternalUrl:a},r={url:i,requestType:"POST",dataType:"JSON",data:postData,callBack:CommunityApp.status.viewModel.fnPostCallBack},CommunityApp.dataAccess.callService(r)}}},fnUploadCloudinaryCallback:function(t){if(t.data){var n=CommunityApp.session.currentUser.load(),a=e(n.id),i={Subject:"Profile post - Mobile App",Body:o.get("body"),ExpirationDate:(new Date).getMonth()+1+"/"+(new Date).getDate()+"/"+(new Date).getFullYear(),AuthorId:n.id,AttachmentExternalUrl:t.data.secure_url},s={url:a,requestType:"POST",dataType:"JSON",data:i,callBack:CommunityApp.status.viewModel.fnPostCallBack};CommunityApp.dataAccess.callService(s)}},fnPostCallBack:function(e){var t=CommunityApp.base.baseData.currentUser().id;CommunityApp.common.navigateToView("ca-user-profile?userId="+t+"&tab=1"),o.set("body",""),o.set("orientation","")},likeSuccessCallback:function(e,t,o){$(o).closest(".btn-group").prev().find(".social-info").eq(0).html(s(t)),i(o,e)},goToStatusUpdate:function(e,t,o,n){CommunityApp.session.save("statusToUpdate",{id:e,body:t,attachmentUrl:o});var a=$(n).closest("div[id^='actionsPopOver_']").data("kendoMobilePopOver");a.close(),$("div[id^='actionsPopOver_']").each(function(){$(this).data("kendoMobilePopOver").destroy()}),CommunityApp.common.navigateToView("ca-user-status-update")},loadStatusToUpdate:function(e){var t=CommunityApp.session.load("statusToUpdate");if(null!==t&&"undefined"!=typeof t){o.set("id",t.id),o.set("body",t.body);var n=document.getElementById("status-attachment-canvas-update"),a=n.getContext("2d");a.clearRect(0,0,n.width,n.height);var i=new Image;i.onload=function(){a.drawImage(i,0,0,i.width,i.height,0,0,n.width,n.height)},i.src=t.attachmentUrl,CommunityApp.common.logTitle("Update Status: "+t.body)}o.set("forGiphy",!1),o.set("selectedGiphy",""),o.set("selectedFixedWidthGiphy","");var s="undefined"!==e.view.params&&"undefined"!=typeof e.view.params?e.view.params.from:e.params.from;if("undefined"!==s&&"undefined"!=typeof s&&"selectGiphy"===s){o.set("forGiphy",!0);var r=CommunityApp.session.load(CommunityApp.configuration.giphyConfig.offlineStore);CommunityApp.session.remove(CommunityApp.configuration.giphyConfig.offlineStore),o.set("body",r.body),o.set("selectedGiphy",r.selectedGiphy),o.set("selectedFixedWidthGiphy",r.selectedFixedWidthGiphy),console.log("selectedGiphy: "+r.selectedGiphy)}},selectResourceForUpdate:function(){var e={};e.senderView="#ca-user-status-update?status=update",e.body=o.get("body"),e.senderObject="updateStatus",CommunityApp.session.save(CommunityApp.configuration.giphyConfig.offlineStore,e);$("#select-resource-dialog").kendoWindow({modal:!0,width:300,resizable:!1,title:"Resource Selection",visible:!1,deactivate:function(e){}}).data("kendoWindow").center().open()},triggerUploadForUpdate:function(e){"giphyResource"===e?(o.set("forGiphy",!0),CommunityApp.common.navigateToView("#ca-select-giphy")):($("#attchUploadStatusUpdate").click(),$("#attchUploadStatusUpdate").change(function(){o.set("forGiphy",!1),CommunityApp.common.readUrl(this,function(e,t){loadImage.parseMetaData(t,function(n){var a=document.getElementById("status-attachment-canvas-update"),i=a.getContext("2d");i.clearRect(0,0,a.width,a.height);var s=document.getElementById("status-attachment-canvas-update-upload"),r=s.getContext("2d");r.clearRect(0,0,s.width,s.height);var l=new Image;if(n.exif){l.onload=function(){s.width="900",s.height=l.height/l.width*900,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},o.set("orientation",n.exif.get("Orientation"));var c=loadImage(t,function(t){"function"==typeof t.toDataURL?(o.set("attachmentUrl",t.toDataURL()),l.src=t.toDataURL()):(o.set("attachmentUrl",e),l.src=e)},{orientation:o.get("orientation"),maxWidth:900,maxHeight:1200});c||alert("not load image")}else o.set("orientation",""),console.log("not orientation"),console.log(t.size),t.size>1048576?(o.set("attachmentUrl",e),l.onload=function(){s.width="900",s.height=l.height/l.width*900,r.drawImage(l,0,0,l.width,l.height,0,0,s.width,s.height),i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e):(o.set("attachmentUrl",e),l.onload=function(){i.drawImage(l,0,0,l.width,l.height,0,0,a.width,a.height)},l.src=e)})})}))},update:function(){var e=$("textarea","#update-status-form").kendoValidator().data("kendoValidator");if(e.validate()){CommunityApp.sounds.post();var n=CommunityApp.session.currentUser.load();if(n.id&&0!==n.id){var a=o.get("selectedFixedWidthGiphy"),i=o.get("id"),s=t(n.id,i),r={},l={};if(""===a){var c="https://api.cloudinary.com/v1_1/pulseltd/image/upload";c=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image");var d=new FormData;""===o.get("orientation")?(c=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image"),"undefined"!==$("#attchUploadStatusUpdate")[0].files[0]&&"undefined"!=typeof $("#attchUploadStatusUpdate")[0].files[0]?($("#attchUploadStatusUpdate")[0].files[0].size>1048576?(Pic=document.getElementById("status-attachment-canvas-update-upload").toDataURL("image/jpeg"),d.append("file",CommunityApp.common.dataURItoBlob(Pic))):d.append("file",$("#attchUploadStatusUpdate")[0].files[0]),d.append("api_key",CommunityApp.configuration.cloudinaryConfig.api_key),d.append("upload_preset",CommunityApp.configuration.cloudinaryConfig.upload_preset),r={url:c,dataType:"JSON",requestType:"POST",data:d,callBack:o.fnUploadCloudinaryCallbackForUpdate},CommunityApp.dataAccess.callService(r,null,null,!0,!1,!1)):(postData={Body:o.get("body")},l={url:s,requestType:"POST",dataType:"JSON",data:postData,callBack:CommunityApp.status.viewModel.fnPostCallBack},CommunityApp.dataAccess.callService(l))):(c=CommunityApp.utilities.stringFormat(CommunityApp.configuration.cloudinaryConfig.cloudinaryUploadUrl,"image"),Pic=document.getElementById("status-attachment-canvas-new-upload").toDataURL("image/jpeg"),d.append("file",CommunityApp.common.dataURItoBlob(Pic)),d.append("api_key",CommunityApp.configuration.cloudinaryConfig.api_key),d.append("upload_preset",CommunityApp.configuration.cloudinaryConfig.upload_preset),r={url:c,dataType:"JSON",requestType:"POST",data:d,callBack:o.fnUploadCloudinaryCallbackForUpdate},CommunityApp.dataAccess.callService(r,null,null,!0,!1,!1))}else postData={Body:o.get("body"),AttachmentExternalUrl:a},l={url:s,requestType:"POST",dataType:"JSON",data:postData,callBack:CommunityApp.status.viewModel.fnPutCallBack},CommunityApp.dataAccess.callService(l)}}},fnUploadCloudinaryCallbackForUpdate:function(e){if(e.data){var n=CommunityApp.session.currentUser.load(),a=o.get("id"),i=t(n.id,a),s={Body:o.get("body"),AttachmentExternalUrl:e.data.secure_url},r={url:i,requestType:"POST",dataType:"JSON",data:s,callBack:CommunityApp.status.viewModel.fnPutCallBack};CommunityApp.dataAccess.callService(r)}},fnPutCallBack:function(e){if(e.data)if(200===e.data.HttpStatus){var t=CommunityApp.base.baseData.currentUser().id;CommunityApp.common.navigateToView("ca-user-profile?userId="+t+"&tab=1")}else CommunityApp.common.showErrorNotification("Unexpected Error!","Unexpected error occurred. Try again later!");CommunityApp.session.remove("statusToUpdate")},fnDeleteStatusCallback:function(e,t){if(200===e){CommunityApp.common.showSuccessNotification("Status is deleted successfully!");var o=$(t).closest("div[id^='actionsPopOver_']").data("kendoMobilePopOver");o.close(),n(CommunityApp.base.baseData.currentUser().id)}else CommunityApp.common.showErrorNotification("Unexpected Error!","Unexpected error occurred. Try again later!")}}),n=function(t){var o=e(t),a={url:o,requestType:"GET",dataType:"JSON",callBack:CommunityApp.status.viewModel.fnLoadCallBack},i=t;CommunityApp.dataAccess.callService(a,"user-status-list","<h2 class='centerAlign padding-1'>No status posts are found!</h2>",null,null,null,function(){n(i)})},a=function(e){$("#listScroller").removeClass("height-1"),$("#listScroller").removeClass("height-3"),$("#listScroller").addClass(e)},i=function(e,t){var o=$(e).attr("data-id");$(e).hide(),"like"==t?$(e).parent().append('<a onclick="CommunityApp.post.operations({ likeSuccessCallback: CommunityApp.status.viewModel.likeSuccessCallback }).like('+o+', false, this)" data-id='+o+' class="no-text-decoration light-blue"><span class="km-icon km-heart-empty margin-5"></span>Unlike</a>'):$(e).parent().append('<a onclick="CommunityApp.post.operations({ likeSuccessCallback: CommunityApp.status.viewModel.likeSuccessCallback }).like('+o+', true, this)" data-id='+o+' class="no-text-decoration light-blue"><span class="km-icon km-heart margin-5"></span>Like</a>'),$(e).remove()},s=function(e){var t;return t=e>1?e+" Likes":1==e?"1 Like":""};return{viewModel:o}}(),CommunityApp.storyBoard=function(){var e=function(e){var t=CommunityApp.session.currentUser.load(),o=e!=t.id?e:t.id,n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.profileConfig.accountPath+CommunityApp.configuration.profileConfig.storyBoardPath;return n=CommunityApp.utilities.stringFormat(n,o)},t=function(e){switch(e.toLowerCase()){case"like":return"liked a post on ";case"weblog":return"wrote a blog post on ";case"comment":return"commented on a post on ";case"forum":return"started a forum on ";case"profilepost":return"wrote a status on "}return""},o=function(t){CommunityApp.common.logTitle(t.view.title);var o=t.view.params.userId;o&&"undefined"!=typeof o&&null!==o||(o=CommunityApp.base.baseData.currentUser().id);var n,a,i=0,s=20,r=1,l=0,c=4,d=e(o),u=t,p=CommunityApp.dataAccess.kendoDataSource(r,s,d,"GET",null,"story-board-list","<h2 class='centerAlign padding-1'>No stories are found yet!</h2>",null,function(){viewModel.load(u)});p.read().then(function(){var e=p.view();e=CommunityApp.common.injectIndex(r,s,e);var o=kendo.template($("#story-board-tmpl").html()),d=kendo.render(o,e);$("#story-board-list").find(".container-fluid").empty(),$("#story-board-list").find(".container-fluid").append(d),n=t.view.scroller,n.reset(),n.bind("scroll",function(e){$(".storyboard-item").each(function(){$(this).visible()&&(l=$(this).attr("data-index"),i=p.total(),s=p.pageSize(),r=p.page(),l==r*s-c&&r*s<i&&(r+=1,p.page(r),p.read().then(function(){setTimeout(function(){console.log("rendering page: "+p.page()),a=p.view(),a=CommunityApp.common.injectIndex(r,s,a),d=kendo.render(o,a),$("#story-board-list").find(".container-fluid").append(d)},100)})))})})})};return{operation:t,load:o}}(),CommunityApp.userReports=function(){var e=function(e,t){var o;return o="All Time"===e?CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.reportConfig.reportPath+CommunityApp.configuration.reportConfig.allTimeUserPointsPath:CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.reportConfig.reportPath+CommunityApp.configuration.reportConfig.monthlyUserPointsPath,o=CommunityApp.utilities.stringFormat(o,t)},t=kendo.observable({regionShow:!1,dataBound:!1,reportType:"All Time",region:"All",pages_read:[],dataSource:null,load:function(e){t.set("regionShow",!1),t.set("dataBound",!1),t.set("reportType","All Time"),t.set("region","All"),t.set("dataSource",null);var o=e.view.params.type,n="";n="AllTime"===o?"All Time":"This Month",t.set("reportType",n);var a=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.reportConfig.reportPath+CommunityApp.configuration.reportConfig.allStoresPath,i={url:a,requestType:"GET",dataType:"JSON",callBack:t.fnAllRegionsLoadCallBack},s=e;CommunityApp.dataAccess.callService(i,null,null,null,null,null,function(){t.load(s)}),t.setUserReportsDataSource(e)},fnAllRegionsLoadCallBack:function(e){if(e.data){for(var o=function(){console.log("event: change")},n=function(e){var o=this.dataItem(e.item);console.log("event :: select ("+o.text+" : "+o.value+")"),t.set("region",o.value);t.get("reportType");t.setUserReportsDataSource(null)},a=function(e){console.log("event :: dataBound")},i=[{text:"All",value:"All"}],s=0;s<e.data.length;s++){var r={text:e.data[s],value:e.data[s]};i.push(r)}$("#dropDownRegion").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:i,select:n,change:o,dataBound:a,value:"All"}),t.set("regionShow",!0)}},setUserReportsDataSource:function(o){var n,a,i=20,s=1,r=0,l=0,c=4,d=o,u=t.get("reportType"),p=e(u,t.get("region"));console.log(p);var m=t.get("dataSource");m=CommunityApp.dataAccess.kendoDataSource(s,i,function(){return e(t.get("reportType"),t.get("region"))},"GET",null,"userReports-list","<h2 class='centerAlign padding-1'>No reports are found!</h2>",null,function(){t.setUserReportsDataSource(d)}),t.set("dataSource",m),m.read().then(function(){var e=m.view();e=CommunityApp.common.injectIndex(s,i,e);var o=kendo.template($("#userReports-list-tmpl").html()),d=kendo.render(o,e);$("#userReports-list").find(".container-fluid").empty(),$("#userReports-list").find(".container-fluid").append(d),t.set("dataBound",!0),t.set("pages_read",[]);var u=t.get("pages_read");u.push(1),t.set("pages_read",u),n=$("#userReportsScroller").data("kendoMobileScroller"),null!==n&&"undefined"!=typeof n&&(n.reset(),n.bind("scroll",function(e){$(".user-reports-item").each(function(){$(this).visible()&&(l=$(this).attr("data-index"),r=m.total(),i=m.pageSize(),s=m.page(),l==s*i-c&&s*i<r&&(s+=1,u.indexOf(s)<0&&(u=t.get("pages_read"),u.push(s),t.set("pages_read",u),m.page(s),m.read().then(function(){setTimeout(function(){console.log("rendering page: "+m.page()),a=m.view(),a=CommunityApp.common.injectIndex(s,i,a),d=kendo.render(o,a),$("#userReports-list").find(".container-fluid").append(d)},100)}))))})}))})}});return{viewModel:t}}(),CommunityApp.schedule=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.scheduleConfig.schedulePath+CommunityApp.configuration.scheduleConfig.schedulePositionsPath;return t=CommunityApp.utilities.stringFormat(t,e)},t=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.scheduleConfig.schedulePath+CommunityApp.configuration.scheduleConfig.schedulePositionsByStoreCode;return t=CommunityApp.utilities.stringFormat(t,e)},o=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.scheduleConfig.schedulePath+CommunityApp.configuration.scheduleConfig.weeksByPositionPath;return t=CommunityApp.utilities.stringFormat(t,e)},n=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.scheduleConfig.schedulePath+CommunityApp.configuration.scheduleConfig.scheduleByWeekPath;return t=CommunityApp.utilities.stringFormat(t,e)},a=kendo.observable({topShow:!1,dataBound:!1,positionId:0,weekId:0,schedule:[],weekStart:"",load:function(o){a.set("topShow",!1),a.set("dataBound",!1),a.set("positionId",0),a.set("weekId",0),a.set("schedule",[]),a.set("weekStart","");var n=CommunityApp.base.baseData.currentUser().id,i="";i=o.view.params.storeCode?t(o.view.params.storeCode):e(n);var s={url:i,requestType:"GET",dataType:"JSON",callBack:a.fnPositionsLoadCallBack},r=o;CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){a.load(r)})},fnPositionsLoadCallBack:function(e){if(e.data){for(var t=function(){console.log("event: change")},o=function(e){var t=this.dataItem(e.item);console.log("event :: select ("+t.text+" : "+t.value+")"),a.set("positionId",t.value),a.fnShowWeeksByPosition(t.value)},n=function(e){console.log("event :: dataBound")},i=[],s=0;s<e.data.length;s++){var r={text:e.data[s].Position,value:e.data[s].Id};i.push(r)}$("#dropDownPosition").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:i,select:o,change:t,dataBound:n}),a.fnShowWeeksByPosition(e.data[0].Id)}},fnShowWeeksByPosition:function(e){var t=o(e),n={url:t,requestType:"GET",dataType:"JSON",callBack:a.fnWeeksLoadCallBack},i=e;CommunityApp.dataAccess.callService(n,null,null,null,null,null,function(){a.fnShowWeeksByPosition(i)})},fnWeeksLoadCallBack:function(e){if(e.data){for(var t=e.data,o=0;o<t.length;o++){var n=new Date(t[o].WeekStart),i=new Date(t[o].WeekStart);i.setDate(i.getDate()+6);var s=n.toDateString().substr(4,3),r=i.toDateString().substr(4,3),l=n.getFullYear(),c=i.getFullYear();l===c?t[o].FullWeek=s+" "+n.getDate()+" - "+r+" "+i.getDate()+", "+l:t[o].FullWeek=s+" "+n.getDate()+", "+l+" - "+r+" "+i.getDate()+", "+c}var d=kendo.template($("#weeks-swiper-tmpl").html()),u=kendo.render(d,t);$("#weeksSwiper").find(".swiper-wrapper").empty(),$("#weeksSwiper").find(".swiper-wrapper").attr("style",""),$("#weeksSwiper").find(".swiper-wrapper").append(u),a.set("topShow",!0);new Swiper("#weeksSwiper",{initialSlide:0,onInit:function(e){a.onSelectWeek(e)},onSlideChangeStart:function(e){a.onSelectWeek(e)},nextButton:".swiper-button-next",prevButton:".swiper-button-prev"})}},onSelectWeek:function(e){var t=e.slides[e.activeIndex],o=$(t).find("span").data("weekid"),i=$(t).find("span").data("weekstart");a.set("weekStart",i);var s=n(o);console.log(s);var r={url:s,requestType:"GET",dataType:"JSON",callBack:a.fnScheduleLoadCallBack},l=e;CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){a.onSelectWeek(l)})},fnScheduleLoadCallBack:function(e){if(e.data){var t=e.data;a.set("schedule",t),a.fnShowDaySchedule(0);for(var o=a.get("weekStart"),n=[],i=0;i<7;i++){var s=new Date(o);s.setDate(s.getDate()+i);var r={DayText:s.toString().substr(0,3),DateText:s.getDate(),index:i};n.push(r)}var l=kendo.template($("#day-tab-tmpl").html()),c=kendo.render(l,n);$("#day-form").empty(),$("#day-form").attr("style",""),$("#day-form").append(c),$("#day-form").kendoMobileButtonGroup({select:function(e){a.fnShowDaySchedule(e.index)},index:0}),a.set("dataBound",!0)}},fnShowDaySchedule:function(e){var t=a.get("schedule"),o=[{Staff:"AMStaff",Schedule:t[0].Staff[e].AMStaff},{Staff:"PMStaff",Schedule:t[0].Staff[e].PMStaff}],n={columns:[{field:"Staff",title:"Staff"},{field:"Schedule",title:"# of staff"}],dataSource:o};$("#gridScheduleStaff").kendoGrid(n),o=[];for(var i=0;i<t.length;i++){var s={Name:t[i].Employee,Schedule:t[i].ScheduleEntries[e].Schedule};o.push(s)}n={columns:[{field:"Name"},{field:"Schedule"}],dataSource:o},$("#gridScheduleEntries").kendoGrid(n)}});return{viewModel:a}}(),CommunityApp.scheduleLocation=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.scheduleConfig.schedulePath+CommunityApp.configuration.scheduleConfig.scheduleLocationsPath;return t=CommunityApp.utilities.stringFormat(t,e)},t=kendo.observable({topShow:!1,dataBound:!1,storeCode:0,load:function(o){t.set("topShow",!1),t.set("dataBound",!1),t.set("storeCode",0);var n=CommunityApp.base.baseData.currentUser().id,a=e(n);console.log(a);var i={url:a,requestType:"GET",dataType:"JSON",callBack:t.fnLocationsLoadCallBack},s=o;CommunityApp.dataAccess.callService(i,null,null,null,null,null,function(){t.load(s)})},fnLocationsLoadCallBack:function(e){if(e.data){for(var o=function(){console.log("event: change")},n=function(e){var o=this.dataItem(e.item);console.log("event :: select ("+o.text+" : "+o.value+")"),t.set("storeCode",o.value)},a=function(e){console.log("event :: dataBound")},i=[],s=0;s<e.data.length;s++){var r={text:e.data[s].Store,value:e.data[s].StoreCode};i.push(r)}$("#dropDownLocation").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:i,select:n,change:o,dataBound:a}),t.set("storeCode",e.data[0].StoreCode),t.set("topShow",!0)}},gotoSchedule:function(){var e=t.get("storeCode");CommunityApp.common.navigateToView("#views/schedule/schedule.html?storeCode="+e),console.log(t.get("storeCode"))}});return{viewModel:t}}(),CommunityApp.search=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.searchConfig.searchPath+CommunityApp.configuration.searchConfig.serpPath;return CommunityApp.utilities.stringFormat(t,e)},t=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.searchConfig.searchPath+CommunityApp.configuration.searchConfig.trendingPath;return CommunityApp.utilities.stringFormat(t,e)},o=kendo.observable({serps:[],trends:[],query:"",searchFocus:!1,selectedTab:0,load:function(e){o.set("query",""),o.set("searchFocus",!1),e.view.scroller.reset(),$("#search-select").kendoMobileButtonGroup({select:function(e){o.set("selectedTab",e.index);var t=0;for(t=0;t<5;t++)$("#ca-search-listview"+t).hide();$("#ca-search-listview"+e.index).show()},index:o.get("selectedTab")});var n=o.get("selectedTab");for(i=0;i<5;i++)$("#ca-search-listview"+i).hide();$("#ca-search-listview"+n).show();var a=CommunityApp.base.baseData.currentUser().id,s=t(a),r={url:s,dataType:"JSON",requestType:"GET",callBack:o.fnTrendingCallback,sender:e.view.params.q},l=e;CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){o.load(l)})},fnTrendingCallback:function(e,t){if(e.data){var n=kendo.template($("#ca-trending-tmpl").html()),a=kendo.render(n,e.data);$("#ca-trends-listview").find(".container-fluid").empty(),$("#ca-trends-listview").find(".container-fluid").append(a),
$("#txtSearch").focus(function(){o.focus()}),$("#txtSearch").blur(function(){o.blur()}),$("#txtSearch").on("change",function(){o.search()}),t&&""!==t?($("#txtSearch").val(t),o.set("query",t),CommunityApp.common.logTitle("Search: "+t),o.focus(),o.blur(),o.search()):o.set("trends",e.data)}},focus:function(){o.set("searchFocus",!0)},blur:function(){o.get("query")},search:function(){var t=$("#txtSearch").val();if(t.length>1){var n,a,i=25,s=1,r=0,l=0,c=4,d=CommunityApp.base.baseData.currentUser().id,u=e(d),p=CommunityApp.dataAccess.kendoDataSource(s,i,u,"POST",t,"ca-search-listview","<h2 id='emptyMsg' class='centerAlign padding-1'>No results are found!</h2>",null,function(){o.search()});$("#emptyMsg").hide();var m="<h2 id='emptyMsg' class='centerAlign padding-1'>No results found!</h2>";p.read().then(function(){$(".km-load-more").remove();var e=p.view();console.log(e),e=CommunityApp.common.injectIndex(s,i,e);var t=kendo.template($("#ca-serps-tmpl").html()),o=kendo.render(t,e);$("#ca-search-listview0").find(".container-fluid").empty(),0===e.length&&$("#ca-search-listview0").find(".container-fluid").append(m),$("#ca-search-listview0").find(".container-fluid").append(o);var d=[],u=[],f=[],g=[],h=0;for(h=0;h<e.length;h++)99===e[h].TypeId?g[g.length]=e[h]:0===e[h].PostThread.ThreadSection.ApplicationType?d[d.length]=e[h]:1===e[h].PostThread.ThreadSection.ApplicationType?u[u.length]=e[h]:13===e[h].PostThread.ThreadSection.ApplicationType&&(f[f.length]=e[h]);serpResults1=kendo.render(t,d),$("#ca-search-listview1").find(".container-fluid").empty(),0===d.length&&$("#ca-search-listview1").find(".container-fluid").append(m),$("#ca-search-listview1").find(".container-fluid").append(serpResults1),serpResults2=kendo.render(t,u),$("#ca-search-listview2").find(".container-fluid").empty(),0===u.length&&$("#ca-search-listview2").find(".container-fluid").append(m),$("#ca-search-listview2").find(".container-fluid").append(serpResults2),serpResults3=kendo.render(t,f),$("#ca-search-listview3").find(".container-fluid").empty(),0===f.length&&$("#ca-search-listview3").find(".container-fluid").append(m),$("#ca-search-listview3").find(".container-fluid").append(serpResults3),serpResults4=kendo.render(t,g),$("#ca-search-listview4").find(".container-fluid").empty(),0===g.length&&$("#ca-search-listview4").find(".container-fluid").append(m),$("#ca-search-listview4").find(".container-fluid").append(serpResults4);var y=$("#ca-search").data("kendoMobileView");n=y.scroller,n.reset(),n.bind("scroll",function(e){$(".serp-item").each(function(){$(this).visible()&&(l=$(this).attr("data-index"),r=p.total(),i=p.pageSize(),s=p.page(),l==s*i-c&&s*i<r&&(s+=1,p.page(s),p.read().then(function(){setTimeout(function(){console.log("rendering page: "+p.page()),a=p.view(),a=CommunityApp.common.injectIndex(s,i,a),o=kendo.render(t,a),$("#ca-search-listview").find(".container-fluid").append(o)},100)})))})})})}},serpRedirect:function(e,t,o,n,a,i,s,r,l,c){var d;if("99"===e)d="views/learning/lessons.html?curriculumId="+r+"&categoryId="+s+"&courseId="+l,CommunityApp.common.navigateToView(d);else if("13"===t)cordova.InAppBrowser.open(encodeURI(i),"_system");else{switch(t){case"0":d="discussion"===o.toLowerCase()?"ca-thread-discussion?threadId="+a:"ca-thread-qa?threadId="+a;break;case"1":d="ca-post?postId="+n;break;case"17":d="ca-post?postId="+n+"&mode=status";break;default:d="ca-post?postId="+n}CommunityApp.common.navigateToView(d)}}});return{viewModel:o}}(),CommunityApp.sectionPosts=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.sectionPostsPath;return t=CommunityApp.utilities.stringFormat(t,e,380,215)},t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.subscribePath,o=kendo.observable({id:0,name:"",isFollowed:!1,heading:function(){return o.get("name")+" Posts"},load:function(e){var t=e.view.params.sectionId;n(t,e),o.readSection(t,o.fnParentSectionLoadCallBack)},fnParentSectionLoadCallBack:function(e){e.data&&(o.set("id",e.data.Id),o.set("name",e.data.Name),o.set("isFollowed",e.data.IsFollowedByCurrentUser),CommunityApp.common.logTitle("Section Posts: "+e.data.Name))},follow:function(e){var n=o.get("id"),a=CommunityApp.base.baseData.currentUser().id;t=CommunityApp.utilities.stringFormat(t,n,a);var i={url:t,requestType:"POST",dataType:"JSON",data:"="+e.checked,callBack:CommunityApp.section.viewModel.fnFollowCallback};CommunityApp.dataAccess.callService(i)},fnFollowCallback:function(e){if(e.data){var t=e.data.AdditionalData;switch(e.data.HttpStatus){case 200:"true"===t.toLowerCase()?CommunityApp.common.showSuccessNotification("Followed successfully!"):CommunityApp.common.showSuccessNotification("Unfollowed successfully!");break;default:"true"===t.toLowerCase()?CommunityApp.common.showErrorNotification("Unexpected error following this section!"):CommunityApp.common.showErrorNotification("Unexpected error unfollowing this section!")}}},readSection:function(e,t){if("undefined"!==e&&"undefined"!=typeof e){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath,a={url:n+e,requestType:"GET",dataType:"JSON",callBack:t},i=e,s=t;CommunityApp.dataAccess.callService(a,null,null,null,null,null,function(){o.readSection(i,s)})}},readSectionAllPosts:function(e,t,n,a){if("undefined"!==e&&"undefined"!=typeof e){var i=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.sectionAllPostsPath;i=CommunityApp.utilities.stringFormat(i,e,t,n);var s={url:i,requestType:"GET",dataType:"JSON",callBack:a},r=e,l=t,c=n,d=a;CommunityApp.dataAccess.callService(s,null,null,null,null,null,function(){o.readSectionAllPosts(r,l,c,d)})}},refresh:function(e){CommunityApp.common.logTitle("Featured Promotions");var t=kendo.template($("#posts-thumbs-list-no-user-tmpl").html()),o=CommunityApp.session.load(CommunityApp.configuration.sectionConfig.offlineStore);if(o&&null!==o&&"undefined"!=typeof o&&o.length>0){var n=kendo.render(t,o);$("#section-recent-posts-list").find(".container-fluid").empty(),$("#section-recent-posts-list").find(".container-fluid").append(n)}},likeSuccessCallback:function(e,t,n){var a=CommunityApp.session.load(CommunityApp.configuration.sectionConfig.offlineStore),i=$(n).data("id"),s=_.find(a,function(e){return e.Id==i}),r=_.indexOf(a,s),l=a[r];"like"==e?(l.SocialInfo.LikesCount=t,l.SocialInfo.UserLiked=!0):(l.SocialInfo.LikesCount=t,l.SocialInfo.UserLiked=!1),a[r]=l,CommunityApp.session.save(CommunityApp.configuration.sectionConfig.offlineStore,a),o.refresh()}}),n=function(t,o){var a,i,s=10,r=1,l=0,c=0,d=4,u=t,p=o,m=CommunityApp.dataAccess.kendoDataSource(r,s,e(t),"GET",null,"section-recent-posts-list","<h2 class='centerAlign padding-1'>No posts are found!</h2>",null,function(){n(u,p)});m.read().then(function(){var e=m.view();e=CommunityApp.common.injectIndex(r,s,e),CommunityApp.session.save(CommunityApp.configuration.sectionConfig.offlineStore,e);var t=kendo.template($("#posts-thumbs-list-no-user-tmpl").html()),o=kendo.render(t,e);$("#section-recent-posts-list").find(".container-fluid").empty(),$("#section-recent-posts-list").find(".container-fluid").append(o),a=$("#section-posts-scroller").data("kendoMobileScroller"),null!==a&&"undefined"!=typeof a&&(a.reset(),a.bind("scroll",function(e){$(".feed-article").each(function(){$(this).visible()&&(c=$(this).attr("data-index"),l=m.total(),s=m.pageSize(),r=m.page(),c==r*s-d&&r*s<l&&(r+=1,m.page(r),m.read().then(function(){setTimeout(function(){console.log("rendering page: "+m.page()),i=m.view(),i=CommunityApp.common.injectIndex(r,s,i),o=kendo.render(t,i),$("#section-recent-posts-list").find(".container-fluid").append(o);var e=CommunityApp.session.load(CommunityApp.configuration.sectionConfig.offlineStore);e.push.apply(e,i),CommunityApp.session.save(CommunityApp.configuration.sectionConfig.offlineStore,e)},100)})))})}))})};return{viewModel:o}}(),CommunityApp.sectionThreads=function(){function e(t,o,n){var a=20;t.page(o),t.read().then(function(){setTimeout(function(){console.log("rendering page: "+t.page());var i;i=t.view(),i=CommunityApp.common.injectIndex(o,a,i);var s=kendo.template($("#threads-list-tmpl").html()),r=kendo.render(s,i);$("#section-threads-list").find(".container-fluid").append(r),o<n&&e(t,o+1,n)},0)})}var t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.sectionThreadsPath;return n=CommunityApp.utilities.stringFormat(n,e,t,o)},o=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.subscribePath;return CommunityApp.utilities.stringFormat(o,e,t)},n=kendo.observable({id:0,name:"",isFollowed:!1,dataBound:!1,isUnread:!1,sectionId:0,prevSectionId:0,currentPage:1,pages_read:[],sortType:0,heading:function(){return n.get("name")},load:function(e){n.set("dataBound",!1),n.set("isUnread",e.view.params.unread),n.set("sectionId",e.view.params.sectionId);var t=$("#swtFilterUnread").data("kendoMobileSwitch");"true"==e.view.params.unread?t.check(!0):t.check(!1);var o=e.view.params.sectionId,i=n.get("sortType");if($("#thread-select-sortType").data("kendoMobileButtonGroup")&&$("#thread-select-sortType").data("kendoMobileButtonGroup").destroy(),$("#thread-select-sortType").kendoMobileButtonGroup({select:function(t){n.set("sortType",t.index),a(n.get("sectionId"),t.index,e,n)},index:n.get("sortType")}),"undefined"!==o&&"undefined"!=typeof o){n.get("prevSectionId");a(o,i,e,n);var s=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath,r={url:s+o,requestType:"GET",dataType:"JSON",callBack:n.fnParentSectionLoadCallBack},l=e;CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){n.load(l)})}},fnParentSectionLoadCallBack:function(e){e.data&&(n.set("id",e.data.Id),n.set("name",e.data.Name),n.set("isFollowed",e.data.IsFollowedByCurrentUser),CommunityApp.common.logTitle("Section Threads: "+e.data.Name))},page:function(e,t){var o="discussion"===t.toLowerCase()?"ca-thread-discussion":"ca-thread-qa";CommunityApp.common.navigateToView(o+"?threadId="+e)},follow:function(e){var t=n.get("sectionId"),a=CommunityApp.base.baseData.currentUser().id,i=o(t,a),s={url:i,requestType:"POST",dataType:"JSON",data:"="+e.checked,callBack:CommunityApp.section.viewModel.fnFollowCallback};CommunityApp.dataAccess.callService(s)},filterUnread:function(e){CommunityApp.common.navigateToView("#ca-section-threads?sectionId="+n.get("sectionId")+"&unread="+e.checked)},fnFollowCallback:function(e){if(e.data){var t=e.data.AdditionalData;switch(e.data.HttpStatus){case 200:"true"===t.toLowerCase()?CommunityApp.common.showSuccessNotification("Followed successfully!"):CommunityApp.common.showSuccessNotification("Unfollowed successfully!");break;default:"true"===t.toLowerCase()?CommunityApp.common.showErrorNotification("Unexpected error following this section!"):CommunityApp.common.showErrorNotification("Unexpected error unfollowing this section!")}}}}),a=function(o,n,i,s){var r,l,c=0,d=20,u=1,p=0,m=4,f=s.get("isUnread"),g=t(o,n,f);console.log(g),s.set("pages_read",[]);var h=s.get("prevSectionId");0===h||h!=i.view.params.sectionId?s.set("currentPage",1):u=s.get("currentPage"),console.log("currentPage: "+u);var y=o,v=i,C=s,A=n,b=CommunityApp.dataAccess.kendoDataSource(1,d,g,"GET",null,"section-threads-list","<h2 class='centerAlign padding-1'>Be the first to post!</h2>",null,function(){a(y,A,v,C)});b.read().then(function(){var t=b.view();t=CommunityApp.common.injectIndex(1,d,t);var o=s.get("pages_read");o.push(1);var n=0;for(n=0;n<t.length;n++)t[n].ThreadMostRecentPost.PostAuthor.UserProfile.AvatarUrl+="?width=100";var a=kendo.template($("#threads-list-tmpl").html()),f=kendo.render(a,t);if($("#section-threads-list").find(".container-fluid").empty(),$("#section-threads-list").find(".container-fluid").append(f),u>1){var g;for(g=2;g<=u;g++)o.push(g);e(b,2,u)}s.set("pages_read",o),r=$("#sectionThreadScroller").data("kendoMobileScroller"),s.set("dataBound",!0),null!==r&&"undefined"!=typeof r&&(0!==h&&h==i.view.params.sectionId||(r.reset(),s.set("prevSectionId",i.view.params.sectionId)),r.bind("scroll",function(e){$(".section-thread-item").each(function(){$(this).visible()&&(p=$(this).attr("data-index"),c=b.total(),d=b.pageSize(),u=b.page(),p==u*d-m&&u*d<c&&(u+=1,o.indexOf(u)<0&&(o=s.get("pages_read"),o.push(u),s.set("pages_read",o),s.set("currentPage",u),b.page(u),b.read().then(function(){setTimeout(function(){l=b.view(),l=CommunityApp.common.injectIndex(u,d,l),f=kendo.render(a,l),$("#section-threads-list").find(".container-fluid").append(f)},0)}))))})}))})};return{viewModel:n}}(),CommunityApp.section=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath,t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.sectionConfig.sectionPath+CommunityApp.configuration.sectionConfig.subscribePath,o=kendo.observable({id:0,name:"",description:"",totalThreads:0,totalPosts:0,applicationTypeName:"",dateCreated:new Date,iconUrl:"",isFollowed:!1,page:function(e){return e+o.get("id")},isPost:function(){return"weblog"===o.get("applicationTypeName").toLowerCase()},goToSectionPostsView:function(){var e=this.page("ca-section-posts?sectionId=");CommunityApp.common.navigateToView(e)},goToSectionThreadsView:function(){var e=this.page("ca-section-threads?sectionId=");CommunityApp.common.navigateToView(e)},load:function(t){var n=t.view.params.sectionId;if("undefined"!==n&&"undefined"!=typeof n){var a={url:e+n,requestType:"GET",dataType:"JSON",callBack:CommunityApp.section.viewModel.fnLoadCallBack},i=t;CommunityApp.dataAccess.callService(a,null,null,null,null,null,function(){o.load(i)})}},fnLoadCallBack:function(e){e.data&&(o.set("id",e.data.Id),o.set("name",e.data.Name),o.set("description",e.data.Description),o.set("totalThreads",e.data.TotalThreads),o.set("totalPosts",e.data.TotalPosts),o.set("applicationTypeName",e.data.ApplicationTypeName),o.set("dateCreated",e.data.DateCreatedFormatted),o.set("iconUrl",e.data.IconUrl),o.set("isFollowed",e.data.IsFollowedByCurrentUser),CommunityApp.common.logTitle("Section: "+e.data.Name),n("#btnThreads",o.get("totalThreads")),n("#btnPosts",o.get("totalPosts")))},follow:function(e){var n=o.get("id"),a=CommunityApp.base.baseData.currentUser().id;t=CommunityApp.utilities.stringFormat(t,n,a);var i={url:t,requestType:"POST",dataType:"JSON",data:"="+e.checked,callBack:CommunityApp.section.viewModel.fnFollowCallback};CommunityApp.dataAccess.callService(i)},fnFollowCallback:function(e){if(e.data){var t=e.data.AdditionalData;switch(e.data.HttpStatus){case 200:"true"===t.toLowerCase()?CommunityApp.common.showSuccessNotification("Followed successfully!"):CommunityApp.common.showSuccessNotification("Unfollowed successfully!");break;default:"true"===t.toLowerCase()?CommunityApp.common.showErrorNotification("Unexpected error following this section!"):CommunityApp.common.showErrorNotification("Unexpected error unfollowing this section!")}}}}),n=function(e,t){var o=$(e).getKendoMobileButton();o.badge(t)};return{viewModel:o}}(),CommunityApp.survey=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.surveyConfig.surveyPath+CommunityApp.configuration.surveyConfig.latestActiveSurveyPath;return t=CommunityApp.utilities.stringFormat(t,e)},t=function(e,t,o){var n=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.surveyConfig.surveyPath+CommunityApp.configuration.surveyConfig.getSurveyPath;return n=CommunityApp.utilities.stringFormat(n,e,t,o)},o=function(e,t){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.surveyConfig.surveyPath+CommunityApp.configuration.surveyConfig.getSurveyByIdPath;return o=CommunityApp.utilities.stringFormat(o,e,t)},n=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.surveyConfig.surveyPath+CommunityApp.configuration.surveyConfig.saveSurveyQuestionAnswerPath;return e},a=kendo.observable({surveyId:0,surveyName:"",surveyDescription:"",questionId:0,questionType:0,nextQuestionId:0,lastQuestionId:0,dataBound:!1,visibleList:!1,noSurvey:!0,isSuccessScreen:!1,question:"",nextBtnLabel:"Next",isLastQuestion:!1,answers:[],isFinished:!1,load:function(t){a.set("dataBound",!1),a.set("visibleList",!1),a.set("noSurvey",!0),a.set("isSuccessScreen",!1),a.set("surveyId",0),a.set("questionId",0),a.set("nextQuestionId",0),a.set("lastQuestionId",0),a.set("nextBtnLabel","Next"),a.set("isLastQuestion",!1),a.set("answers",[]),a.set("isFinished",!1),a.set("surveyId",0),a.set("questionId",0),a.set("surveyName",""),a.set("surveyDescription",""),a.set("question","");var n=CommunityApp.base.baseData.currentUser(),i=t;if("undefined"!=t.view.params.surveyId&&"undefined"!=typeof t.view.params.surveyId){var s=t.view.params.surveyId,r=o(n.id,s),l={url:r,requestType:"GET",dataType:"JSON",callBack:a.loadSurveyQuestionCallback};console.log(r),CommunityApp.dataAccess.callService(l,null,null,null,null,null,function(){a.load(i)})}else{var c=e(n.id),d={url:c,requestType:"GET",dataType:"JSON",callBack:a.loadSurveyQuestionCallback};console.log(c),CommunityApp.dataAccess.callService(d,null,null,null,null,null,function(){a.load(i)})}},showQuestion:function(){a.set("dataBound",!1),a.set("visibleList",!1),a.set("isSuccessScreen",!1);var e=a.get("isFinished");if(e)return a.set("surveyName","Continue another survey?"),a.set("dataBound",!0),void a.set("nextBtnLabel","Yes");var o=a.get("surveyId"),n=a.get("questionId"),i=CommunityApp.base.baseData.currentUser(),s=t(i.id,o,n),r={url:s,requestType:"GET",dataType:"JSON",callBack:a.loadSurveyQuestionCallback};CommunityApp.dataAccess.callService(r,null,null,null,null,null,function(){a.showQuestion()})},loadSurveyQuestionCallback:function(e){if(e.data){var t=e.data;if(a.set("surveyId",t.Id),a.set("surveyName",t.SurveyName),a.set("surveyDescription",t.SurveyDescription),a.set("questionId",t.Question.QuestionModel.Id),a.set("nextQuestionId",t.Question.NextQuestionId),console.log("questionId: "+t.Question.QuestionModel.Id+", nextQuestionId: "+t.Question.NextQuestionId),t.Question.QuestionModel.Id===t.Question.LastQuestionId?(a.set("nextBtnLabel","Finish"),a.set("isLastQuestion",!0)):(a.set("nextBtnLabel","Next"),a.set("isLastQuestion",!1)),t.UserSurveyStatus.status===!0)a.set("question",t.UserSurveyStatus.Message),a.set("dataBound",!0),a.set("visibleList",!1),a.set("isSuccessScreen",!1);else{a.set("question",t.Question.QuestionModel.Question),a.set("questionType",t.Question.QuestionModel.IsMultipleAnswer);var o="";if(0===t.Question.QuestionModel.IsMultipleAnswer)o=kendo.template($("#survey-type0-item-tmpl").html()),surveyItemResult=kendo.render(o,t.Question.AnswerModel),$("#survey-items-list").find(".survey-item-fieldlist").empty(),$("#survey-items-list").find(".survey-item-fieldlist").attr("style",""),$("#survey-items-list").find(".survey-item-fieldlist").append(surveyItemResult);else if(1===t.Question.QuestionModel.IsMultipleAnswer)o=kendo.template($("#survey-type1-item-tmpl").html()),surveyItemResult=kendo.render(o,t.Question.AnswerModel),$("#survey-items-list").find(".survey-item-fieldlist").empty(),$("#survey-items-list").find(".survey-item-fieldlist").attr("style",""),$("#survey-items-list").find(".survey-item-fieldlist").append(surveyItemResult);else if(2===t.Question.QuestionModel.IsMultipleAnswer)o=kendo.template($("#survey-type0-item-tmpl").html()),surveyItemResult=kendo.render(o,t.Question.AnswerModel),$("#survey-items-list").find(".survey-item-fieldlist").empty(),$("#survey-items-list").find(".survey-item-fieldlist").attr("style",""),$("#survey-items-list").find(".survey-item-fieldlist").append(surveyItemResult);else if(3===t.Question.QuestionModel.IsMultipleAnswer)o=kendo.template($("#survey-type3-item-tmpl").html()),surveyItemResult=kendo.render(o,t.Question.AnswerModel),$("#survey-items-list").find(".survey-item-fieldlist").empty(),$("#survey-items-list").find(".survey-item-fieldlist").attr("style",""),$("#survey-items-list").find(".survey-item-fieldlist").append(surveyItemResult);else if(4===t.Question.QuestionModel.IsMultipleAnswer)o=kendo.template($("#survey-type4-item-tmpl").html()),surveyItemResult=kendo.render(o,t.Question.AnswerModel),$("#survey-items-list").find(".survey-item-fieldlist").empty(),$("#survey-items-list").find(".survey-item-fieldlist").attr("style",""),$("#survey-items-list").find(".survey-item-fieldlist").append(surveyItemResult);else if(5===t.Question.QuestionModel.IsMultipleAnswer){o=kendo.template($("#survey-type5-item-tmpl").html()),surveyItemResult=kendo.render(o,t.Question.AnswerModel),$("#survey-items-list").find(".survey-item-fieldlist").empty(),$("#survey-items-list").find(".survey-item-fieldlist").attr("style",""),$("#survey-items-list").find(".survey-item-fieldlist").append(surveyItemResult);for(var n=t.Question.QuestionModel.Min,i=t.Question.QuestionModel.Max,s=[],r=n;r<=i;r++)s.push({text:r,value:r});$("#survey-vote-form input[name=surveyItem]").each(function(){$(this).kendoComboBox({dataTextField:"text",dataValueField:"value",value:n,dataSource:s})})}a.set("dataBound",!0),a.set("noSurvey",!1),a.set("visibleList",!0),a.set("isSuccessScreen",!1)}}else a.set("surveyName","No Survey Found!"),a.set("dataBound",!0),a.set("noSurvey",!0),a.set("isSuccessScreen",!1)},onNextQuestionClick:function(){var e=a.get("isFinished");if(e)return void a.load();var t=a.get("questionType"),o="";if(0===t||1===t||2===t){if(o=$("#survey-vote-form input[name=surveyItem]:checked").val(),"undefined"==typeof o)return void CommunityApp.common.showErrorNotification("Error!","Please select one of the answers!")}else if(3===t){if(o=$("#survey-vote-form input[name=surveyItem]").val(),"undefined"==typeof o||""===o)return void CommunityApp.common.showErrorNotification("Error!","Please type answer!")}else if(4===t&&(o=$("#survey-vote-form textarea[name=surveyItem]").val(),"undefined"==typeof o||""===o))return void CommunityApp.common.showErrorNotification("Error!","Please type answer!");var i=CommunityApp.base.baseData.currentUser(),s={},r=a.get("answers");0===t||2===t?(s={QuestionId:a.get("questionId"),OptionId:$("#survey-vote-form input[name=surveyItem]:checked").data("id"),UserId:i.id,OptionText:$("#survey-vote-form input[name=surveyItem]:checked").val()},r.push(s)):1===t?$("#survey-vote-form input[name=surveyItem]:checked").each(function(){console.log(this.value),s={QuestionId:a.get("questionId"),OptionId:$(this).data("id"),UserId:i.id,OptionText:this.value},r.push(s)}):3===t?(s={QuestionId:a.get("questionId"),OptionId:$("#survey-vote-form input[name=surveyItem]").data("id"),UserId:i.id,OptionText:$("#survey-vote-form input[name=surveyItem]").val()},r.push(s)):4===t?(s={QuestionId:a.get("questionId"),OptionId:$("#survey-vote-form textarea[name=surveyItem]").data("id"),UserId:i.id,OptionText:$("#survey-vote-form textarea[name=surveyItem]").val()},r.push(s)):5===t&&$("#survey-vote-form input[name=surveyItem]").each(function(){console.log(this.value),s={QuestionId:a.get("questionId"),OptionId:$(this).data("id"),UserId:i.id,OptionText:this.value},r.push(s)}),console.log(r),a.set("answers",r);var l=a.get("isLastQuestion");if(l){var c=n();console.log(c);var d={userId:i.id,model:JSON.parse(JSON.stringify(r))};console.log(d);var u={url:c,requestType:"POST",dataType:"JSON",data:d,callBack:a.saveSurveyQuestionAnswerCallback};CommunityApp.dataAccess.callService(u)}else{var p=a.get("nextQuestionId");a.set("questionId",p),a.showQuestion()}},saveSurveyQuestionAnswerCallback:function(e){e.data?(a.set("isFinished",!0),a.set("dataBound",!1),a.set("visibleList",!1),a.set("noSurvey",!0),a.set("surveyId",0),a.set("questionId",0),a.set("nextQuestionId",0),a.set("lastQuestionId",0),a.set("nextBtnLabel","Next"),a.set("isLastQuestion",!1),a.set("answers",[]),a.set("surveyId",0),a.set("questionId",0),a.set("surveyName",""),a.set("surveyDescription",""),a.set("question",""),a.successSurvey()):(a.set("isFinished",!0),CommunityApp.common.showErrorNotification("Error!","Unexpected error, please try again later!"))},successSurvey:function(){a.set("surveyName","THANK YOU, YOUR SURVEY HAS BEEN SUBMITTED"),a.set("dataBound",!0),a.set("isSuccessScreen",!0),a.set("visibleList",!1),a.set("noSurvey",!0)},onExitClick:function(){CommunityApp.common.navigateToView("#:back")}});return{viewModel:a}}(),CommunityApp.myTasks=function(){var e=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.tasksConfig.basePath+CommunityApp.configuration.tasksConfig.myTasksPath},t=function(){return CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.tasksConfig.basePath+CommunityApp.configuration.tasksConfig.userTasksCategoriesPath},o=kendo.observable({dataBound:!1,pages_read:[],categories:[],selectedCategoryId:0,selectedSortBy:0,selectedSortByDirection:0,isCompleted:null,noTasks:!1,load:function(e){o.set("isCompleted",null),o.set("dataBound",!1),o.read(1,e.view);var n=t(),a={url:n,requestType:"GET",dataType:"JSON",callBack:o.fnLoadCategoriesCallback};CommunityApp.dataAccess.callService(a)},fnLoadCategoriesCallback:function(e){if(e&&e.data){var t=e.data;t.splice(0,0,{Id:0,Name:"- Category -"}),o.set("categories",t)}},categoryChange:function(){var e=$("#ca-mytasks").data("kendoMobileView"),t=o.get("selectedCategoryId"),n=o.get("selectedSortBy"),a=o.get("selectedSortByDirection"),i=o.get("isCompleted");t>0&&o.read(1,e,{CategoryId:t,SortBy:n,SortByDirection:a,IsCompleted:i})},sortByChange:function(){o.handleSort()},sortByDirectionChange:function(){o.handleSort()},handleSort:function(){var e=$("#ca-mytasks").data("kendoMobileView"),t=o.get("selectedCategoryId"),n=o.get("selectedSortBy"),a=o.get("selectedSortByDirection"),i=o.get("isCompleted");n>0&&a>0&&o.read(1,e,{CategoryId:t,SortBy:n,SortByDirection:a,IsCompleted:i})},filterCompleted:function(e){var t=$("#ca-mytasks").data("kendoMobileView"),n=e.checked;o.set("isCompleted",n);var a=o.get("selectedCategoryId"),i=o.get("selectedSortBy"),s=o.get("selectedSortByDirection");o.read(1,t,{CategoryId:a,SortBy:i,SortByDirection:s,IsCompleted:n})},read:function(t,n,a){var i=e(),s=20;i+="?page="+t+"&pageSize="+s;var r={url:i,requestType:"POST",dataType:"JSON",callBack:o.fnMyTasksLoadCallback,data:a,sender:{page:t,pageSize:s,view:n,filter:a}};CommunityApp.dataAccess.callService(r)},fnMyTasksLoadCallback:function(e,t){if(e&&e.data){var n=t.page,a=t.pageSize,i=e.data.Items,s=4;i=CommunityApp.common.injectIndex(n,a,i);var r=kendo.template($("#mytasks-list-tmpl").html()),l=kendo.render(r,i),c=o.get("pages_read"),d=$("#listscroller").data("kendoMobileScroller");1==n&&($("#mytasks-container").empty(),d.reset(),c=[],o.set("dataBound",!0)),$("#mytasks-container").append(l),c.push(n),o.set("pages_read",c),d.unbind("scroll"),d.bind("scroll",function(i){$("#mytasks-container").find(".task-item").each(function(){$(this).visible(!0)&&(viewedIndex=$(this).data("index"),total=e.data.Total,a=t.pageSize,n=t.page,viewedIndex==n*a-s&&n*a<total&&(n+=1,c.indexOf(n)<0&&(c.push(n),o.set("pages_read",c),o.read(n,t.view,t.filter))))})})}o.set("noTasks",e.data.Items.length<=0)}});return{viewModel:o}}(),CommunityApp.task=function(){var e=function(e){var t=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.tasksConfig.basePath+CommunityApp.configuration.tasksConfig.taskPath;return CommunityApp.utilities.stringFormat(t,e)},t=kendo.observable({taskId:0,dataBound:!1,name:"",description:"",priority:"",validFrom:"",validFromText:"",validTo:"",validToText:"",taskImageUrl:"",showImage:!1,activities:[],showActivities:!1,load:function(o){o.view.scroller.reset(),t.set("dataBound",!1),t.set("taskId",o.view.params.taskId);var n=o.view.params.taskId,a=e(n),i={url:a,requestType:"GET",dataType:"JSON",callBack:t.fnLoadTaskCallback};CommunityApp.dataAccess.callService(i,null,null,null,null,null,function(){t.load(o)})},fnLoadTaskCallback:function(e){if(e&&e.data){t.set("name",e.data.Name),t.set("description",e.data.Description),t.set("priority","Priority: "+e.data.PriorityName),t.set("validFrom",e.data.ValidFromDateFormatted),t.set("validFromText","Start Date: "+e.data.ValidFromDateFormatted),t.set("validToText","Due Date: "+e.data.ValidToDateFormatted),t.set("validTo",e.data.ValidToDateFormatted),t.set("taskImageUrl",e.data.imagepath),t.set("showImage",!(null===e.data.imagepath||""===e.data.imagepath)),t.set("activities",e.data.Details),t.set("showActivities",e.data.Details.length>0);var o=kendo.template($("#task-details-list-tmpl").html()),n=kendo.render(o,e.data.Details);$("#task-details-container").empty(),$("#task-details-container").append(n),t.set("dataBound",!0)}}});return{viewModel:t}}(),CommunityApp.main=function(){function e(){return o}function t(){function e(e){if(console.log("Token validation response: "+JSON.stringify(e)),e.data&&e.data.StatusMessage)switch(e.data.StatusMessage.toString().toLowerCase()){case"valid":CommunityApp.userAccount.viewModel.authenticate(e.data.UserId,e.data.Username,e.data.Token);break;default:CommunityApp.session.clear(!0),CommunityApp.userAccount.viewModel.set("isUserLoggedIn",!1)}else CommunityApp.session.clear(!0),CommunityApp.userAccount.viewModel.set("isUserLoggedIn",!1);CommunityApp.lang.setPreferredLanguage(function(t){console.log("preferred lang is: "+t);var n=new Multilingual;n.init("body"),o=new kendo.mobile.Application(document.body,{initial:"#ca-login-view",loading:"<h1>Loading...</h1>",platform:CommunityApp.configuration.appConfig.environment,skin:CommunityApp.configuration.appConfig.skin,init:function(t){o=this,$("#mainTabStrip").find(".km-button").removeClass("km-state-active");$(window).width();$("#popupNotification").kendoNotification({position:{bottom:70}}),CommunityApp.userAccount.viewModel.isUserLoggedIn?(this.navigate("#ca-loading-view"),CommunityApp.userAccount.viewModel.onLoginSuccess(e.data.Username)):(this.navigate("#ca-login-view"),$("#loginForm").removeClass("display-none")),console.log("width: "+$(window).width()+" and height: "+$(window).height()),$(document).ajaxStart(function(){o&&null!==o&&o.pane&&o.showLoading()}),$(document).ajaxStop(function(){o&&null!==o&&o.pane&&o.hideLoading()}),$(document).ajaxError(function(){o&&null!==o&&o.pane&&o.hideLoading()}),$.ajaxSetup({cache:!1})}})})}console.log("Kendo initializeApp Start"),CommunityApp.session.currentUser.remove();var t=n(),a=CommunityApp.session.accessToken.load(),i={url:t,requestType:"POST",dataType:"JSON",callBack:e,data:"="+(a&&a.token?a.token:"n/a")};console.log("Token validation start"),CommunityApp.dataAccess.callService(i)}var o,n=function(){var e=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.authConfig.authPath+CommunityApp.configuration.authConfig.tokenValidationPath;return e},a=function(e){CommunityApp.userAccount.viewModel.isUserLoggedIn&&(r(),l(),s(e.view),d(e.view),u(e.view),p(e.view),m(e.view),g(e.view),h(e.view),y(e.view))},i=function(e){f(),CommunityApp.libraryScroller.viewModel.resetZoom()},s=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.addLibraryFolderViews,t),n=e.params.libraryId?e.params.libraryId:CommunityApp.configuration.appConfig.myPhotosFolderId;console.log("library id: "+n),o>=0?CommunityApp.profile.viewModel.isAllowed("author",n,function(t){t===!0?c(e,!0):c(e,!1)}):c(e,!1)},r=function(){function e(e){var t=[];$.each(e,function(e,o){if(o.ChildrenNodes&&o.ChildrenNodes.length>0){var n={header:o.Title,items:[]};$.each(o.ChildrenNodes,function(e,t){var o={title:t.Title,url:t.Url};n.items.push(o)}),t.push(n)}else{var a={header:"",items:[{title:o.Title,url:o.Url}]};t.push(a);
}});var o=kendo.template($("#navigation-template").html()),n=kendo.render(o,t);$("#left-drawer-list").children().not(":first").not(":last").remove(),$("#left-drawer-list").children().first().after(n),$(".km-group-title").each(function(){$(this).siblings(".km-list").length>0&&($(this).find(".km-text").find(".km-icon").remove(),$(this).find(".km-text").append("<span class='km-icon km-arrow-right white pull-right arrow-pos'></span>"),$(this).unbind("click"),$(this).click(function(){$(this).next().hasClass("display-none-virtual")?($(this).find(".km-text").find(".km-icon").removeClass("km-arrow-right"),$(this).find(".km-text").find(".km-icon").addClass("km-arrow-down"),$(this).next().slideDown("1000","swing"),$(this).next().removeClass("display-none-virtual")):($(this).find(".km-text").find(".km-icon").removeClass("km-arrow-down"),$(this).find(".km-text").find(".km-icon").addClass("km-arrow-right"),$(this).next().slideUp("1000","swing"),$(this).next().addClass("display-none-virtual"))}))}),CommunityApp.session.save("left_nav",e,!0)}var t=CommunityApp.session.load("left_nav",!0);if(!t||t.length<=0){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.navConfig.navPath+CommunityApp.configuration.navConfig.appNav,n={url:o,requestType:"GET",dataType:"JSON",callBack:function(e){e&&e.data&&(console.log(e.data.ChildrenNodes),console.log(e.data.ChildrenNodes))}};CommunityApp.dataAccess.callService(n,null,null,null,null,null,function(){r()})}else e(t)},l=function(){function e(e){var t=kendo.template($("#bottom-navigation-template").html()),o=kendo.render(t,e);$("#mainTabStrip").empty(),$("#mainTabStrip").append(o),$("#mainTabStrip").find(".km-button").eq(0).addClass("km-state-active"),CommunityApp.session.save("bottom_nav",e,!0)}var t=CommunityApp.session.load("bottom_nav",!0);if(!t||t.length<=0){var o=CommunityApp.configuration.appConfig.serviceUrl+CommunityApp.configuration.navConfig.navPath+CommunityApp.configuration.navConfig.appBottomMenu,n={url:o,requestType:"GET",dataType:"JSON",callBack:function(t){t&&t.data&&e(t.data.ChildrenNodes)}};CommunityApp.dataAccess.callService(n,null,null,null,null,null,function(){l()})}else e(t)},c=function(e,t){var o=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==o){var n=o.rightElement;null!==n&&(t?$(n[0].firstChild).show():$(n[0].firstChild).hide())}},d=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.sharePostViews,t),n=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==n){var a=n.rightElement;null!==a&&(o<0?$(a[0].children[1]).hide():$(a[0].children[1]).show())}},u=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.addThreadViews,t),n=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==n){var a=n.rightElement;null!==a&&(o<0?$(a[0].children[2]).hide():($(a[0].children[2]).show(),$(a[0].children[2]).attr("href","#ca-thread-add?sectionId="+e.params.sectionId)))}},p=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.editProfileViews,t),n=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==n){var a=n.rightElement;null!==a&&(o<0?$(a[0].children[3]).hide():"undefined"!==e.params.userId&&"undefined"!=typeof e.params.userId&&e.params.userId!=CommunityApp.session.currentUser.load().id?$(a[0].children[3]).hide():($(a[0].children[3]).show(),$(a[0].children[3]).attr("href","#ca-user-edit-profile")))}},m=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.clearNotificationsViews,t),n=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==n){var a=n.rightElement;null!==a&&(o<0?$(a[0].children[4]).hide():($(a[0].children[4]).show(),$(a[0].children[4]).attr("onclick","CommunityApp.notifications.viewModel.clear();")))}},f=function(){var e=$("iframe");if(e&&null!==e&&"undefined"!=typeof e){var t=e.attr("src");t&&null!==t&&t&&"undefined"!=typeof t&&t.indexOf("youtube.com")>0&&e.attr("src","about:blank")}},g=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.chatAddMoreViews,t),n=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==n){var a=n.rightElement;null!==a&&(o<0?($(a[0].children[7]).hide(),$(a[0].children[6]).show()):($(a[0].children[7]).show(),$(a[0].children[6]).hide()))}},h=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.addGroupViews,t),n=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==n){var a=n.rightElement;null!==a&&(o<0?$(a[0].children[8]).hide():$(a[0].children[8]).show())}},y=function(e){var t=e.id,o=_.indexOf(CommunityApp.configuration.addRolesViews,t),n=e.header.find(".km-navbar").data("kendoMobileNavBar");if(null!==n){var a=n.rightElement;null!==a&&(o<0?$(a[0].children[9]).hide():$(a[0].children[9]).show())}};return{initializeApp:t,getKendoApplication:e,viewShow:a,viewHide:i}}();